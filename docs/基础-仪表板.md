# 基础-仪表板设计

> 术语统一记录（2025-09-26）
> - 历史用语→统一用语：机师→主播；舰长→运营；议长→管理员；征召→招募；作战计划→通告；作战记录→开播记录；作战日报→开播日报。
> - 本次复核（2025-09-26）：已完成逐段术语检查，正文采用统一用语；数据库/接口字段仍保留历史命名，仅以字段标注说明。
## 概述

仪表板是用户首页的核心组件，用于展示关键业务数据的统计信息。采用卡片式设计，支持响应式布局，确保在移动端和桌面端都有良好的用户体验。

当前首页共渲染七张卡片，均使用"1个主要数据 + 2个副数据卡片"的布局（若无副数据则退化为单指标卡片）：

| 卡片 | 主要数据 | 副数据（左 / 右） | 点击跳转 |
| --- | --- | --- | --- |
| 招募统计 | 今日约面 | 今日到面 / 今日新开播 | 招募日报 |
| 线下底薪流水转化率 | 本月转化率 | 昨日转化率 / 上周转化率 | 开播月报 |
| 昨日主播排名 | 冠军 | 亚军 / 季军 | — |
| 通告计划统计 | 今日通告数 | 环比 / 7日平均 | 通告日历（日视图） |
| 开播记录统计 | 今日流水 | 昨日流水 / 7日平均流水 | 开播日报 |
| 主播统计 | 服役人数 | 实习主播 / 正式主播 | — |
| 候选人统计 | 候补人数 | 试播主播 | — |

## 设计原则

- **数据层次化**：主要数据突出显示，副数据作为补充信息
- **响应式设计**：移动端优先，桌面端优化
- **视觉一致性**：与整体UI风格保持一致
- **信息密度适中**：避免信息过载，保持清晰可读

## 卡片设计规范

### 基本结构

每个卡片包含以下基本元素：
- **卡片头部**：标题 + 图标
- **卡片主体**：主要数据 + 副数据（可选）

### 三种卡片布局模式

#### 1. 单主要数据卡片
适用于只需要展示一个核心指标的场景。

**HTML结构：**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">数据标题</div>
    <div class="card-icon">📊</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">123</div>
      <div class="main-label">数据说明</div>
    </div>
  </div>
</div>
```

**CSS样式：**
```css
.card-body {
  padding: 0;
}

.main-data {
  text-align: center;
  padding: 20px 0;
}

.main-value {
  font-size: 36px;
  font-weight: 700;
  color: var(--brand);
  margin-bottom: 8px;
  line-height: 1;
}

.main-label {
  font-size: 16px;
  color: var(--text);
  font-weight: 600;
}
```

#### 2. 1个主要数据 + 1个副数据卡片
适用于需要展示核心指标和1个相关补充信息的场景。

**HTML结构：**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">数据标题</div>
    <div class="card-icon">📊</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">123</div>
      <div class="main-label">主要数据说明</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value">+15.2%</div>
        <div class="sub-label">副数据说明</div>
      </div>
    </div>
  </div>
</div>
```

**CSS样式：**
```css
.main-data {
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--table-header);
}

.sub-data {
  display: flex;
  justify-content: center;
  gap: 20px;
}

.sub-item {
  text-align: center;
}

.sub-value {
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
  line-height: 1;
}

.sub-label {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}
```

#### 3. 1个主要数据 + 2个副数据卡片（当前实现）
适用于需要展示核心指标和2个相关补充信息的场景。

**HTML结构：**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">数据标题</div>
    <div class="card-icon">📊</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">123</div>
      <div class="main-label">主要数据说明</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value positive">+15.2%</div>
        <div class="sub-label">副数据1</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">8.5</div>
        <div class="sub-label">副数据2</div>
      </div>
    </div>
  </div>
</div>
```

**CSS样式：**
```css
.main-data {
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--table-header);
}

.sub-data {
  display: flex;
  justify-content: space-around;
  gap: 20px;
}

.sub-item {
  text-align: center;
  flex: 1;
}

.sub-value {
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
  line-height: 1;
}

.sub-value.positive {
  color: var(--hud-green);
}

.sub-value.negative {
  color: var(--error);
}

.sub-label {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}
```

### 图片仪表（特殊卡片）

用于在首页置顶展示一张静态图片，不含数据指标。与其他卡片保持相同外框与圆角，图片需等比缩放且不变形。

**HTML结构：**
```html
<div class="card" id="featuredImageCard">
  <div class="card-header">
    <div class="card-title">特别图片</div>
    <div class="card-icon">🖼️</div>
  </div>
  <div class="card-body">
    <div class="image-gauge">
      <img src="/static/1001.jpeg" alt="featured" class="image-gauge-img" />
    </div>
  </div>
  </div>
```

**CSS样式：**
```css
.image-gauge { width: 100%; overflow: hidden; border-radius: 8px; }
.image-gauge-img { display: block; width: 100%; height: auto; object-fit: contain; }
```

注意：仅用于展示图片，无点击跳转与副数据区域；需与 `.card` 保持一致的边框、阴影与悬停效果。

#### 可选：轻微流光动效（节日氛围）

为不影响阅读的前提下，增加轻微流光效果与柔和光晕：

```css
.image-gauge { position: relative; }
.image-gauge::after {
  content: "";
  position: absolute;
  top: 0; left: -60%; width: 50%; height: 100%;
  pointer-events: none;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.22) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-18deg);
  opacity: 0;
  animation: shimmer-sweep 6s ease-in-out infinite;
}
@keyframes shimmer-sweep {
  0% { left: -60%; opacity: 0; }
  10% { opacity: 0.5; }
  50% { left: 110%; opacity: 0.18; }
  100% { left: 110%; opacity: 0; }
}

.image-gauge { box-shadow: 0 0 6px 0 rgba(255, 215, 0, 0.06); animation: soft-glow 10s ease-in-out infinite; }
@keyframes soft-glow {
  0%,100% { box-shadow: 0 0 6px 0 rgba(255, 215, 0, 0.06); }
  50% { box-shadow: 0 0 12px 0 rgba(255, 215, 0, 0.10); }
}
```

说明：
- **强度控制**：透明度均小于等于0.22，频率较慢（6s与10s），避免夸张。
- **性能**：仅添加1个伪元素与两段轻量动画，对移动端影响可忽略。

## 通用样式规范

### 卡片基础样式
```css
.card { 
  border: 1px solid var(--gray); 
  border-radius: 12px; 
  padding: 20px; 
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transition: all 0.2s ease;
}

.card:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.12);
  transform: translateY(-2px);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.card-title { 
  font-weight: 600; 
  font-size: 16px;
  color: var(--text); 
  margin: 0;
}

.card-icon {
  font-size: 24px;
  opacity: 0.7;
}
```

### 颜色规范
- **主要数据**：使用品牌色 `var(--brand)` (#8B0000)
- **正数变化**：使用绿色 `var(--hud-green)` (#00B37A)
- **负数变化**：使用红色 `var(--error)` (#FF4500)
- **普通副数据**：使用文本色 `var(--text)` (#111111)
- **标签文字**：使用灰色 `var(--muted)` (#666666)

### 字体规范
- **主要数据数值**：36px，粗体，行高1
- **主要数据标签**：16px，中等粗细
- **副数据数值**：20px（移动端）/ 24px（桌面端），中等粗细
- **副数据标签**：12px（移动端）/ 14px（桌面端），中等粗细

## 响应式设计

### 移动端（默认）
- 卡片宽度自适应屏幕宽度
- 副数据间距：20px
- 副数据字体：20px

### 桌面端（768px+）
- 卡片最大宽度：600px，居中显示
- 副数据间距：40px
- 副数据字体：24px

```css
@media (min-width: 768px) {
  .dashboard .cards {
    max-width: 600px;
    margin: 0 auto;
  }
  
  .sub-data {
    gap: 40px;
  }
  
  .sub-value {
    font-size: 24px;
  }
  
  .sub-label {
    font-size: 14px;
  }
}
```

## 布局容器

### 卡片容器
```css
.dashboard .cards { 
  display: grid; 
  grid-template-columns: 1fr; 
  gap: 16px; 
}
```

### 页面结构
```html
<section class="dashboard">
  <h1 class="title">仪表盘</h1>
  <div class="cards">
    <!-- 卡片内容 -->
  </div>
</section>
```

## 使用指南

### 创建新卡片步骤

1. **确定数据类型**：根据业务需求选择1种、2种或3种数据布局
2. **选择图标**：使用合适的emoji图标，建议使用📊📈📅📋等
3. **编写HTML**：按照对应的HTML结构模板编写
4. **应用样式**：确保使用正确的CSS类名
5. **测试响应式**：在不同屏幕尺寸下测试显示效果

### 数据计算建议

- **主要数据**：选择最核心的业务指标
- **副数据**：选择与主要数据相关的补充信息
- **数值格式**：百分比保留1位小数，其他数值根据精度需求确定
- **颜色应用**：正负变化使用颜色区分，普通数值使用默认颜色

## 示例实现

### 招募统计卡片

招募统计卡片展示招募流程的关键指标，采用1个主要数据 + 2个副数据的布局模式：

**后端数据计算：**
```python
def _calculate_dashboard_data():
    """计算仪表板数据"""
    now = get_current_utc_time()
    
    # 招募统计（使用本地时间进行日期归属，与招募日报保持一致）
    # 获取今日的本地时间范围
    current_local = utc_to_local(now)
    today_local_start = current_local.replace(hour=0, minute=0, second=0, microsecond=0)
    today_local_end = today_local_start + timedelta(days=1)
    
    # 转换为UTC时间范围
    today_start_utc = local_to_utc(today_local_start)
    today_end_utc = local_to_utc(today_local_end)
    
    # 今日约面：今日创建的招募数量
    recruit_today_appointments = Recruit.objects(created_at__gte=today_start_utc, created_at__lt=today_end_utc).count()
    
    # 今日到面：今日发生的面试决策数量（新六步制 + 历史兼容）
    from mongoengine import Q
    interviews_query = (
        Q(interview_decision_time__gte=today_start_utc, interview_decision_time__lt=today_end_utc) |
        Q(training_decision_time_old__gte=today_start_utc, training_decision_time_old__lt=today_end_utc)
    )
    recruit_today_interviews = Recruit.objects.filter(interviews_query).count()
    
    # 今日新开播：今日在开播决策中决定招募的数量（不招募不算）
    from models.recruit import BroadcastDecision
    new_recruits_query = (
        Q(broadcast_decision_time__gte=today_start_utc, broadcast_decision_time__lt=today_end_utc,
          broadcast_decision__in=[BroadcastDecision.OFFICIAL, BroadcastDecision.INTERN]) |
        Q(final_decision_time__gte=today_start_utc, final_decision_time__lt=today_end_utc,
          final_decision__in=[FinalDecision.OFFICIAL, FinalDecision.INTERN])
    )
    recruit_today_new_recruits = Recruit.objects.filter(new_recruits_query).count()
    
    return {
        # 招募统计
        'recruit_today_appointments': recruit_today_appointments,
        'recruit_today_interviews': recruit_today_interviews,
        'recruit_today_new_recruits': recruit_today_new_recruits,
    }
```

**前端模板：**
```html
<div class="card" id="recruitCard" style="cursor: pointer;">
  <div class="card-header">
    <div class="card-title">招募统计</div>
    <div class="card-icon">📋</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">{{ dashboard_data.recruit_today_appointments }}</div>
      <div class="main-label">今日约面</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value">{{ dashboard_data.recruit_today_interviews }}</div>
        <div class="sub-label">今日到面</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">{{ dashboard_data.recruit_today_new_recruits }}</div>
        <div class="sub-label">今日新开播</div>
      </div>
    </div>
  </div>
</div>
```

**交互功能：**
```javascript
// 设置招募统计卡片的点击事件
const recruitCard = document.getElementById('recruitCard');
if (recruitCard) {
  recruitCard.addEventListener('click', function() {
    window.location.href = '{{ url_for('recruit.recruit_daily_report') }}';
  });
}
```

**数据说明：**
- **今日约面**：基于Recruit模型的created_at字段，统计今日创建的招募记录数量
- **今日到面**：基于interview_decision_time字段（新六步制）或training_decision_time_old字段（历史兼容），统计今日完成面试决策的数量
- **今日新开播**：基于broadcast_decision_time和broadcast_decision字段（新六步制）或final_decision_time和final_decision字段（历史兼容），统计今日在开播决策中决定招募的数量
- **跳转功能**：点击卡片跳转到招募日报页面，提供更详细的招募数据分析
- **时间处理**：使用本地时间进行日期归属，然后转换为UTC时间进行数据库查询，确保与招募日报数据一致
- **历史数据兼容**：支持新六步制字段和历史废弃字段的查询，确保新旧数据都能正确统计

### 线下底薪流水转化率卡片

底薪流水转化率卡片展示线下开播的底薪投入回报效率，采用1个主要数据 + 2个副数据的布局模式：

**后端数据计算：**
```python
def calculate_dashboard_conversion_rate_metrics():
    """计算仪表盘底薪流水转化率统计。"""
    frames = _get_dashboard_time_frames()
    now_local = frames['now_local']
    
    # 计算截至昨日的转化率数据
    yesterday_local = now_local.replace(hour=0, minute=0, second=0, microsecond=0) - timedelta(days=1)
    
    # 本月转化率：按月报表算法，计算昨日所在月的所有线下开播记录的底薪流水转化率
    month_conversion = _calculate_month_conversion_rate(yesterday_local)
    
    # 昨日转化率：按日报表算法，计算昨日的所有线下开播记录的底薪流水转化率
    day_conversion = _calculate_day_conversion_rate(yesterday_local)
    
    # 上周转化率：按周报表算法，计算昨日所在周的上一周的所有线下开播记录的底薪流水转化率
    week_conversion = _calculate_week_conversion_rate(yesterday_local)
    
    return {
        'generated_at': frames['now_local'].strftime('%Y-%m-%d %H:%M:%S'),
        'month_conversion_rate': month_conversion,
        'yesterday_conversion_rate': day_conversion,
        'last_week_conversion_rate': week_conversion,
    }
```

**前端模板：**
```html
<div class="card" data-card-id="conversion-rate" data-default-link="{{ url_for('report.monthly_report') }}">
  <div class="card-header">
    <div class="card-title">线下底薪流水转化率</div>
    <div class="card-icon">💰</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value" data-field="month_conversion_rate">--</div>
      <div class="main-label">本月转化率</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value" data-field="yesterday_conversion_rate">--</div>
        <div class="sub-label">昨日转化率</div>
      </div>
      <div class="sub-item">
        <div class="sub-value" data-field="last_week_conversion_rate">--</div>
        <div class="sub-label">上周转化率</div>
      </div>
    </div>
  </div>
</div>
```

**交互功能：**
```javascript
function applyConversionRate(data, meta) {
  updateMeta(data.generated_at);
  if (fieldMap.month_conversion_rate) {
    const monthRate = data.month_conversion_rate;
    fieldMap.month_conversion_rate.textContent = monthRate !== null && monthRate !== undefined ? monthRate + '%' : '--';
  }
  if (fieldMap.yesterday_conversion_rate) {
    const yesterdayRate = data.yesterday_conversion_rate;
    fieldMap.yesterday_conversion_rate.textContent = yesterdayRate !== null && yesterdayRate !== undefined ? yesterdayRate + '%' : '--';
  }
  if (fieldMap.last_week_conversion_rate) {
    const weekRate = data.last_week_conversion_rate;
    fieldMap.last_week_conversion_rate.textContent = weekRate !== null && weekRate !== undefined ? weekRate + '%' : '--';
  }
  if (meta && meta.link) {
    setCardLink('conversion-rate', meta.link);
  }
}
```

**数据说明：**
- **本月转化率**：基于月报表算法，计算昨日所在自然月（1号至昨日）的所有线下开播记录的底薪流水转化率（流水金额总和 / 底薪金额总和 × 100%）
- **昨日转化率**：基于日报表算法，计算昨日（00:00:00 至 23:59:59）的所有线下开播记录的底薪流水转化率
- **上周转化率**：基于周报表算法，计算昨日所在周的上一周（周二至次周一）的所有线下开播记录的底薪流水转化率
- **计算口径**：仅统计线下开播记录（work_mode='offline'），不包含线上开播记录
- **转化率公式**：流水金额总和 / 底薪金额总和 × 100%，结果取整为百分比
- **数据缺失处理**：当底薪金额总和为0时，转化率显示为"--"
- **时间处理**：使用GMT+8本地时间进行日期归属，确保与各类报表的时间基准一致
- **数据时效**：所有数据计算截至昨日（当前日期前一自然日），避免今日数据的不完整性影响统计准确性
- **跳转功能**：点击卡片跳转到开播月报页面，提供更详细的月度统计数据分析

### 昨日主播排名卡片

昨日主播排名卡片展示昨日流水排名前三的主播，采用1个主要数据 + 2个副数据的布局模式：

**后端数据计算：**
```python
def calculate_dashboard_pilot_ranking_metrics():
    """计算仪表盘昨日主播排名统计。"""
    frames = _get_dashboard_time_frames()
    now_local = frames['now_local']
    
    # 计算昨日的时间范围
    yesterday_local = now_local.replace(hour=0, minute=0, second=0, microsecond=0) - timedelta(days=1)
    day_start = yesterday_local.replace(hour=0, minute=0, second=0, microsecond=0)
    day_end = yesterday_local.replace(hour=23, minute=59, second=59, microsecond=999999)
    
    # 获取昨日所有开播记录
    day_records = get_battle_records_for_date_range(day_start, day_end + timedelta(microseconds=1), owner_id=None, mode='all')
    
    # 按主播聚合流水
    pilot_revenue = {}
    for record in day_records:
        pilot_id = str(record.pilot.id)
        if pilot_id not in pilot_revenue:
            pilot_revenue[pilot_id] = {'pilot': record.pilot, 'total_revenue': Decimal('0')}
        pilot_revenue[pilot_id]['total_revenue'] += record.revenue_amount or Decimal('0')
    
    # 按流水降序排序
    sorted_pilots = sorted(pilot_revenue.values(), key=lambda x: x['total_revenue'], reverse=True)
    
    # 格式化主播信息
    def format_pilot_info(pilot_data):
        if not pilot_data:
            return '--'
        pilot = pilot_data['pilot']
        nickname = pilot.nickname or ''
        real_name = pilot.real_name or ''
        owner_name = pilot.owner.nickname if pilot.owner and pilot.owner.nickname else (pilot.owner.username if pilot.owner else '无')
        
        if real_name:
            return f"{nickname}（{real_name}）[{owner_name}]"
        return f"{nickname}[{owner_name}]"
    
    champion = format_pilot_info(sorted_pilots[0]) if len(sorted_pilots) > 0 else '--'
    second = format_pilot_info(sorted_pilots[1]) if len(sorted_pilots) > 1 else '--'
    third = format_pilot_info(sorted_pilots[2]) if len(sorted_pilots) > 2 else '--'
    
    return {
        'generated_at': frames['now_local'].strftime('%Y-%m-%d %H:%M:%S'),
        'champion': champion,
        'second_place': second,
        'third_place': third,
    }
```

**前端模板：**
```html
<div class="card" data-card-id="pilot-ranking">
  <div class="card-header">
    <div class="card-title">昨日主播排名</div>
    <div class="card-icon">🏆</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value" data-field="champion" style="font-size: 18px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">--</div>
      <div class="main-label">冠军</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value" data-field="second_place" style="font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">--</div>
        <div class="sub-label">亚军</div>
      </div>
      <div class="sub-item">
        <div class="sub-value" data-field="third_place" style="font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">--</div>
        <div class="sub-label">季军</div>
      </div>
    </div>
  </div>
</div>
```

**交互功能：**
```javascript
function applyPilotRanking(data, meta) {
  updateMeta(data.generated_at);
  if (fieldMap.champion) {
    fieldMap.champion.textContent = data.champion || '--';
    fieldMap.champion.title = data.champion || '';
  }
  if (fieldMap.second_place) {
    fieldMap.second_place.textContent = data.second_place || '--';
    fieldMap.second_place.title = data.second_place || '';
  }
  if (fieldMap.third_place) {
    fieldMap.third_place.textContent = data.third_place || '--';
    fieldMap.third_place.title = data.third_place || '';
  }
}
```

**数据说明：**
- **冠军**：昨日开播记录流水金额总和排名第一的主播，显示格式为"昵称（真实姓名）[直属运营昵称]"，如运营无昵称则显示用户名
- **亚军**：昨日开播记录流水金额总和排名第二的主播
- **季军**：昨日开播记录流水金额总和排名第三的主播
- **统计范围**：包含所有开播方式（线上+线下）的开播记录
- **排名逻辑**：按主播昨日所有开播记录的流水金额总和降序排列
- **数据展示**：使用文本溢出省略号处理过长的主播信息，鼠标悬停时显示完整信息（通过title属性）
- **字体大小**：冠军18px，亚军和季军14px，突出冠军地位
- **数据缺失处理**：当昨日无开播记录或主播数量不足时，对应位置显示"--"
- **时间处理**：使用GMT+8本地时间进行日期归属，统计昨日（当前日期前一自然日）的数据
- **直属运营显示**：优先显示直属运营的昵称（nickname），如昵称为空则降级显示用户名（username）

### 通告统计卡片

当前通告统计卡片的完整实现：

**后端数据计算：**
```python
def _calculate_dashboard_data():
    """计算仪表板数据"""
    now = get_current_utc_time()
    today_start = now.replace(hour=0, minute=0, second=0, microsecond=0)
    today_end = today_start + timedelta(days=1)
    yesterday_start = today_start - timedelta(days=1)
    yesterday_end = today_start
    week_start = today_start - timedelta(days=7)
    
    # 今日通告数量
    today_count = Announcement.objects(
        start_time__gte=today_start,
        start_time__lt=today_end
    ).count()
    
    # 昨日通告数量
    yesterday_count = Announcement.objects(
        start_time__gte=yesterday_start,
        start_time__lt=yesterday_end
    ).count()
    
    # 计算环比
    if yesterday_count > 0:
        change_rate = round(((today_count - yesterday_count) / yesterday_count) * 100, 1)
    else:
        change_rate = 100.0 if today_count > 0 else 0.0
    
    # 最近7天的日均通告数量
    week_count = Announcement.objects(
        start_time__gte=week_start,
        start_time__lt=today_end
    ).count()
    week_avg = round(week_count / 7, 1)
    
    return {
        'today_count': today_count,
        'change_rate': change_rate,
        'week_avg': week_avg
    }
```

**前端模板：**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">通告统计</div>
    <div class="card-icon">📊</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">{{ dashboard_data.today_count }}</div>
      <div class="main-label">今日通告</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value {% if dashboard_data.change_rate >= 0 %}positive{% else %}negative{% endif %}">
          {% if dashboard_data.change_rate >= 0 %}+{% endif %}{{ dashboard_data.change_rate }}%
        </div>
        <div class="sub-label">环比</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">{{ dashboard_data.week_avg }}</div>
        <div class="sub-label">7日平均</div>
      </div>
    </div>
  </div>
</div>
```

## 注意事项

1. **数据更新**：确保后端数据计算逻辑正确，特别是时间范围的计算
2. **性能考虑**：避免在仪表板中进行复杂的数据库查询
3. **错误处理**：当数据为空或异常时，提供合理的默认值
4. **可访问性**：确保颜色不是唯一的区分方式，配合文字说明
5. **国际化**：如果支持多语言，确保所有文字都可以本地化

### 开播记录统计卡片

开播记录统计卡片展示流水金额数据，采用1个主要数据 + 2个副数据的布局模式：

**后端数据计算：**
```python
def _calculate_dashboard_data():
    """计算仪表板数据"""
    now = get_current_utc_time()
    
    # 使用GMT+8本地时间进行日期归属，与招募日报保持一致
    current_local = utc_to_local(now)
    today_local_start = current_local.replace(hour=0, minute=0, second=0, microsecond=0)
    today_local_end = today_local_start + timedelta(days=1)
    yesterday_local_start = today_local_start - timedelta(days=1)
    yesterday_local_end = today_local_start
    week_local_start = today_local_start - timedelta(days=7)
    
    # 转换为UTC时间范围进行数据库查询
    today_start_utc = local_to_utc(today_local_start)
    today_end_utc = local_to_utc(today_local_end)
    yesterday_start_utc = local_to_utc(yesterday_local_start)
    yesterday_end_utc = local_to_utc(yesterday_local_end)
    week_start_utc = local_to_utc(week_local_start)
    
    # 开播记录统计（流水金额统计）
    # 今日流水（所有开播记录中的开始日期为今天的开播记录的流水总和）
    br_today_records = BattleRecord.objects(start_time__gte=today_start_utc, start_time__lt=today_end_utc)
    br_today_revenue = sum(record.revenue_amount for record in br_today_records)
    
    # 昨日流水
    br_yesterday_records = BattleRecord.objects(start_time__gte=yesterday_start_utc, start_time__lt=yesterday_end_utc)
    br_yesterday_revenue = sum(record.revenue_amount for record in br_yesterday_records)
    
    # 7日平均流水
    br_week_records = BattleRecord.objects(start_time__gte=week_start_utc, start_time__lt=today_end_utc)
    br_week_revenue = sum(record.revenue_amount for record in br_week_records)
    br_week_avg_revenue = br_week_revenue / 7
    
    return {
        # 开播记录统计
        'battle_today_revenue': br_today_revenue,
        'battle_yesterday_revenue': br_yesterday_revenue,
        'battle_week_avg_revenue': br_week_avg_revenue,
    }
```

**前端模板：**
```html
<div class="card" id="battleRecordCard" style="cursor: pointer;">
  <div class="card-header">
    <div class="card-title">开播记录统计</div>
    <div class="card-icon">📈</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">{{ "{:,.0f}".format(dashboard_data.battle_today_revenue) }}</div>
      <div class="main-label">今日流水（元）</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value">{{ "{:,.0f}".format(dashboard_data.battle_yesterday_revenue) }}</div>
        <div class="sub-label">昨日流水</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">{{ "{:,.0f}".format(dashboard_data.battle_week_avg_revenue) }}</div>
        <div class="sub-label">7日平均流水</div>
      </div>
    </div>
  </div>
</div>
```

**交互功能：**
```javascript
// 设置开播记录统计卡片的点击事件
const battleRecordCard = document.getElementById('battleRecordCard');
if (battleRecordCard) {
  battleRecordCard.addEventListener('click', function() {
    window.location.href = '{{ url_for('report.daily_report') }}';
  });
}
```

**数据格式说明：**
- **金额显示**：使用千分位格式化 `"{:,.0f}".format()` 显示金额
- **单位标识**：主数据标签包含"（元）"单位说明
- **精度控制**：不保留小数，显示整数金额
- **数据来源**：基于BattleRecord模型的revenue_amount字段计算
- **时间处理**：使用GMT+8本地时间进行日期归属，确保与招募日报等模块的时间基准一致
- **交互功能**：点击卡片跳转到开播日报页面，提供更详细的作战数据分析

## 时间处理规范

### 统一时间处理原则

仪表板中的所有统计数据都遵循统一的时间处理规范：

1. **日期归属**：使用GMT+8本地时间进行日期归属
2. **数据库查询**：将本地时间转换为UTC时间进行数据库查询
3. **时间转换**：使用 `utils/timezone_helper.py` 中的 `utc_to_local()` 和 `local_to_utc()` 函数
4. **一致性保证**：与招募日报、开播日报等模块保持时间基准一致

### 时间处理流程

```python
# 1. 获取当前UTC时间
now = get_current_utc_time()

# 2. 转换为GMT+8本地时间
current_local = utc_to_local(now)

# 3. 计算本地时间的日期范围
today_local_start = current_local.replace(hour=0, minute=0, second=0, microsecond=0)
today_local_end = today_local_start + timedelta(days=1)

# 4. 转换为UTC时间范围进行数据库查询
today_start_utc = local_to_utc(today_local_start)
today_end_utc = local_to_utc(today_local_end)

# 5. 执行数据库查询
records = Model.objects(start_time__gte=today_start_utc, start_time__lt=today_end_utc)
```

### 时间处理的重要性

- **数据一致性**：确保不同模块的统计数据基于相同的时间基准
- **用户体验**：用户看到的"今日"、"昨日"等概念与实际业务时间一致
- **业务逻辑**：符合业务运营的时间概念，避免时区混乱
