# 主播-主播招募（原“机师-机师征召”）

> 术语统一记录（2025-09-26）
> - 历史用语→统一用语：机师→主播；舰长→运营；议长→管理员；征召→招募；训练→试播；参战形式→开播方式；战区→开播地点；阶级→主播分类；所属→直属运营；训练机师→试播主播；正式机师→正式主播；实习机师→实习主播；作战记录→开播记录；预约训练→预约试播；待训练→待试播；训练征召→试播招募；训练决策→试播决策。
> - 本次复核（2025-09-26）：已完成逐段术语检查，正文采用统一用语；数据库/接口字段仍保留历史命名，仅以字段标注说明。
主播-招募用于管理对"未招募"主播发起的面试/招募流程工单。该模块仅支持从"主播详情页"的"启动招募"按钮进入创建流程，不支持独立新建空白招募。

招募流程采用六步制：待面试 -> 待预约试播 -> 待试播 -> 待预约开播 -> 待开播 -> 已结束，确保招募决策的严谨性和数据完整性。每个步骤的流转、变化（决策时间、决策人、决策结果）都需要在数据库中详细记录，不再允许用户直接在编辑界面修改当前的招募状态。

## 流程映射与兼容性

### 新六步制流程（统一用语）
1. **待面试**：预约面试时间，等待面试结果
2. **待预约试播**：面试通过，等待登记试播时间
3. **待试播**：已预约试播时间，等待试播结果
4. **待预约开播**：试播通过，等待登记开播时间
5. **待开播**：已预约开播时间，等待开播结果
6. **已结束**：招募流程的最终状态

### 与旧三步制的映射关系
- **旧版"已启动"** → **新版"待面试"**：完全对应
- **旧版"试播招募中"** → **新版"待试播"**：旧版试播招募决策时间同时作为新版预约试播时间和试播时间
- **旧版"已结束"** → **新版"已结束"**：完全对应，旧版结束招募决策时间同时作为新版预约开播时间和开播时间

### 历史数据兼容性处理

#### 状态映射
- 对于已存在的"已启动"状态数据，系统读取时将其映射为"待面试"状态
- 对于已存在的"试播招募中"状态数据，系统读取时将其映射为"待试播"状态
- 对于已存在的"已结束"状态数据，系统读取时直接映射为"已结束"状态

#### 字段降级读取
- 系统在读取历史数据时，优先使用新字段，如果新字段为空则从废弃字段降级读取
- 降级读取遵循"字段降级读取策略"中定义的规则
- 确保历史数据在新版界面中能正确显示和操作

#### 数据迁移建议
- 建议在系统升级时运行数据迁移脚本，将废弃字段的数据迁移到新字段
- 迁移完成后，废弃字段可以保留一段时间作为备份，最终可以删除
- 迁移过程中需要确保数据的完整性和一致性

## 重要约定（统一用语）

- 数据库存储的所有日期时间均为UTC；界面显示与输入均为GMT+8，必须严格遵守。
- 仅当主播当前状态为“未招募”时，主播详情页底部操作区显示并启用“启动招募”按钮。
- 招募对象唯一，且从主播详情页携带主播ID跳转；禁止无对象创建。
- CSRF：所有表单必须包含隐藏字段提交CSRF Token，严格参考现有模块写法。
- 日志：本模块的日志按自然日滚动，写入 `./log` 目录，必要时使用INFO，复杂流程留足DEBUG（中文）。

## 元数据

| 字段 | 说明（统一用语显示，不改字段名） | 参考类型 | 设定 |
|---------|------|------|------|
| ID | 系统内部唯一编码，用户不可见 | 由技术设计 | 必须 唯一 |
| 主播（字段：pilot） | 被招募的主播 | 关联到主播唯一ID | 必须，仅展示不可编辑 |
| 招募负责人（字段：recruiter） | 负责该招募的运营 | 关联到用户唯一ID | 必须，默认=当前用户 |
| 预约时间 | 与主播约定的面试时间 | 时间戳UTC | 必须，默认=次日16:00（按GMT+8取值，入库UTC） |
| 渠道 | BOSS / 51 / 介绍 / 其他 | 枚举 | 必须 |
| 介绍费 | 人民币元，两位小数 | 数值 | 必须，默认=0 |
| 备注 | 补充信息 | 字符串 | 可选，≤200字 |
| 招募状态（字段：status） | 待面试 / 待预约试播 / 待试播 / 待预约开播 / 待开播 / 已结束 | 枚举 | 必须，默认=待面试 |
| 面试决策（字段：interview_decision） | 预约试播 / 不招募 | 枚举 | 可选，待面试步骤填写 |
| 面试决策人（字段：interview_decision_maker） | 做出面试决策的运营 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 面试决策时间 | 面试决策的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 预约试播时间（字段：scheduled_training_time） | 与主播约定的试播时间 | 时间戳UTC | 可选，待预约试播步骤填写 |
| 预约试播决策人（字段：scheduled_training_decision_maker） | 登记试播时间的运营 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 预约试播决策时间（字段：scheduled_training_decision_time） | 登记试播时间的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 试播决策（字段：training_decision） | 预约开播 / 不招募 | 枚举 | 可选，待试播步骤填写 |
| 试播决策人（字段：training_decision_maker） | 做出试播决策的运营 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 试播决策时间（字段：training_decision_time） | 试播决策的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 预约开播时间 | 与主播约定的首次开播时间 | 时间戳UTC | 可选，待预约开播步骤填写 |
| 预约开播决策人（字段：scheduled_broadcast_decision_maker） | 登记开播时间的运营 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 预约开播决策时间 | 登记开播时间的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 开播决策（字段：broadcast_decision） | 正式主播 / 实习主播 / 不招募 | 枚举 | 可选，待开播步骤填写 |
| 开播决策人（字段：broadcast_decision_maker） | 做出开播决策的运营 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 开播决策时间 | 开播决策的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 变更记录 | 记录上述字段的所有修改日志（哪个用户什么时间把什么字段的值从什么改成了什么，修改时使用的IP地址是什么） | 由独立模型持久化（非嵌入JSON） | 非必须 |
| 创建时间 | 创建记录的时间 | 时间戳 | 必须，默认=当前UTC |
| 最后修改 | 最近一次修改时间 | 时间戳 | 必须，默认=当前UTC |

### 废弃字段（历史兼容）

| 废弃字段 | 对应新字段 | 废弃原因 | 降级读取规则 |
|---------|---------|---------|-------------|
| 试播招募决策 | 面试决策 + 试播决策 | 拆分为两个独立的决策步骤 | 根据招募状态判断：<br/>- 状态=待试播：试播招募决策→试播决策<br/>- 状态=已结束：试播招募决策→面试决策 |
| 试播招募决策人 | 面试决策人 + 试播决策人 | 拆分为两个独立的决策人 | 同时填充到两个新字段 |
| 试播招募决策时间 | 面试决策时间 + 试播决策时间 | 拆分为两个独立的决策时间 | 同时填充到两个新字段 |
| 试播时间 | 预约试播时间 | 字段名称变更 | 直接映射 |
| 结束招募决策 | 开播决策 | 字段名称变更 | 直接映射 |
| 结束招募决策人 | 开播决策人 | 字段名称变更 | 直接映射 |
| 结束招募决策时间 | 开播决策时间 | 字段名称变更 | 直接映射 |

### 字段降级读取策略

#### 状态相关的降级读取规则

**待面试状态**：
- 无降级读取需求（新字段为空是正常的）

**待预约试播状态**：
- 面试决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）

**待试播状态**：
- 面试决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）
- 预约试播时间：从废弃字段"试播时间"读取（如果新字段为空）

**待预约开播状态**：
- 面试决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）
- 预约试播时间：从废弃字段"试播时间"读取（如果新字段为空）
- 试播决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 试播决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 试播决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）

**待开播状态**：
- 面试决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）
- 预约试播时间：从废弃字段"试播时间"读取（如果新字段为空）
- 试播决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 试播决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 试播决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）
- 预约开播时间：从废弃字段"试播时间"读取（如果新字段为空）

**已结束状态**：
- 面试决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）
- 预约试播时间：从废弃字段"试播时间"读取（如果新字段为空）
- 试播决策：从废弃字段"试播招募决策"读取（如果新字段为空）
- 试播决策人：从废弃字段"试播招募决策人"读取（如果新字段为空）
- 试播决策时间：从废弃字段"试播招募决策时间"读取（如果新字段为空）
- 预约开播时间：从废弃字段"试播时间"读取（如果新字段为空）
- 开播决策：从废弃字段"结束招募决策"读取（如果新字段为空）
- 开播决策人：从废弃字段"结束招募决策人"读取（如果新字段为空）
- 开播决策时间：从废弃字段"结束招募决策时间"读取（如果新字段为空）

### 状态流转

#### 新六步制状态流转
- **创建**：状态=待面试
- **面试决策（预约试播）**：状态→待预约试播
- **面试决策（不招募）**：状态→已结束，同时对主播执行：状态→不招募
- **预约试播**：状态→待试播
- **试播决策（预约开播）**：状态→待预约开播
- **试播决策（不招募）**：状态→已结束，同时对主播执行：状态→不招募
- **预约开播**：状态→待开播
- **开播决策（正式主播）**：状态→已结束，同时对主播执行：主播分类→正式主播；状态→已招募
- **开播决策（实习主播）**：状态→已结束，同时对主播执行：主播分类→实习主播；状态→已招募
- **开播决策（不招募）**：状态→已结束，同时对主播执行：状态→不招募

#### 历史数据兼容性状态映射
- **旧版"已启动"** → **新版"待面试"**：直接映射
- **旧版"试播招募中"** → **新版"待试播"**：系统读取时自动映射
- **旧版"已结束"** → **新版"已结束"**：直接映射

#### 状态流转限制
- 用户不再允许直接在编辑界面修改招募状态
- 所有状态变更必须通过相应的决策步骤进行
- 系统自动记录每次状态变更的决策人、决策时间和决策结果

## 入口与导航（统一用语）

- 在主菜单新增“主播招募”入口，进入招募列表页。
- 主播详情页（状态=未招募）底部footbar显示“启动招募”按钮；点击跳转到“启动招募”页面（唯一入口）。

## 创建与编辑

### 启动招募（创建）
- 页面上部以卡片展示主播关键信息（昵称、性别/年龄、直属运营、当前主播分类与状态）。
- 表单字段：
  - 招募负责人（选择运营；默认=当前用户）
  - 预约时间（日期时间；默认=次日16:00，显示为GMT+8，入库UTC）
  - 渠道（枚举：BOSS / 51 / 介绍 / 其他；按该顺序显示）
  - 介绍费（人民币元；默认=0；两位小数）
  - 备注（可选）
  - 招募状态（默认=待面试，不在创建页中暴露为可编辑项）
-- 校验：
  - 招募负责人不可为空且必须是运营或以上权限。
  - 预约时间必填；入库前将GMT+8转换为UTC。
  - 渠道为枚举值；介绍费需为有效的非负金额（两位小数）。
  - CSRF Token 必须通过隐藏字段提交。
- footbar：
  - 左：返回
  - 右：创建（btn-primary）

### 编辑招募

编辑招募页面根据当前招募状态动态调整可编辑字段，随着流程推进，可编辑的信息逐渐增加，确保数据的完整性和流程的严谨性。

#### 状态相关的编辑权限

**待面试状态**：
- 可编辑字段：招募负责人、预约时间、渠道、介绍费、备注
- 只读字段：招募状态、所有决策相关字段
- 界面提示："当前处于待面试阶段，可编辑基础招募信息"

**待预约试播状态**：
- 可编辑字段：招募负责人、预约时间、渠道、介绍费、备注、面试决策
- 只读字段：招募状态、面试决策人、面试决策时间、试播相关字段、开播相关字段
- 界面提示："当前处于待预约试播阶段，可编辑基础信息和面试决策信息"

**待试播状态**：
- 可编辑字段：招募负责人、预约时间、渠道、介绍费、备注、面试决策、预约试播时间
- 只读字段：招募状态、面试决策人、面试决策时间、预约试播决策人、预约试播决策时间、试播决策相关字段、开播相关字段
- 界面提示："当前处于待试播阶段，可编辑基础信息、面试决策信息和试播预约信息"

**待预约开播状态**：
- 可编辑字段：招募负责人、预约时间、渠道、介绍费、备注、面试决策、预约试播时间、试播决策
- 只读字段：招募状态、面试决策人、面试决策时间、预约试播决策人、预约试播决策时间、试播决策人、试播决策时间、开播相关字段
- 界面提示："当前处于待预约开播阶段，可编辑基础信息、面试决策信息、试播预约信息和试播决策信息"

**待开播状态**：
- 可编辑字段：招募负责人、预约时间、渠道、介绍费、备注、面试决策、预约试播时间、试播决策、预约开播时间
- 只读字段：招募状态、面试决策人、面试决策时间、预约试播决策人、预约试播决策时间、试播决策人、试播决策时间、预约开播决策人、预约开播决策时间、开播决策相关字段
- 界面提示："当前处于待开播阶段，可编辑基础信息、面试决策信息、试播预约信息、试播决策信息和开播预约信息"

**已结束状态**：
- 可编辑字段：无（所有字段只读展示）
- 只读字段：所有字段
- 界面提示："招募流程已结束，所有信息仅可查看，不可编辑"

#### 编辑界面设计（统一用语）

- 页面顶部展示主播信息卡片（始终只读）
- **招募状态字段始终只读**，显示当前流程进度，不可手动修改
- 招募状态只能通过决策步骤进行流转，编辑页面不提供状态修改功能
- 根据当前状态动态显示可编辑字段组
- 不可编辑的字段组以灰色背景显示，并标注"仅查看"
- 表单验证：只对当前可编辑的字段进行必填验证
- 保存逻辑：只更新当前状态允许编辑的字段
- 变更记录：记录所有字段修改的操作日志

#### 校验与保存

- 基础信息校验：同创建页面
- 决策信息校验：根据当前状态验证相应的决策字段
- 时间校验：确保决策时间不早于创建时间，不晚于当前时间
- 保存限制：只保存当前状态允许编辑的字段
- 变更记录：记录字段级变更（时间、操作者、前值、后值、IP）

## 列表

- 菜单入口进入列表，默认筛选"招募状态=进行中"（包含待面试、待预约试播、待试播、待预约开播、待开播）。
- 筛选器：
  - 状态（进行中（默认）/ 鸽 / 已结束）
    - 进行中 = 不属于鸽分组 也 不属于已结束分组
    - 鸽 = 只显示鸽分组
    - 已结束 = 只显示已结束分组
- 快速跳转按钮组：位于筛选器下方，根据分组数据动态显示
  - 只有分组中存在数据时，才显示对应的快速跳转按钮
  - 按钮标签：待面试、待预约试播、待试播、待预约开播、待开播、鸽、已结束
  - 点击按钮快速滚动到对应分组位置
- 分组显示：招募列表按以下规则分组显示
  - **待面试**：状态=待面试 且 预约时间未过期超过24小时
    - 排序：按预约时间升序（即将到期的优先）
  - **待预约试播**：状态=待预约试播 且 面试决策时间未超过7天
    - 排序：按面试决策时间逆序（最新的优先）
  - **待试播**：状态=待试播 且 预约试播时间未超过24小时
    - 排序：按预约试播时间升序（即将到期的优先）
  - **待预约开播**：状态=待预约开播 且 试播决策时间未超过7天
    - 排序：按试播决策时间逆序（最新的优先）
  - **待开播**：状态=待开播 且 预约开播时间未超过24小时
    - 排序：按预约开播时间升序（即将到期的优先）
  - **鸽**：以下任一条件满足（此分组独立显示，不与其他分组同时出现）
    - 状态=待面试 且 预约时间过期超过24小时
    - 状态=待预约试播 且 面试决策时间超过7天
    - 状态=待试播 且 预约试播时间过期超过24小时
    - 状态=待预约开播 且 试播决策时间超过7天
    - 状态=待开播 且 预约开播时间过期超过24小时
    - 排序：先按状态为第一排序关键字排序（顺序符合状态的流转顺序），再按招募信息的最后更新时间逆序（最多100条）
  - **已结束**：状态=已结束（此分组独立显示，不与其他分组同时出现）
    - 排序：按招募信息的最后更新时间逆序（最多100条）
- 列表项字段显示应根据当前的状态显示不同的内容：
  - **待面试**：
    - 预约时间（GMT+8显示），左上角，如果已经超时显示为红色
    - 主播昵称（真名），右上角
    - 招募负责人昵称，右上角小字
    - 招募状态：左下角，与箭头同一行
  - **待预约试播**：
    - 面试决策时间（GMT+8显示），左上角
    - 主播昵称（真名），右上角
    - 招募负责人昵称，右上角小字
    - 招募状态：左下角，与箭头同一行
  - **待试播**：
    - 预约试播时间（GMT+8显示），左上角，如果已经超时显示为红色
    - 主播昵称（真名），右上角
    - 招募负责人昵称，右上角小字
    - 招募状态：左下角，与箭头同一行
  - **待预约开播**：
    - 试播决策时间（GMT+8显示），左上角
    - 主播昵称（真名），右上角
    - 招募负责人昵称，右上角小字
    - 招募状态：左下角，与箭头同一行
  - **待开播**：
    - 预约开播时间（GMT+8显示），左上角，如果已经超时显示为红色
    - 主播昵称（真名），右上角
    - 招募负责人昵称，右上角小字
    - 招募状态：左下角，与箭头同一行
  - **已结束**：
    - 最后修改时间（GMT+8显示），左上角
    - 主播昵称（真名），右上角
    - 招募负责人昵称，右上角小字
    - 招募状态：左下角，与箭头同一行

- 交互：点击卡片进入招募详情。
- 浮动按钮：当页面滚动到下方，快速跳转按钮不可见时，在右下角显示浮动的"回到顶部"按钮。
- 空状态：显示友好提示与返回入口按钮。

## 详情

- 展示全部字段与主播信息卡片，按阶段分组显示信息。
- 信息分组结构：
  - **基本信息**：招募负责人、预约时间、招募渠道、介绍费、招募状态、备注
  - **面试阶段**：面试决策、面试决策人[角色]、面试决策时间（GMT+8）
  - **试播预约阶段**：预约试播时间、预约试播决策人[角色]、预约试播决策时间（GMT+8）
  - **试播阶段**：试播决策、试播决策人[角色]、试播决策时间（GMT+8）
  - **开播预约阶段**：预约开播时间、预约开播决策人[角色]、预约开播决策时间（GMT+8）
  - **开播阶段**：开播决策、开播决策人[角色]、开播决策时间（GMT+8）
  - **历史数据**：试播招募决策（历史）、试播时间（历史）、结束招募决策（历史）
  - **系统信息**：创建时间、最后修改时间
- 条件显示：只有已发生的阶段才显示对应的信息分组
- 角色显示：决策人信息显示为"昵称[角色]"格式，角色使用中文（运营/管理员）
- 时间显示：所有决策时间使用GMT+8时区显示
- 底部footbar按钮：编辑 / 面试决策 / 预约试播 / 试播决策 / 预约开播 / 开播决策 / 变更记录。
- 按钮可用性：
  - 当"招募状态=待面试"时，显示"面试决策"按钮，隐藏其他决策按钮。
  - 当"招募状态=待预约试播"时，显示"预约试播"按钮，隐藏其他决策按钮。
  - 当"招募状态=待试播"时，显示"试播决策"按钮，隐藏其他决策按钮。
  - 当"招募状态=待预约开播"时，显示"预约开播"按钮，隐藏其他决策按钮。
  - 当"招募状态=待开播"时，显示"开播决策"按钮，隐藏其他决策按钮。
  - 当"招募状态=已结束"时，隐藏所有招募操作按钮，仅显示"编辑"和"变更记录"按钮。
- 变更记录：弹窗展示最近100条变更记录，按变更发生的时间逆序排列。

  注：前端通过调用 GET `/recruits/<recruit_id>/changes` 获取JSON数据并渲染弹窗。

### 返回按钮逻辑

#### 来源识别
- **来源参数**：通过URL参数 `from` 识别页面来源
- **来源类型**：
  - `recruit_list`：从招募列表页面进入（默认）
  - `recruit_report_detail`：从招募日报详情页面进入

#### 返回按钮显示
- **默认情况**（`from=recruit_list` 或无 `from` 参数）：
  - 页面左上角显示"返回招募列表"按钮
  - 点击后返回到招募列表页面
- **从日报详情进入**（`from=recruit_report_detail`）：
  - 页面左上角显示"返回日报详情"按钮
  - 点击后返回到对应的招募日报详情页面
  - 需要携带日报详情页面的参数（`date`、`range`、`metric`）

#### URL参数传递
- **从日报详情跳转**：`/recruits/{recruit_id}?from=recruit_report_detail&report_date={date}&report_range={range}&report_metric={metric}`
- **返回日报详情**：`/recruit-reports/daily/detail?date={report_date}&range={report_range}&metric={report_metric}`

#### 实现要点
- **参数验证**：验证 `from` 参数的有效性
- **参数保存**：在页面中保存日报详情页面的参数，用于返回时使用
- **URL构建**：根据来源类型动态构建返回URL
- **用户体验**：确保返回路径的连续性和一致性

## 面试决策

- 页面顶部展示主播信息卡片。
- 表单：
  - 面试决策人（当前用户，只读展示，不可编辑）
  - 面试决策（预约试播 / 不招募）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 当选择"预约试播"时，需要填写主播基本信息：
  - 真实姓名（必填，最大20字符）
  - 出生年（必填，距今60年前-距今10年前）
- 提示文案：
  - "该主播的主播分类将自动变更为试播主播"
  - "该主播的状态将自动变更为已招募"
- 用户点击"确认"后：
  - 将该招募状态改为"待预约试播"（选择预约试播）或"已结束"（选择不招募）。
  - 系统自动记录：面试决策人=当前用户，面试决策时间=当前UTC时间。
  - 更新主播：主播分类→试播主播；状态→已招募；同时更新主播的基本信息（真实姓名、出生年、开播方式）。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 预约试播

- 页面顶部展示主播信息卡片。
- 表单：
  - 预约试播决策人（当前用户，只读展示，不可编辑）
  - 预约试播时间（日期时间；必填，显示为GMT+8，入库UTC）
    - 默认时间：当前GMT+8时间向后一个半点或整点取整
    - 时区处理：使用utc_to_local函数确保时间计算基于GMT+8时区
  - 开播方式（必填，线下 / 线上 / 未知）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 用户点击"确认"后：
  - 将该招募状态改为"待试播"。
  - 系统自动记录：预约试播决策人=当前用户，预约试播决策时间=当前UTC时间。
  - 写入相应变更记录与操作日志。
  - 更新主播：开播方式 = 选择的开播方式
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 试播决策

- 页面顶部展示主播信息卡片。
- 表单：
  - 试播决策人（当前用户，只读展示，不可编辑）
  - 试播决策（预约开播 / 不招募）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 用户点击"确认"后：
  - 将该招募状态改为"待预约开播"（选择预约开播）或"已结束"（选择不招募）。
  - 系统自动记录：试播决策人=当前用户，试播决策时间=当前UTC时间。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 预约开播

- 页面顶部展示主播信息卡片。
- 表单：
  - 预约开播决策人（当前用户，只读展示，不可编辑）
  - 预约开播时间（日期时间；必填，显示为GMT+8，入库UTC）
    - 默认时间：当前GMT+8时间向后一个半点或整点取整
    - 时区处理：使用utc_to_local函数确保时间计算基于GMT+8时区
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 用户点击"确认"后：
  - 将该招募状态改为"待开播"。
  - 系统自动记录：预约开播决策人=当前用户，预约开播决策时间=当前UTC时间。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 开播决策

- 页面顶部展示主播信息卡片。
- 表单：
  - 开播决策人（当前用户，只读展示，不可编辑）
  - 开播决策（正式主播 / 实习主播 / 不招募）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 当选择"正式主播"或"实习主播"时，需要填写主播分配信息：
  - 直属运营（必填，从所有运营/管理员中选择）
  - 开播地点（必填，快手 / 抖音 / 其他 / 未知）
  - 主播分类将根据招募决策自动设置（正式主播决策→正式主播主播分类，实习主播决策→实习主播主播分类）
- 提示文案：
  - "该主播的主播分类将自动变更为选择的主播分类"
  - "该主播的状态将自动变更为已招募"
- 用户点击"确认"后：
  - 将该招募状态改为"已结束"。
  - 系统自动记录：开播决策人=当前用户，开播决策时间=当前UTC时间。
  - 更新主播：主播分类→根据决策自动设置；状态→已招募；直属运营→选择的运营；开播地点→选择的开播地点。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 历史数据兼容性

### 数据迁移策略
- **旧版"已启动"状态**：直接映射为"启动招募"状态，无需额外处理
- **旧版"试播招募中"状态**：映射为"待试播"状态，同时：
  - 将`试播招募决策时间`同时填充到`预约试播决策时间`和`试播决策时间`
  - 将`试播招募决策人`同时填充到`预约试播决策人`和`试播决策人`
  - 将`试播时间`填充到`预约试播时间`
- **旧版"已结束"状态**：直接映射为"已结束"状态，无需额外处理

### 字段映射规则
| 旧版字段 | 新版字段 | 映射规则 |
|---------|---------|---------|
| 招募状态="已启动" | 招募状态="待面试" | 直接映射 |
| 招募状态="试播招募中" | 招募状态="待试播" | 直接映射 |
| 招募状态="已结束" | 招募状态="已结束" | 直接映射 |
| 试播招募决策时间 | 预约试播决策时间 + 试播决策时间 | 同时填充 |
| 试播招募决策人 | 预约试播决策人 + 试播决策人 | 同时填充 |
| 试播时间 | 预约试播时间 | 直接映射 |
| 结束招募决策时间 | 预约开播决策时间 + 开播决策时间 | 同时填充 |
| 结束招募决策人 | 预约开播决策人 + 开播决策人 | 同时填充 |
| 试播招募决策 | 面试决策 + 试播决策 | 根据决策内容映射 |
| 结束招募决策 | 开播决策 | 直接映射 |

### 兼容性处理实现
- 系统在读取历史数据时自动进行状态映射
- 历史数据在界面中正确显示，用户可以进行相应的操作
- 确保历史招募记录在新版界面中的完整性和可操作性
- 所有历史决策记录都保持完整的审计轨迹
- 当且仅当用户主动操作历史数据时才会按照最新版设计修改历史数据的mongodb文档，读取时并不会对历史数据进行移行操作

## 权限

- 管理员、运营：权限一致，均可见且可写（不限制直属运营）。
- 其他角色：遵循项目统一的权限策略（由技术实现）。

## UI与交互规范

- 参考《基础-UI风格》与《主播-开播记录》：
  - 移动优先、卡片列表、footbar吸附式操作按钮。
  - 主要按钮使用ZAFT红；禁用态灰色描边。
  - 表单组间距与输入框样式与既有模块保持一致。
- 时间显示统一使用Jinja2过滤器（如已有：local_datetime、local_date）。
- 列表卡片整体可点击，悬停/触摸有上浮与阴影反馈。

### 状态相关的界面设计

#### 编辑页面状态指示
- 页面顶部显示当前招募状态和流程进度条
- 状态进度条：待面试 → 待预约试播 → 待试播 → 待预约开播 → 待开播 → 已结束
- 当前状态高亮显示，已完成状态显示为绿色，未到达状态显示为灰色

#### 字段组显示规则
- **可编辑字段组**：白色背景，正常表单样式，支持用户交互
- **只读字段组**：浅灰色背景（#f8f9fa），字段标签显示"（仅查看）"，输入框禁用
- **字段组标题**：根据当前状态动态显示，如"基础信息"、"面试决策信息"、"试播预约信息"等

#### 表单验证与提示
- 动态验证：只对当前状态可编辑的字段进行必填验证
- 状态提示：在页面顶部显示当前状态的操作提示文案
- 保存按钮：根据当前状态显示"保存修改"或"仅查看"（已结束状态）

#### 按钮动态显示规则
- **详情页按钮**：根据招募状态动态显示相应的操作按钮
  - 待面试：显示"编辑"、"面试决策"、"变更记录"
  - 待预约试播：显示"编辑"、"预约试播"、"变更记录"
  - 待试播：显示"编辑"、"试播决策"、"变更记录"
  - 待预约开播：显示"编辑"、"预约开播"、"变更记录"
  - 待开播：显示"编辑"、"开播决策"、"变更记录"
  - 已结束：显示"编辑"、"变更记录"
- **决策页按钮**：所有决策页面都显示"编辑"、"变更记录"按钮
- **按钮样式**：所有显示的按钮都使用正常样式，不显示置灰状态

#### 响应式设计
- 移动端：字段组垂直排列，状态进度条横向滚动
- 桌面端：字段组可并排显示，状态进度条完整展示
- 字段组切换：支持折叠/展开，提升页面可读性

## 技术实现要点

- 时间处理：统一使用 `utils/timezone_helper.py` 的转换方法，确保"数据库UTC，UI GMT+8"。
- 模板：复用现有表单分组与footbar组件；CSRF Token 使用隐藏字段，遵循既有模板写法（如 `{{ csrf_token() }}`）。
- 日志：按模块输出到 `./log/recruit_YYYYMMDD.log`（命名示例），INFO用于关键节点，复杂流程用DEBUG。
- 排序与筛选：后端按筛选条件查询，默认状态=进行中（包含待面试+待预约试播+待试播+待预约开播+待开播）；按分组规则和排序方式返回，分页按需实现（与既有模块一致）。
- 分组显示实现：根据招募状态和时间条件动态分组，每个分组独立排序。
- 快速跳转按钮：根据分组数据动态显示，提供平滑滚动到对应分组的交互体验。
- 浮动回到顶部按钮：监听页面滚动位置，当快速跳转按钮不可见时显示浮动按钮。
- 变更记录：记录字段级变更（时间、操作者、前值、后值、IP）。
- 变更记录API：提供 GET `/recruits/<recruit_id>/changes` 接口返回JSON格式的变更记录数据。
- 变更记录模型：RecruitChangeLog独立模型，支持字段级变更追踪和显示名称映射。
- 主播数据更新：通过主播管理模块提供的API方法更新主播信息，确保操作的原子性：
  - 面试决策时调用主播管理模块的更新方法，设置主播分类、状态、基本信息。
  - 开播决策时调用主播管理模块的更新方法，设置主播分类（根据决策自动设置）、状态、直属运营、开播地点。
- 数据校验：在招募模块中完成必要的数据收集和校验，避免跨模块的复杂依赖。
- 状态流转控制：实现严格的状态流转控制，确保用户只能通过相应的决策步骤进行状态变更。
- 决策记录自动化：所有决策人和决策时间字段由系统自动记录，不可用户编辑。
  - 决策人记录：在用户执行决策操作时，自动记录当前用户ID
  - 决策时间记录：在用户执行决策操作时，自动记录当前UTC时间
  - 审计完整性：确保所有决策都有完整的操作者身份和时间戳记录
  - 防篡改保护：决策人和决策时间字段在编辑界面中只读显示
- 历史数据兼容：实现自动的状态映射和字段填充，确保历史数据在新版界面中的正确显示和操作。
- 动态编辑权限：根据招募状态动态控制字段的可编辑性，实现渐进式信息收集。
- 字段组管理：实现字段组的动态显示和隐藏，支持不同状态下的界面适配。
- 表单验证优化：根据当前状态只对可编辑字段进行验证，提升用户体验。
- 按钮动态显示：根据招募状态动态显示相应的操作按钮，隐藏不可用的按钮。
  - 状态判断：根据招募状态确定需要显示的按钮列表
  - 动态渲染：前端根据状态动态渲染按钮，避免显示置灰按钮
  - 用户体验：减少界面复杂度，提升操作直观性
  - 响应式适配：确保按钮在不同屏幕尺寸下的正确显示
- 废弃字段降级读取：实现字段降级读取机制，确保历史数据的完整显示。
  - 读取优先级：新字段 > 废弃字段 > 默认值
  - 降级策略：根据招募状态和字段类型选择合适的废弃字段进行降级读取
  - 数据迁移：提供数据迁移脚本，将废弃字段数据迁移到新字段
  - 兼容性保证：确保新旧数据在同一界面中的一致显示
- 详情页面布局优化：按阶段分组显示信息，提升用户体验。
  - 分组结构：基本信息、面试阶段、试播预约阶段、试播阶段、开播预约阶段、开播阶段、历史数据、系统信息
  - 条件显示：只有已发生的阶段才显示对应的信息分组
  - 角色显示：决策人信息显示为"昵称[角色]"格式，角色使用中文（运营/管理员）
  - 时间显示：所有决策时间使用GMT+8时区显示
- 默认时间处理：为预约试播和预约开播页面提供智能默认时间。
  - 默认时间：当前GMT+8时间向后一个半点或整点取整
  - 时区处理：使用utc_to_local函数确保时间计算基于GMT+8时区
  - 用户体验：减少用户手动输入时间的工作量，提升操作便利性
- 招募状态只读控制：确保招募状态只能通过决策步骤进行流转。
  - 编辑页面：招募状态字段始终只读，不可手动修改
  - 后端验证：移除对status字段的处理和验证逻辑
  - 状态流转：所有状态变更必须通过相应的决策步骤进行
  - 数据完整性：确保招募流程的严谨性和数据一致性
