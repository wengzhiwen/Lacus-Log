# S1-S9 é›†æˆæµ‹è¯•å¥—ä»¶

## æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«9ä¸ªå®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶ï¼ˆS1-S9ï¼‰ï¼Œè¦†ç›–äº†Lacus-Logç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ã€‚æ¯ä¸ªæµ‹è¯•å¥—ä»¶éƒ½ä¸“æ³¨äºç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸï¼Œç¡®ä¿ç³»ç»Ÿå„æ¨¡å—çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚

## æµ‹è¯•å¥—ä»¶ç»“æ„

### ğŸ“ æ–‡ä»¶ç»„ç»‡

```
tests/
â”œâ”€â”€ README.md                              # æœ¬æ–‡æ¡£
â”œâ”€â”€ conftest.py                            # å…¨å±€pytesté…ç½®
â”œâ”€â”€ fixtures/                              # æµ‹è¯•å·¥å…·å’Œæ•°æ®å·¥å‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api_client.py                      # APIå®¢æˆ·ç«¯å°è£…
â”‚   â””â”€â”€ factories.py                       # æµ‹è¯•æ•°æ®å·¥å‚
â””â”€â”€ integration/                           # é›†æˆæµ‹è¯•å¥—ä»¶
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ conftest.py                        # é›†æˆæµ‹è¯•ä¸“ç”¨é…ç½®
    â”œâ”€â”€ test_suite_s1_auth_security.py     # S1: è®¤è¯ä¸å®‰å…¨
    â”œâ”€â”€ test_suite_s2_user_role_management.py  # S2: ç”¨æˆ·è§’è‰²ç®¡ç†
    â”œâ”€â”€ test_suite_s3_recruitment_pipeline.py   # S3: æ‹›å‹Ÿæµç¨‹
    â”œâ”€â”€ test_suite_s4_pilot_broadcast_salary.py # S4: ä¸»æ’­å¼€æ’­ä¸åº•è–ª
    â”œâ”€â”€ test_suite_s5_announcement_calendar.py # S5: é€šå‘Šä¸æ—¥å†
    â”œâ”€â”€ test_suite_s6_settlement_commission.py # S6: ç»“ç®—ä¸ä½£é‡‘
    â”œâ”€â”€ test_suite_s7_bbs_operations.py    # S7: BBSæ“ä½œ
    â”œâ”€â”€ test_suite_s8_calculation_accuracy.py  # S8: è®¡ç®—å‡†ç¡®æ€§
    â”œâ”€â”€ test_suite_s8_dashboard_reports.py     # S8: ä»ªè¡¨ç›˜æŠ¥å‘Š
    â”œâ”€â”€ test_suite_s9_alerts_notifications.py  # S9: å‘Šè­¦é€šçŸ¥
    â””â”€â”€ test_suite_s9_mail_generation.py      # S9: é‚®ä»¶ç”Ÿæˆ
```

## ğŸ§ª æµ‹è¯•å¥—ä»¶è¯¦æƒ…

### S1: è®¤è¯ä¸å®‰å…¨åŸºçº¿æµ‹è¯•
**æ–‡ä»¶**: `test_suite_s1_auth_security.py`
**æµ‹è¯•æ•°é‡**: 7ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- JWT tokenç”Ÿå‘½å‘¨æœŸç®¡ç†
- CSRFéªŒè¯æœºåˆ¶
- è§’è‰²æƒé™æ§åˆ¶
- ä¼šè¯éš”ç¦»
- åˆ·æ–°tokenæœºåˆ¶

### S2: ç”¨æˆ·è§’è‰²ç®¡ç†æµ‹è¯•
**æ–‡ä»¶**: `test_suite_s2_user_role_management.py`
**æµ‹è¯•æ•°é‡**: 7ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- ç”¨æˆ·åˆ›å»ºå’Œè§’è‰²åˆ†é…
- ç”¨æˆ·ä¿¡æ¯æ›´æ–°
- æ¿€æ´»/åœç”¨å’Œæœ€åç®¡ç†å‘˜ä¿æŠ¤
- å¯†ç é‡ç½®å’Œç™»å½•éªŒè¯
- ç”¨æˆ·éªŒè¯å’Œé”™è¯¯å¤„ç†
- ç”¨æˆ·æœç´¢å’Œè¿‡æ»¤
- ç”¨æˆ·å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

### S3: æ‹›å‹Ÿæµç¨‹æµ‹è¯•
**æ–‡ä»¶**: `test_suite_s3_recruitment_pipeline.py`
**æµ‹è¯•æ•°é‡**: 7ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- å®Œæ•´æ‹›å‹Ÿæµç¨‹
- é¢è¯•æ‹’ç»æµç¨‹
- åŸ¹è®­æ‹’ç»æµç¨‹
- å¼‚å¸¸æµç¨‹é˜»å¡
- é¸½å­æ£€æµ‹å’Œè¿‡æ»¤
- æ“ä½œæ—¥å¿—SSE
- æ‹›å‹Ÿç»Ÿè®¡å’ŒæŒ‡æ ‡

### S4: ä¸»æ’­å¼€æ’­ä¸åº•è–ªæµ‹è¯•
**æ–‡ä»¶**: `test_suite_s4_pilot_broadcast_salary.py`
**æµ‹è¯•æ•°é‡**: 10ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- ä¸»æ’­åŸºç¡€æ•°æ®ç®¡ç†
- å¼€æ’­è®°å½•åˆ›å»ºå’ŒBBSè§¦å‘
- åº•è–ªç”³è¯·å®¡æ‰¹é“¾è·¯
- å¼€æ’­è®°å½•ç¼–è¾‘å†²çª
- BBSå›å¤é“¾è·¯
- ä¸»æ’­çŠ¶æ€å·¥ä½œæµ
- ä¸»æ’­é‡å¤æ˜µç§°éªŒè¯
- ä¸»æ’­æ‰€æœ‰æƒè½¬ç§»
- å¼€æ’­è®°å½•æ—¶é—´éªŒè¯
- æ‰¹é‡ä»é€šå‘Šåˆ›å»ºå¼€æ’­è®°å½•

### S5: é€šå‘Šä¸æ—¥å†æµ‹è¯•
**æ–‡ä»¶**: `test_suite_s5_announcement_calendar.py`
**æµ‹è¯•æ•°é‡**: 7ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- åˆ›å»ºæ¯æ—¥é‡å¤é€šå‘Š
- åˆ›å»ºæ¯å‘¨é‡å¤é€šå‘Š
- ç¼–è¾‘å½“å‰å®ä¾‹
- ç¼–è¾‘æœªæ¥æ‰€æœ‰å®ä¾‹
- åˆ é™¤å½“å‰å®ä¾‹
- åˆ é™¤æœªæ¥æ‰€æœ‰å®ä¾‹
- ç›¸å…³é€šå‘Šç®¡ç†

### S6: ç»“ç®—ä¸ä½£é‡‘æµ‹è¯•
**æ–‡ä»¶**: `test_suite_s6_settlement_commission.py`
**æµ‹è¯•æ•°é‡**: 17ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- ç»“ç®—è®¡åˆ’åˆ›å»ºå’ŒæŸ¥è¯¢
- ç»“ç®—ä¿®æ”¹å’Œå†å²è·Ÿè¸ª
- åˆ é™¤é™åˆ¶
- ä½£é‡‘è®°å½•ç®¡ç†
- ä½£é‡‘ä¿®æ”¹å’Œè·Ÿè¸ª
- ç»“ç®—å’Œä½£é‡‘é›†æˆ
- éªŒè¯æµ‹è¯•ï¼ˆç±»å‹ã€æ ¼å¼ã€è¾¹ç•Œã€å­—æ®µç­‰ï¼‰
- ä¸€è‡´æ€§æµ‹è¯•ï¼ˆæ—¥æœŸé‡å ã€è®°å½•é¡ºåºã€è·¨æ¨¡å—å…³ç³»ï¼‰
- é”™è¯¯æµ‹è¯•ï¼ˆHTTPæ–¹æ³•ã€ç¼ºå¤±å­—æ®µã€ä¸å­˜åœ¨èµ„æºã€æ ¼å¼é”™è¯¯ï¼‰

### S7: BBSæ“ä½œæµ‹è¯•
**æ–‡ä»¶**: `test_suite_s7_bbs_operations.py`
**æµ‹è¯•æ•°é‡**: 5ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- ç®¡ç†å‘˜å‘å¸–å’Œå…³è”ä¸»æ’­
- æƒé™æ§åˆ¶
- åµŒå¥—å›å¤æ ‘
- å…³è”å¼€æ’­è®°å½•ç¼ºå¤±æ—¶çš„å›é€€
- å¸–å­æœç´¢å’Œè¿‡æ»¤

### S8: è®¡ç®—å‡†ç¡®æ€§ä¸ä»ªè¡¨ç›˜æµ‹è¯•
**æ–‡ä»¶**: `test_suite_s8_calculation_accuracy.py`, `test_suite_s8_dashboard_reports.py`
**æµ‹è¯•æ•°é‡**: 8ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- åŸºæœ¬ç»Ÿè®¡è®¡ç®—å‡†ç¡®æ€§
- è¾¹ç•Œæƒ…å†µè®¡ç®—å‡†ç¡®æ€§
- è½¬åŒ–ç‡è®¡ç®—å‡†ç¡®æ€§
- ä»ªè¡¨ç›˜APIå¯ç”¨æ€§
- æŠ¥å‘ŠAPIå¯ç”¨æ€§
- é‚®ä»¶æŠ¥å‘ŠAPIå¯ç”¨æ€§
- æ•°æ®åˆ›å»ºå’ŒåŸºæœ¬å·¥ä½œæµ
- å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

### S9: å‘Šè­¦é€šçŸ¥ä¸é‚®ä»¶ç”Ÿæˆæµ‹è¯•
**æ–‡ä»¶**: `test_suite_s9_alerts_notifications.py`, `test_suite_s9_mail_generation.py`
**æµ‹è¯•æ•°é‡**: 8ä¸ªæµ‹è¯•ç”¨ä¾‹
**è¦†ç›–èŒƒå›´**:
- Jameså…³æ³¨å‘Šè­¦è§¦å‘
- é‚®ä»¶é€šçŸ¥é»‘åå•
- SSEé•¿è½®è¯¢é€šçŸ¥
- å‘Šè­¦è§„åˆ™å’Œé…ç½®
- é€šçŸ¥åå¥½å’Œè¿‡æ»¤å™¨
- åŸºç¡€é‚®ä»¶æ–‡ä»¶ç”Ÿæˆ
- å¤æ‚è®¡ç®—é‚®ä»¶ç”Ÿæˆ
- è¾¹ç•Œæƒ…å†µé‚®ä»¶ç”Ÿæˆ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- MongoDB
- ä¾èµ–åŒ…ï¼š`pip install -r requirements.txt`

### è¿è¡Œæµ‹è¯•

#### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•å¥—ä»¶
```bash
pytest tests/integration/
```

#### 2. è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
```bash
# è¿è¡ŒS1æµ‹è¯•å¥—ä»¶
pytest tests/integration/test_suite_s1_auth_security.py

# è¿è¡ŒS4æµ‹è¯•å¥—ä»¶
pytest tests/integration/test_suite_s4_pilot_broadcast_salary.py
```

#### 3. è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
```bash
# è¿è¡ŒS4å¥—ä»¶ä¸­çš„ç¬¬5ä¸ªæµ‹è¯•ç”¨ä¾‹
pytest tests/integration/test_suite_s4_pilot_broadcast_salary.py::TestS4PilotBroadcastSalary::test_s4_tc5_complaint_reply_chain
```

#### 4. æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
```bash
pytest tests/integration/ -v -s
```

#### 5. è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰è®¤è¯ç›¸å…³æµ‹è¯•
pytest tests/integration/ -m "auth_security"

# è¿è¡Œæ‰€æœ‰BBSç›¸å…³æµ‹è¯•
pytest tests/integration/ -m "bbs_operations"
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“éš”ç¦»
æ¯ä¸ªæµ‹è¯•ä¼šè¯ä½¿ç”¨ç‹¬ç«‹çš„éšæœºæ•°æ®åº“ï¼Œç¡®ä¿æµ‹è¯•é—´çš„å®Œå…¨éš”ç¦»ï¼š
- è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“åï¼š`lacus_test_<8ä½éšæœºå­—ç¬¦>`
- è‡ªåŠ¨åˆ›å»ºé»˜è®¤è§’è‰²å’Œè´¦æˆ·
- æµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†æ•°æ®åº“

### é»˜è®¤è´¦æˆ·
æµ‹è¯•ç¯å¢ƒä¸­è‡ªåŠ¨åˆ›å»ºï¼š
- **ç”¨æˆ·å**: `zala`
- **å¯†ç **: `plant4ever`
- **è§’è‰²**: `gicho`ï¼ˆç®¡ç†å‘˜ï¼‰

### Fixtures
- `admin_client`: å·²ç™»å½•çš„ç®¡ç†å‘˜å®¢æˆ·ç«¯
- `kancho_client`: å·²ç™»å½•çš„è¿è¥å®¢æˆ·ç«¯
- `pilot_factory`: ä¸»æ’­æ•°æ®å·¥å‚
- `battle_record_factory`: å¼€æ’­è®°å½•æ•°æ®å·¥å‚

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•å¥—ä»¶**: 9ä¸ªï¼ˆS1-S9ï¼‰
- **æ€»æµ‹è¯•ç”¨ä¾‹**: 76ä¸ª
- **è¦†ç›–ç‡**: æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å…¨è¦†ç›–
- **é€šè¿‡ç‡**: é€šå¸¸ >95%

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹
1. ç¡®å®šæµ‹è¯•å±äºå“ªä¸ªå¥—ä»¶ï¼ˆS1-S9ï¼‰
2. åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•
3. ä½¿ç”¨ç°æœ‰çš„fixtureså’Œå·¥å…·å‡½æ•°
4. éµå¾ªå‘½åè§„èŒƒï¼š`test_sX_tcY_description`

### è°ƒè¯•æŠ€å·§
```bash
# æ˜¾ç¤ºprintè¾“å‡º
pytest tests/integration/test_suite_s4_pilot_broadcast_salary.py -s

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest tests/integration/ --lf

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥æ—¶åœæ­¢
pytest tests/integration/ -x

# æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
pytest tests/integration/ -v --tb=long
```

### å¸¸è§é—®é¢˜

#### CSRF Tokené—®é¢˜
BBSç›¸å…³æµ‹è¯•éœ€è¦CSRF tokenï¼Œå‚è€ƒS7æµ‹è¯•å¥—ä»¶çš„å®ç°ï¼š
```python
# å…ˆè®¿é—®BBSé¡µé¢è·å–CSRF token
bbs_page_response = admin_client.client.get('/bbs/')
# è§£æHTMLè·å–token
# åœ¨è¯·æ±‚ä¸­ä½¿ç”¨token
```

#### æ•°æ®åº“è¿æ¥é—®é¢˜
ç¡®ä¿MongoDBæœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
# macOS
brew services start mongodb-community

# æˆ–ç›´æ¥å¯åŠ¨
mongod --config /usr/local/etc/mongod.conf
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é›†æˆæµ‹è¯•å‘ç°çš„é—®é¢˜è®°å½•](../docs/é›†æˆæµ‹è¯•å‘ç°çš„é—®é¢˜è®°å½•.md) - æµ‹è¯•ä¿®å¤è¿‡ç¨‹å’Œé—®é¢˜è§£å†³
- [pytesté›†æˆæµ‹è¯•è¡¥å……è®¡åˆ’](../docs/pytesté›†æˆæµ‹è¯•è¡¥å……è®¡åˆ’.md) - æµ‹è¯•è®¡åˆ’æ–‡æ¡£
- [é¡¹ç›®å¼€å‘çº¦å®š](../.claude/CLAUDE.md) - é¡¹ç›®å¼€å‘è§„èŒƒ

## ğŸ¤ è´¡çŒ®

åœ¨ä¿®æ”¹æµ‹è¯•å¥—ä»¶æ—¶ï¼Œè¯·ï¼š
1. ä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§
2. ä½¿ç”¨é€‚å½“çš„fixtures
3. æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£å’Œæ³¨é‡Š
4. ç¡®ä¿æ‰€æœ‰ç›¸å…³æµ‹è¯•é€šè¿‡
5. æ›´æ–°ç›¸å…³æ–‡æ¡£

---

*æœ€åæ›´æ–°: 2025-10-24*