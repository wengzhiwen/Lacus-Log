# 主播-主播管理（原“机师-机师管理”）

> 术语统一记录（2025-09-26）
> - 历史用语→统一用语：机师→主播；舰长→运营；议长→管理员；征召→招募；参战形式→开播方式；战区→开播地点；阶级→主播分类；所属→直属运营；正式机师→正式主播；实习机师→实习主播。
> - 本次复核（2025-09-26）：已完成逐段术语检查，正文采用统一用语；数据库/接口字段仍保留历史命名，仅以字段标注说明。
主播指代受公司运营的内容生产者，针对一些表词达意不够准确的文档描述，将使用针对主播的视角更为准确。

但在数据库/接口等技术实现中，仍保留历史字段与命名，不做破坏性修改。

## 基本约定

- 主播不是用户
    - 没有登录功能
    - 本系统暂时没有直接提供任何功能给到主播
    - 在系统设计中应该被视为资产
- 主播是几乎所有模块的核心
    - 大多数系统都会引用主播的基础数据结构
    - 因而需要维护良好的易扩展的数据结构和INDEX，由技术设计

## 主播的元数据

以下为业务视角的元数据清单，技术实现时可能需要补充更多的字段

| 字段 | 说明 | 参考类型 | 设定 |
|---------|------|------|------|
| ID | 系统中内部使用的唯一编码，用户不可见 | 由技术设计 | 必须 唯一 |
| 昵称 | 系统中主要用于显示的主播名，虽然要求唯一但不要作为PK使用，唯一是为了防止内部混淆 | 字符串 | 必须 唯一 |
| 姓名 | 作为参考保存的主播的真实姓名 | 字符串 | 非必须 |
| 性别 | 男(0) / 女(1) / 不明确(2或其他数值) | 枚举 | 必须，默认值=女 |
| 出生年 | 出生年份，用来计算年龄 | 数值型 | 非必须 |
| 直属运营 | 主播直属运营 | 关联到用户唯一ID | 非必须 |
| 开播地点 | 主播开播的平台：快手 / 抖音 / 其他 / 未知 | 枚举 | 必须，默认=未知 |
| 开播方式 | 线下 / 线上 / 未知 | 枚举 | 必须，默认=未知 |
| 主播分类 | 候选人 / 试播主播 / 实习主播 / 正式主播 | 枚举 | 必须，默认值=候选人 |
| 状态 | 未招募 / 不招募 / 已招募 / 已签约 / 已阵亡 | 枚举 | 必须，默认值=未招募 |
| 变更记录 | 记录上述字段的所有修改日志（哪个用户什么时间把什么字段的值从什么改成了什么，修改时使用的IP地址是什么） | 由独立模型持久化（非嵌入JSON） | 非必须 |
| 创建时间 | 创建本条记录的时间 | 时间戳 | 必须，默认=当前时间UTC |
| 最后修改 | 最后一次修改本条记录的时间 | 时间戳 | 必须，默认=当前时间UTC |


### 元数据之间的关联

在对主播的数值进行修改时，应符合以下条件：

- 主播分类为 实习主播 / 正式主播 的，必须有直属运营，开播地点不能是未知，开播方式不能是未知
- 状态为 已招募 / 已签约 的，必须有姓名、出生年

### 交叉关联

#### 基础-用户系统

- 当前系统不支持“删除用户”功能，无需在本模块执行相关拦截

## 主播管理界面

### 列表

- 按主播的创建时间逆序（最近在前）排列
- 展示字段
    - 昵称 姓名（换行，副文字）
    - 性别（用图标） 年龄（用now来计算周岁）
    - 直属运营 主播分类（换行，副文字） 状态（换行，副文字）
- 点击进入主播详情

新主播按钮：新建主播

#### 筛选

支持筛选：

- 按主播分类筛选
- 按状态筛选
- 按直属运营筛选
- 按创建时间筛选（最近7天 14天 30天）

所有筛选条件可以组合成复合筛选（交集）；

筛选条件展示，点击筛选条件展开筛选器（否则筛选器太高了，默认折叠）；

筛选器写入cookie，便于用户使用。

#### 搜索

在筛选器下方提供文本搜索框，支持：

- 搜索范围：主播昵称和真实姓名
- 搜索方式：前端模糊匹配，不区分大小写
- 触发方式：实时输入搜索、退格键、删除键、回车键、搜索按钮点击
- 实现方式：纯前端JavaScript实现，不影响后端筛选器功能
- 交互设计：搜索框为空时显示所有主播，有搜索内容时实时过滤显示结果

#### 默认筛选器

- 管理员
    - 无（可选按直属运营/状态/主播分类/时间筛选）
- 运营
    - 无（默认不再强制“直属运营=自己”，但仍可作为筛选条件）

### 主播详情

展示一位主播的数据。

返回到主播列表时应正确维持筛选器。

功能按钮：

- 编辑： 跳转主播编辑
- 变更记录： 弹窗展示最近100条变更记录，按变更发生的时间逆序排列

  注：前端通过调用 GET `/pilots/<pilot_id>/changes` 获取JSON数据并渲染弹窗。

没有删除功能。

### 主播新建 / 编辑

说明略

- 支持所有数据的修改，但部分字段的修改需要符合本文档中约定的条件
- 不支持编辑 ID 变更记录 创建时间 最后修改等由系统管理的字段
- 对于枚举字段只能在枚举中选择值，选项的显示顺序按上表中的顺序
    - 非必须的枚举字段，默认为空值
- 对于出生年字段需要进行有效验证（距今60年前-距今10年前）
- 对于昵称，最大长度限定20个字符
- 对于姓名，最大长度限定20个字符
- 直属运营的选择从所有的运营 / 管理员 （不论是否活跃）中选择，选项的显示顺序：
    - 第一顺位： 空值
    - 第二顺位： 当前 运营 / 管理员
    - 第三顺位： 其他活跃运营（昵称字典顺序）
    - 第四顺位： 其他运营（昵称字典顺序，昵称后接[阵亡]）



