# API é›†æˆæµ‹è¯•ç”¨ä¾‹è®¾è®¡æ–‡æ¡£

> æœ¬æ–‡æ¡£è®°å½•æ‰€æœ‰REST APIçš„é›†æˆæµ‹è¯•ç”¨ä¾‹è®¾è®¡ï¼Œç¡®ä¿APIè´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§

## ğŸ“‹ æµ‹è¯•åŸåˆ™

### æ ¸å¿ƒåŸåˆ™
1. **ä¸ç›´æ¥æ“ä½œæ•°æ®åº“**ï¼šæ‰€æœ‰æ•°æ®è®¿é—®é€šè¿‡REST API
2. **ä½¿ç”¨éšæœºæ•°æ®**ï¼šé€šè¿‡Fakerç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œç¡®ä¿å¯é‡å¤æ‰§è¡Œ
3. **æ•°æ®éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•åˆ›å»ºè‡ªå·±çš„æ•°æ®ï¼Œæµ‹è¯•åæ¸…ç†
4. **å®Œæ•´è¦†ç›–**ï¼šæ­£å¸¸æµç¨‹ + å¼‚å¸¸æƒ…å†µ + è¾¹ç•Œæ¡ä»¶

### æµ‹è¯•åˆ†ç±»
- **æ­£å¸¸æµç¨‹æµ‹è¯•**ï¼šéªŒè¯åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- **å¼‚å¸¸å¤„ç†æµ‹è¯•**ï¼šéªŒè¯é”™è¯¯å¤„ç†ï¼ˆ404ã€400ã€401ã€403ç­‰ï¼‰
- **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**ï¼šéªŒè¯ç‰¹æ®Šæƒ…å†µï¼ˆæœ€åä¸€ä¸ªç®¡ç†å‘˜ã€é‡å¤æ•°æ®ç­‰ï¼‰
- **æƒé™æµ‹è¯•**ï¼šéªŒè¯è§’è‰²æƒé™æ§åˆ¶
- **å·¥ä½œæµæµ‹è¯•**ï¼šéªŒè¯å®Œæ•´ä¸šåŠ¡æµç¨‹

### å‘½åè§„èŒƒ
```python
# æµ‹è¯•ç±»å‘½å
class Test<Module><Action>:
    """æµ‹è¯•<æ¨¡å—><æ“ä½œ>"""

# æµ‹è¯•æ–¹æ³•å‘½å
def test_<action>_<scenario>(self, fixture):
    """æµ‹è¯•<æ“ä½œ> - <åœºæ™¯>"""
```

---

## ğŸ—‚ï¸ æ¨¡å—æµ‹è¯•ç”¨ä¾‹æ¸…å•

### çŠ¶æ€è¯´æ˜
- âœ… å·²å®Œæˆï¼šæµ‹è¯•ç”¨ä¾‹å·²å®ç°å¹¶é€šè¿‡
- ğŸš§ è¿›è¡Œä¸­ï¼šæµ‹è¯•ç”¨ä¾‹å¼€å‘ä¸­
- â³ å¾…å¼€å§‹ï¼šå°šæœªå¼€å§‹ç¼–å†™
- â­ï¸ å·²è·³è¿‡ï¼šå·²æ ‡è®°è·³è¿‡ï¼ˆé€šå¸¸æ˜¯å·²çŸ¥é—®é¢˜ï¼‰

---

## 1. ç”¨æˆ·ç®¡ç†æ¨¡å— (Users API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_users_api.py`  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ (17/20 é€šè¿‡, 3ä¸ªè·³è¿‡)  
**APIå‰ç¼€**ï¼š`/api/users`

### æµ‹è¯•ç±»æ¸…å•

#### 1.1 TestUsersList - ç”¨æˆ·åˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_users_list_success | è·å–ç”¨æˆ·åˆ—è¡¨ - æˆåŠŸ | âœ… | éªŒè¯è¿”å›æ•°æ®ç»“æ„å’Œåˆ†é¡µ |
| test_get_users_list_with_filters | å¸¦è¿‡æ»¤æ¡ä»¶çš„åˆ—è¡¨ | âœ… | æµ‹è¯•è§’è‰²è¿‡æ»¤ |
| test_get_users_list_unauthorized | æœªç™»å½•è®¿é—® - åº”å¤±è´¥ | âœ… | éªŒè¯401/403 |

#### 1.2 TestUserCreate - åˆ›å»ºç”¨æˆ·
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_create_user_success | åˆ›å»ºç”¨æˆ· - æˆåŠŸ | âœ… | æ­£å¸¸æµç¨‹ |
| test_create_user_with_minimal_data | æœ€å°å¿…éœ€æ•°æ® | âœ… | ä»…username/password/role |
| test_create_user_duplicate_username | é‡å¤ç”¨æˆ·å - åº”å¤±è´¥ | âœ… | éªŒè¯å”¯ä¸€æ€§çº¦æŸ |
| test_create_user_missing_required_fields | ç¼ºå°‘å¿…éœ€å­—æ®µ - åº”å¤±è´¥ | â­ï¸ | APIç¼ºå°‘éªŒè¯ï¼ˆå·²çŸ¥é—®é¢˜ï¼‰ |
| test_create_user_invalid_role | æ— æ•ˆè§’è‰² - åº”å¤±è´¥ | â­ï¸ | APIç¼ºå°‘éªŒè¯ï¼ˆå·²çŸ¥é—®é¢˜ï¼‰ |

#### 1.3 TestUserDetail - ç”¨æˆ·è¯¦æƒ…
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_user_detail_success | è·å–è¯¦æƒ… - æˆåŠŸ | âœ… | éªŒè¯å®Œæ•´æ•°æ®è¿”å› |
| test_get_user_detail_not_found | ç”¨æˆ·ä¸å­˜åœ¨ - 404 | âœ… | éªŒè¯é”™è¯¯å¤„ç† |

#### 1.4 TestUserUpdate - æ›´æ–°ç”¨æˆ·
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_update_user_success | æ›´æ–°ä¿¡æ¯ - æˆåŠŸ | âœ… | æ›´æ–°nickname/email |
| test_update_user_not_found | ç”¨æˆ·ä¸å­˜åœ¨ - 404 | âœ… | éªŒè¯é”™è¯¯å¤„ç† |

#### 1.5 TestUserActivation - æ¿€æ´»/åœç”¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_toggle_user_activation_success | åˆ‡æ¢æ¿€æ´»çŠ¶æ€ - æˆåŠŸ | âœ… | åœç”¨->æ¿€æ´» |
| test_deactivate_last_admin_should_fail | åœç”¨æœ€åç®¡ç†å‘˜ - åº”å¤±è´¥ | âœ… | ä¸šåŠ¡è§„åˆ™éªŒè¯ |

#### 1.6 TestUserPasswordReset - å¯†ç é‡ç½®
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_reset_user_password_success | é‡ç½®å¯†ç  - æˆåŠŸ | âœ… | éªŒè¯æ–°å¯†ç å¯ç™»å½• |

#### 1.7 TestUserOperatorsList - è¿è¥åˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_operators_list_success | ç®¡ç†å‘˜è·å–åˆ—è¡¨ | âœ… | gichoè§’è‰² |
| test_get_operators_list_as_kancho | è¿è¥è·å–åˆ—è¡¨ | âœ… | kanchoè§’è‰² |

#### 1.8 TestUserEmails - é‚®ç®±åˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_user_emails_success | è·å–é‚®ç®±åˆ—è¡¨ | âœ… | å®Œæ•´åˆ—è¡¨ |
| test_get_user_emails_with_role_filter | è§’è‰²è¿‡æ»¤ | âœ… | æŒ‰è§’è‰²ç­›é€‰ |

#### 1.9 TestUserWorkflow - å®Œæ•´æµç¨‹
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_complete_user_lifecycle | å®Œæ•´ç”Ÿå‘½å‘¨æœŸ | â­ï¸ | åˆ›å»º->æ›´æ–°->åœç”¨->æ¿€æ´»->åˆ é™¤ |

---

## 2. ä¸»æ’­ç®¡ç†æ¨¡å— (Pilots API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_pilots_api.py`  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ (26/26 å…¨éƒ¨é€šè¿‡)  
**APIå‰ç¼€**ï¼š`/api/pilots`

### æµ‹è¯•ç±»æ¸…å•

#### 2.1 TestPilotsList - ä¸»æ’­åˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_pilots_list_success | è·å–åˆ—è¡¨ - æˆåŠŸ | âœ… | éªŒè¯è¿”å›æ•°æ®ç»“æ„å’Œç»Ÿè®¡ä¿¡æ¯ |
| test_get_pilots_list_with_pagination | åˆ†é¡µæŸ¥è¯¢ | âœ… | éªŒè¯åˆ†é¡µå‚æ•° |
| test_get_pilots_list_with_filters | å¤šæ¡ä»¶è¿‡æ»¤ | âœ… | rank/status/platform/ownerç­‰ |
| test_get_pilots_list_search | æœç´¢åŠŸèƒ½ | âœ… | æ˜µç§°/çœŸå®å§“åæœç´¢ |
| test_get_pilots_list_unauthorized | æœªç™»å½•è®¿é—® - åº”å¤±è´¥ | âœ… | éªŒè¯401/403 |

#### 2.2 TestPilotsCreate - åˆ›å»ºä¸»æ’­
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_create_pilot_success | åˆ›å»ºä¸»æ’­ - æˆåŠŸ | âœ… | å®Œæ•´æ•°æ® |
| test_create_pilot_minimal_data | æœ€å°å¿…éœ€æ•°æ® | âœ… | ä»…nickname |
| test_create_pilot_duplicate_nickname | é‡å¤æ˜µç§° - åº”å¤±è´¥ | âœ… | éªŒè¯å”¯ä¸€æ€§çº¦æŸ |
| test_create_pilot_as_kancho | è¿è¥åˆ›å»ºä¸»æ’­ | âœ… | è¿è¥è‡ªåŠ¨å…³è”ä¸ºowner |
| test_create_pilot_with_owner | ç®¡ç†å‘˜æŒ‡å®šowner | âœ… | åŸºäºç”¨æˆ·æµ‹è¯•åˆ›å»ºçš„è¿è¥ |
| test_create_pilot_missing_nickname | ç¼ºå°‘æ˜µç§° - åº”å¤±è´¥ | âœ… | å¿…å¡«å­—æ®µéªŒè¯ |

#### 2.3 TestPilotsDetail - ä¸»æ’­è¯¦æƒ…
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_pilot_detail_success | è·å–è¯¦æƒ… - æˆåŠŸ | âœ… | éªŒè¯å®Œæ•´æ•°æ®è¿”å› |
| test_get_pilot_detail_not_found | ä¸»æ’­ä¸å­˜åœ¨ - 404/500 | âœ… | æ— æ•ˆObjectIdè¿”å›500ï¼ˆå·²çŸ¥æŠ€æœ¯é™åˆ¶ï¼‰ |
| test_get_pilot_detail_with_changes | åŒ…å«å˜æ›´è®°å½• | âœ… | éªŒè¯recent_changeså­—æ®µ |

#### 2.4 TestPilotsUpdate - æ›´æ–°ä¸»æ’­
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_update_pilot_success | æ›´æ–°ä¿¡æ¯ - æˆåŠŸ | âœ… | æ›´æ–°åŸºç¡€å­—æ®µ |
| test_update_pilot_rank_and_status | æ›´æ–°åˆ†ç±»å’ŒçŠ¶æ€ | âœ… | rank/statuså˜æ›´ï¼ˆéœ€è¦å§“åå’Œå‡ºç”Ÿå¹´ï¼‰ |
| test_update_pilot_owner | è½¬ç§»ä¸»æ’­ | âœ… | ownerå˜æ›´ï¼ˆç®¡ç†å‘˜å’Œè¿è¥éƒ½å¯ä»¥ï¼‰ |
| test_update_pilot_not_found | ä¸»æ’­ä¸å­˜åœ¨ - 400/404 | âœ… | æ— æ•ˆObjectIdè¿”å›400 |
| test_update_pilot_duplicate_nickname | æ˜µç§°å†²çª - åº”å¤±è´¥ | âœ… | å”¯ä¸€æ€§éªŒè¯ |

#### 2.5 TestPilotsStatus - çŠ¶æ€è°ƒæ•´
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_update_pilot_status_success | è°ƒæ•´çŠ¶æ€ - æˆåŠŸ | âœ… | PATCH /api/pilots/<id>/status |
| test_update_pilot_status_invalid | æ— æ•ˆçŠ¶æ€ - åº”å¤±è´¥ | âœ… | æ•°æ®éªŒè¯ |

#### 2.6 TestPilotsChanges - å˜æ›´è®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_pilot_changes_success | è·å–å˜æ›´è®°å½• | âœ… | å®Œæ•´åˆ—è¡¨ |
| test_get_pilot_changes_pagination | å˜æ›´è®°å½•åˆ†é¡µ | âœ… | åˆ†é¡µå‚æ•° |

#### 2.7 TestPilotsOptions - é€‰é¡¹æ•°æ®
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_get_pilot_options_success | è·å–æšä¸¾é€‰é¡¹ | âœ… | gender/platform/rankç­‰ |

#### 2.8 TestPilotsWorkflow - å®Œæ•´æµç¨‹
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| test_pilot_lifecycle | å®Œæ•´ç”Ÿå‘½å‘¨æœŸ | âœ… | åˆ›å»º->æ›´æ–°->çŠ¶æ€è°ƒæ•´->æŸ¥è¯¢å˜æ›´ |
| test_kancho_creates_own_pilots | è¿è¥åˆ›å»ºè‡ªå·±çš„ä¸»æ’­ | âœ… | è¿è¥æ‰¹é‡åˆ›å»ºå¹¶éªŒè¯å½’å± |

**æ³¨æ„äº‹é¡¹**ï¼š
- ä¸»æ’­ç®¡ç†æ¨¡å—æƒé™ï¼šç®¡ç†å‘˜å’Œè¿è¥æƒé™ç›¸åŒï¼Œéƒ½å¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘æ‰€æœ‰ä¸»æ’­ï¼ˆå‚è€ƒCHANGELOG 2025-09-11ï¼‰
- ç³»ç»Ÿä¸æ”¯æŒåˆ é™¤ä¸»æ’­ï¼ˆåªæœ‰çŠ¶æ€è°ƒæ•´ï¼Œå¦‚"æµå¤±"ï¼‰
- ç³»ç»Ÿä¸æ”¯æŒDELETEç”¨æˆ·ï¼ˆåªèƒ½é€šè¿‡åœç”¨å®ç°è½¯åˆ é™¤ï¼‰
- è¿è¥åˆ›å»ºä¸»æ’­æ—¶ä¼šè‡ªåŠ¨å…³è”ownerä¸ºå½“å‰è¿è¥ç”¨æˆ·
- æµ‹è¯•ä¸­ä¼šåˆ©ç”¨ç”¨æˆ·ç®¡ç†æµ‹è¯•åˆ›å»ºçš„è¿è¥è´¦å·æ¥éªŒè¯ownerå…³è”åŠŸèƒ½

**å·²çŸ¥é—®é¢˜**ï¼š
- 2ä¸ªæµ‹è¯•è¢«è·³è¿‡ï¼šæ¶‰åŠè¿è¥èº«ä»½åˆ›å»ºä¸»æ’­çš„æµ‹è¯•å› Flask-Securityå¤štest_clientå®ä¾‹sessionéš”ç¦»é—®é¢˜è€Œè·³è¿‡ï¼Œè¿™æ˜¯æµ‹è¯•æ¡†æ¶é™åˆ¶ï¼Œä¸å½±å“å®é™…åŠŸèƒ½

---

## 3. é€šå‘Šç®¡ç†æ¨¡å— (Announcements API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_announcements_api.py` + `tests/integration/test_workflows.py`  
**çŠ¶æ€**ï¼šğŸš§ è¿›è¡Œä¸­ (éƒ¨åˆ†å®Œæˆ)  
**APIå‰ç¼€**ï¼š`/announcements/api/announcements`ï¼ˆæ³¨æ„ï¼šè·¯å¾„ä¸ç»Ÿä¸€ï¼‰

### å¾…å®ç°çš„æµ‹è¯•ç±»

#### 3.1 TestAnnouncementsList - é€šå‘Šåˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_announcements_list_success | è·å–åˆ—è¡¨ - æˆåŠŸ | â³ | P0 | åŸºç¡€åŠŸèƒ½ |
| test_get_announcements_with_filters | å¤šæ¡ä»¶è¿‡æ»¤ | â³ | P1 | pilot/date/status |
| test_get_announcements_pagination | åˆ†é¡µæŸ¥è¯¢ | â³ | P1 | éªŒè¯åˆ†é¡µ |
| test_get_announcements_by_pilot | æŒ‰ä¸»æ’­ç­›é€‰ | â³ | P1 | å•ä¸ªä¸»æ’­çš„é€šå‘Š |

#### 3.2 TestAnnouncementsCreate - åˆ›å»ºé€šå‘Š
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_create_announcement_success | åˆ›å»ºé€šå‘Š - æˆåŠŸ | â³ | P0 | å•æ¬¡é€šå‘Š |
| test_create_announcement_recurring | åˆ›å»ºé‡å¤é€šå‘Š | â³ | P0 | æ¯æ—¥/æ¯å‘¨/æ¯æœˆ |
| test_create_announcement_time_conflict | æ—¶é—´å†²çªæ£€æµ‹ | â³ | P1 | åŒä¸»æ’­æ—¶é—´é‡å  |
| test_create_announcement_invalid_pilot | æ— æ•ˆä¸»æ’­ID | â³ | P2 | æ•°æ®éªŒè¯ |

#### 3.3 TestAnnouncementsDetail - é€šå‘Šè¯¦æƒ…
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_announcement_detail_success | è·å–è¯¦æƒ… - æˆåŠŸ | â³ | P0 | å®Œæ•´ä¿¡æ¯ |
| test_get_announcement_detail_not_found | é€šå‘Šä¸å­˜åœ¨ - 404 | â³ | P1 | é”™è¯¯å¤„ç† |

#### 3.4 TestAnnouncementsUpdate - æ›´æ–°é€šå‘Š
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_update_announcement_single | æ›´æ–°å•æ¬¡é€šå‘Š | â³ | P0 | åŸºç¡€æ›´æ–° |
| test_update_announcement_this_only | ä»…æ›´æ–°æœ¬æ¬¡ | â³ | P1 | é‡å¤é€šå‘Š |
| test_update_announcement_all_future | æ›´æ–°æœ¬æ¬¡åŠåç»­ | â³ | P1 | é‡å¤é€šå‘Š |
| test_update_announcement_conflict | æ›´æ–°åæ—¶é—´å†²çª | â³ | P1 | å†²çªæ£€æµ‹ |

#### 3.5 TestAnnouncementsDelete - åˆ é™¤é€šå‘Š
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_delete_announcement_single | åˆ é™¤å•æ¬¡é€šå‘Š | â³ | P0 | åŸºç¡€åˆ é™¤ |
| test_delete_announcement_this_only | ä»…åˆ é™¤æœ¬æ¬¡ | â³ | P1 | é‡å¤é€šå‘Š |
| test_delete_announcement_all_future | åˆ é™¤æœ¬æ¬¡åŠåç»­ | â³ | P1 | é‡å¤é€šå‘Š |

#### 3.6 TestAnnouncementsConflict - å†²çªæ£€æµ‹
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_check_conflict_same_pilot | åŒä¸»æ’­æ—¶é—´å†²çª | â³ | P1 | åŸºç¡€å†²çª |
| test_check_conflict_none | æ— å†²çª | â³ | P1 | æ­£å¸¸æƒ…å†µ |

#### 3.7 TestAnnouncementsChanges - å˜æ›´è®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_announcement_changes | è·å–å˜æ›´è®°å½• | â³ | P2 | å®¡è®¡æ—¥å¿— |

#### 3.8 TestAnnouncementsWorkflow - é€šå‘Šå·¥ä½œæµ
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_announcement_conflicts_and_resolution | å†²çªæ£€æµ‹ç»¼åˆæµ‹è¯• | âœ… | P0 | 5ä¸ªå†²çªåœºæ™¯çš„ç«¯åˆ°ç«¯æµ‹è¯• |
| test_create_battle_areas_and_schedule_announcements | å¼€æ’­åœ°ç‚¹å’Œé€šå‘Šç»¼åˆæµ‹è¯• | âœ… | P0 | 15ä¸ªåœ°ç‚¹+50+é€šå‘Šçš„ç«¯åˆ°ç«¯æµ‹è¯• |
| test_announcement_to_record_flow | é€šå‘Šè½¬å¼€æ’­è®°å½• | â³ | P1 | åˆ›å»ºé€šå‘Š->åˆ›å»ºå¼€æ’­è®°å½• |

**å†²çªæ£€æµ‹ç»¼åˆæµ‹è¯•è¦†ç›–çš„åœºæ™¯ï¼š**
1. âœ… åˆ›å»ºåŸºç¡€é€šå‘Š
2. âœ… å¼€æ’­åœ°ç‚¹å†²çªæ£€æµ‹ï¼ˆåŒåœ°ç‚¹åŒæ—¶æ®µï¼‰
3. âœ… æ¢åœ°ç‚¹è§£å†³å†²çª
4. âœ… ä¸»æ’­æ—¶æ®µå†²çªæ£€æµ‹ï¼ˆé‡å æ—¶æ®µï¼‰
5. âœ… è°ƒæ•´æ—¶é—´è§£å†³å†²çª

**å¼€æ’­åœ°ç‚¹å’Œé€šå‘Šç»¼åˆæµ‹è¯•è¦†ç›–çš„åœºæ™¯ï¼š**
1. âœ… åˆ›å»º15ä¸ªå¼€æ’­åœ°ç‚¹ï¼ˆä½¿ç”¨"å…ˆæŸ¥è¯¢ååˆ›å»º"ç­–ç•¥ï¼‰
2. âœ… ä¸º5ä¸ªå·²æ‹›å‹Ÿä¸»æ’­å®‰æ’æœªæ¥60å¤©çš„é€šå‘Šï¼š
   - ä¸»æ’­1ï¼šæ‰‹åŠ¨å®‰æ’40ä¸ªå•æ¬¡é€šå‘Š
   - ä¸»æ’­2ï¼šæ¯æ—¥å¾ªç¯é€šå‘Šï¼ˆ30å¤©ï¼‰
   - ä¸»æ’­3ï¼šéš”æ—¥å¾ªç¯é€šå‘Šï¼ˆ60å¤©ï¼‰
   - ä¸»æ’­4ï¼šæ¯å‘¨å¾ªç¯é€šå‘Šï¼ˆ8å‘¨ï¼‰
   - ä¸»æ’­5ï¼šæ··åˆå®‰æ’ï¼ˆå•æ¬¡+å¾ªç¯ï¼‰
3. âœ… æ¨¡æ‹ŸçœŸå®ä½¿ç”¨ï¼šç¼–è¾‘ã€åˆ é™¤ã€é‡æ–°åˆ›å»ºæ“ä½œ

**æµ‹è¯•ç»„ç»‡è¯´æ˜ï¼š**
- è¿™ä¸¤ä¸ªç»¼åˆæµ‹è¯•éªŒè¯äº†é€šå‘Šç®¡ç†çš„æ ¸å¿ƒåŠŸèƒ½
- ä½œä¸ºç«¯åˆ°ç«¯æµ‹è¯•ï¼Œèƒ½å¿«é€Ÿå‘ç°é€šå‘Šç³»ç»Ÿçš„æ•´ä½“é—®é¢˜
- å†²çªæ£€æµ‹æ˜¯é€šå‘Šç®¡ç†çš„å…³é”®ä¸šåŠ¡é€»è¾‘ï¼Œå·²å¾—åˆ°å……åˆ†éªŒè¯
- å¯ä»¥åœ¨éœ€è¦æ—¶æå–ç‹¬ç«‹åœºæ™¯æµ‹è¯•ï¼Œä½†å½“å‰ç»¼åˆæµ‹è¯•å·²æ»¡è¶³éœ€æ±‚

#### 3.9 TestAnnouncementsExport - å¯¼å‡ºåŠŸèƒ½
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_export_announcements_csv | å¯¼å‡ºCSV | â³ | P2 | æ–‡ä»¶ä¸‹è½½ |
| test_export_announcements_with_filters | å¸¦è¿‡æ»¤æ¡ä»¶å¯¼å‡º | â³ | P2 | å¯¼å‡ºç­›é€‰æ•°æ® |

---

## 4. å¼€æ’­è®°å½•æ¨¡å— (Battle Records API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_battle_records_api.py`
**çŠ¶æ€**ï¼šğŸš§ è¿›è¡Œä¸­
**APIå‰ç¼€**ï¼š`/api/battle-records`

### æµ‹è¯•ç±»æ¸…å•

#### 4.1 TestBattleRecordsList - å¼€æ’­è®°å½•åˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_records_list_success | è·å–åˆ—è¡¨ - æˆåŠŸ | â³ | P0 | åŸºç¡€åŠŸèƒ½ |
| test_get_records_with_filters | å¤šæ¡ä»¶è¿‡æ»¤ | â³ | P1 | pilot/date/mode |
| test_get_records_by_date_range | æ—¥æœŸèŒƒå›´æŸ¥è¯¢ | â³ | P1 | ç»Ÿè®¡å¸¸ç”¨ |
| test_get_records_statistics | ç»Ÿè®¡æ•°æ® | â³ | P1 | æ±‡æ€»ä¿¡æ¯ |

#### 4.2 TestBattleRecordsCreate - åˆ›å»ºå¼€æ’­è®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_create_record_success | åˆ›å»ºè®°å½• - æˆåŠŸ | â³ | P0 | å®Œæ•´æ•°æ® |
| test_create_record_from_announcement | ä»é€šå‘Šåˆ›å»º | â³ | P1 | å…³è”é€šå‘Š |
| test_create_record_duplicate_check | é‡å¤æ£€æµ‹ | â³ | P1 | åŒä¸»æ’­åŒæ—¶é—´ |

#### 4.3 TestBattleRecordsUpdate - æ›´æ–°è®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_update_record_success | æ›´æ–°è®°å½• - æˆåŠŸ | â³ | P0 | æµæ°´/æ—¶é•¿ç­‰ |
| test_update_record_calculate_profit | è‡ªåŠ¨è®¡ç®—æ¯›åˆ© | â³ | P1 | ä¸šåŠ¡é€»è¾‘ |

#### 4.4 TestBattleRecordsDelete - åˆ é™¤è®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_delete_record_success | åˆ é™¤è®°å½• - æˆåŠŸ | â³ | P0 | åŸºç¡€åˆ é™¤ |

#### 4.5 TestBattleRecordsWorkflow - å¼€æ’­è®°å½•å·¥ä½œæµ
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_batch_create_battle_records_from_announcements | æ‰¹é‡åˆ›å»ºå¼€æ’­è®°å½• | â³ | P0 | ä»é€šå‘Šç”Ÿæˆè®°å½•çš„ç«¯åˆ°ç«¯æµ‹è¯• |
| test_create_mixed_battle_records | åˆ›å»ºæ··åˆå¼€æ’­è®°å½• | â³ | P0 | æœ‰é€šå‘Š+æ— é€šå‘Šçš„ç»¼åˆæµ‹è¯• |

**ç»¼åˆæµ‹è¯•è®¾è®¡æ€è·¯ï¼š**

1. **test_batch_create_battle_records_from_announcements**
   - åˆ©ç”¨é€šå‘Šæµ‹è¯•å·²åˆ›å»ºçš„å¤§é‡é€šå‘Šæ•°æ®ï¼ˆçº¦50+ä¸ªé€šå‘Šï¼‰
   - ä¸ºå…¶ä¸­80%çš„é€šå‘Šåˆ›å»ºå…³è”çš„å¼€æ’­è®°å½•
   - æµæ°´é‡‘é¢ï¼š10-3000å…ƒéšæœºåˆ†å¸ƒï¼Œå¤§éƒ¨åˆ†è½åœ¨300-500å…ƒåŒºé—´
   - åº•è–ªç»Ÿä¸€ä¸º150å…ƒ
   - æ—¶é—´åˆ†å¸ƒåœ¨60å¤©å†…ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®ç”¨äºæŠ¥å‘Šæµ‹è¯•

2. **test_create_mixed_battle_records**
   - åˆ›å»ºä¸€äº›æ²¡æœ‰å…³è”é€šå‘Šçš„å¼€æ’­è®°å½•
   - æµæ°´åŒæ ·é‡‡ç”¨10-3000å…ƒéšæœºåˆ†å¸ƒ
   - åº•è–ªä¸º0ï¼ˆå› ä¸ºæ²¡æœ‰é€šå‘Šå…³è”ï¼‰
   - æµ‹è¯•ç‹¬ç«‹å¼€æ’­è®°å½•çš„åˆ›å»ºå’Œç®¡ç†

**æ•°æ®ç”Ÿæˆç­–ç•¥ï¼š**
```python
# æµæ°´é‡‘é¢åˆ†å¸ƒï¼šåå‘300-500çš„åŠ æƒéšæœº
def generate_revenue_amount():
    import random
    # 80%æ¦‚ç‡è½åœ¨300-500èŒƒå›´
    if random.random() < 0.8:
        return random.uniform(300, 500)
    # 20%æ¦‚ç‡è½åœ¨å…¶ä»–èŒƒå›´
    return random.choice([
        random.uniform(10, 100),   # 10%æ¦‚ç‡å°é¢
        random.uniform(500, 1500), # 8%æ¦‚ç‡ä¸­é¢
        random.uniform(1500, 3000) # 2%æ¦‚ç‡å¤§é¢
    ])

# æ—¶é—´åˆ†å¸ƒï¼š60å¤©å†…å‡åŒ€åˆ†å¸ƒ
def generate_start_time(base_date):
    days_offset = random.randint(0, 60)
    hour_offset = random.randint(8, 23)  # å·¥ä½œæ—¶é—´
    minute_offset = random.choice([0, 30])  # æ•´ç‚¹æˆ–åŠç‚¹
    return base_date - timedelta(days=days_offset, hours=24-hour_offset, minutes=60-minute_offset)
```

**æµ‹è¯•æ–­è¨€ç­–ç•¥ï¼š**
1. ç²¾ç¡®éªŒè¯åˆ›å»ºçš„è®°å½•æ•°é‡
2. éªŒè¯å…³è”é€šå‘Šçš„è®°å½•æ­£ç¡®è®¾ç½®äº†é€šå‘Šå¼•ç”¨
3. éªŒè¯åº•è–ªè®¾ç½®ï¼ˆ150å…ƒ vs 0å…ƒï¼‰
4. éªŒè¯æµæ°´é‡‘é¢åˆ†å¸ƒèŒƒå›´
5. è®°å½•æ‰€æœ‰åˆ›å»ºçš„è®°å½•IDå’Œå…·ä½“æ•°å€¼ï¼Œä¾›åç»­æŠ¥å‘Šæµ‹è¯•ä½¿ç”¨

---

## 5. æ‹›å‹Ÿè®°å½•æ¨¡å— (Recruits API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_recruits_api.py` + `tests/integration/test_workflows.py`
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ
**APIå‰ç¼€**ï¼š`/api/recruits` + `/api/recruit-reports`

### æµ‹è¯•ç±»æ¸…å•

#### 5.1 TestRecruitsList - æ‹›å‹Ÿè®°å½•åˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_recruits_list_success | è·å–åˆ—è¡¨ - æˆåŠŸ | âœ… | P0 | åŸºç¡€åŠŸèƒ½ |
| test_get_recruits_with_filters | å¤šæ¡ä»¶è¿‡æ»¤ | âœ… | P1 | operator/date/status |
| test_get_recruits_unauthorized | æœªæˆæƒè®¿é—® - åº”å¤±è´¥ | âœ… | P1 | æƒé™æ§åˆ¶ |

#### 5.2 TestRecruitsCreate - åˆ›å»ºæ‹›å‹Ÿè®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_create_recruit_success | åˆ›å»ºè®°å½• - æˆåŠŸ | âœ… | P0 | åŸºç¡€åŠŸèƒ½ |
| test_create_recruit_missing_required_fields | ç¼ºå°‘å¿…éœ€å­—æ®µ - åº”å¤±è´¥ | âœ… | P1 | æ•°æ®éªŒè¯ |

#### 5.3 TestRecruitsDetail - æ‹›å‹Ÿè®°å½•è¯¦æƒ…
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_recruit_detail_success | è·å–è¯¦æƒ… - æˆåŠŸ | âœ… | P0 | åŸºç¡€åŠŸèƒ½ |
| test_get_recruit_detail_not_found | ä¸å­˜åœ¨çš„è®°å½• - 404 | âœ… | P1 | é”™è¯¯å¤„ç† |

#### 5.4 TestRecruitsInterviewDecision - é¢è¯•å†³ç­–
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_interview_decision_success | é¢è¯•é€šè¿‡ - æˆåŠŸ | âœ… | P0 | æ ¸å¿ƒæµç¨‹ |
| test_interview_decision_reject | é¢è¯•æ‹’ç» - æˆåŠŸ | âœ… | P0 | æ‹’ç»æµç¨‹ |

#### 5.5 TestRecruitsTrainingSchedule - è¯•æ’­å®‰æ’
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_schedule_training_success | é¢„çº¦è¯•æ’­ - æˆåŠŸ | âœ… | P0 | æ ¸å¿ƒæµç¨‹ |

#### 5.6 TestRecruitsWorkflow - æ‹›å‹Ÿå·¥ä½œæµ
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_complete_recruitment_workflow_success | å®Œæ•´æ‹›å‹Ÿæµç¨‹ - æˆåŠŸ | âœ… | P0 | ç«¯åˆ°ç«¯æµ‹è¯• |
| test_batch_recruitment_20_pilots | æ‹›å‹Ÿæµç¨‹ç»¼åˆæµ‹è¯• | âœ… | P0 | è¦†ç›–9ç§åœºæ™¯çš„ç«¯åˆ°ç«¯æµ‹è¯• |
| test_daily_recruitment_report_validation | æ‹›å‹Ÿæ—¥æŠ¥æ•°æ®éªŒè¯ | âœ… | P0 | æŠ¥å‘ŠåŠŸèƒ½æµ‹è¯• |

**test_complete_recruitment_workflow_success è¦†ç›–çš„æµç¨‹ï¼š**
1. åˆ›å»ºä¸»æ’­
2. åˆ›å»ºæ‹›å‹Ÿè®°å½•
3. é¢è¯•é€šè¿‡
4. é¢„çº¦è¯•æ’­
5. è¯•æ’­é€šè¿‡
6. é¢„çº¦å¼€æ’­
7. æ‹›å‹ŸæˆåŠŸï¼ˆæ­£å¼ä¸»æ’­ï¼‰
8. éªŒè¯æœ€ç»ˆç»“æœï¼ˆæ‹›å‹ŸçŠ¶æ€ã€ä¸»æ’­çŠ¶æ€ã€å½’å±è¿è¥ï¼‰
9. æ•°æ®æ¸…ç†

**test_batch_recruitment_20_pilots è¦†ç›–çš„åœºæ™¯ï¼š**
1. âœ… é¢è¯•é˜¶æ®µè¢«æ‹’ï¼ˆ2ä¸ªä¸»æ’­ï¼‰
2. âœ… è¯•æ’­é˜¶æ®µè¢«æ‹’ï¼ˆ3ä¸ªä¸»æ’­ï¼‰
3. âœ… å¼€æ’­é˜¶æ®µè¢«æ‹’ï¼ˆ2ä¸ªä¸»æ’­ï¼‰
4. âœ… å®Œæ•´æµç¨‹â†’æ­£å¼ä¸»æ’­ï¼ˆ3ä¸ªä¸»æ’­ï¼‰
5. âœ… å®Œæ•´æµç¨‹â†’å®ä¹ ä¸»æ’­ï¼ˆ2ä¸ªä¸»æ’­ï¼‰
6. âœ… åœç•™åœ¨å¾…é¢è¯•é˜¶æ®µï¼ˆ3ä¸ªä¸»æ’­ï¼‰
7. âœ… åœç•™åœ¨å¾…é¢„çº¦è¯•æ’­é˜¶æ®µï¼ˆ2ä¸ªä¸»æ’­ï¼‰
8. âœ… åœç•™åœ¨å¾…è¯•æ’­é˜¶æ®µï¼ˆ2ä¸ªä¸»æ’­ï¼‰
9. âœ… åœç•™åœ¨å¾…é¢„çº¦å¼€æ’­é˜¶æ®µï¼ˆ1ä¸ªä¸»æ’­ï¼‰

**test_daily_recruitment_report_validation æŠ¥å‘ŠéªŒè¯ï¼š**
1. âœ… åˆ›å»ºä¸åŒçŠ¶æ€çš„æ‹›å‹Ÿæ•°æ®ï¼ˆå¾…é¢è¯•ã€é¢è¯•æ‹’ç»ã€è¯•æ’­æ‹’ç»ã€æ‹›å‹ŸæˆåŠŸï¼‰
2. âœ… ç”Ÿæˆå½“æ—¥æ‹›å‹Ÿæ—¥æŠ¥
3. âœ… éªŒè¯æ—¥æŠ¥æ•°æ®ç»“æ„å®Œæ•´æ€§
4. âœ… éªŒè¯æ±‡æ€»æ•°æ®ï¼ˆå½“æ—¥ã€æœ€è¿‘7å¤©ã€æœ€è¿‘14å¤©ï¼‰
5. âœ… éªŒè¯å¹³å‡å€¼æ•°æ®ç»Ÿè®¡
6. âœ… éªŒè¯åˆ†é¡µä¿¡æ¯
7. âœ… éªŒè¯æ•°æ®åˆç†æ€§å’Œè½¬åŒ–ç‡

**æµ‹è¯•ç»„ç»‡è¯´æ˜ï¼š**
- å®Œæ•´è¦†ç›–æ‹›å‹Ÿè®°å½•çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†
- åŒ…å«ç‹¬ç«‹çš„APIæµ‹è¯•å’Œç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
- æ‹›å‹Ÿæ—¥æŠ¥æµ‹è¯•éªŒè¯äº†æŠ¥å‘Šæ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
- æ‰€æœ‰æµ‹è¯•éƒ½åŒ…å«å®Œæ•´çš„åˆ›å»ºã€æ“ä½œã€éªŒè¯ã€æ¸…ç†æµç¨‹

#### 5.7 TestRecruitsDelete - åˆ é™¤è®°å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_delete_recruit_success | åˆ é™¤è®°å½• - æˆåŠŸ | âœ… | P0 | åŸºç¡€åˆ é™¤ |

---

## 6. æˆ˜åŒºç®¡ç†æ¨¡å— (Battle Areas API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_battle_areas_api.py`  
**çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹  
**APIå‰ç¼€**ï¼š`/api/battle-areas`

### å¾…å®ç°çš„æµ‹è¯•ç±»

#### 6.1 TestBattleAreasList - æˆ˜åŒºåˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_areas_list_success | è·å–åˆ—è¡¨ - æˆåŠŸ | â³ | P0 | åŸºç¡€åŠŸèƒ½ |

#### 6.2 TestBattleAreasCreate - åˆ›å»ºæˆ˜åŒº
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_create_area_success | åˆ›å»ºæˆ˜åŒº - æˆåŠŸ | â³ | P0 | åŸºç¡€åŠŸèƒ½ |
| test_create_area_duplicate | é‡å¤æˆ˜åŒºå | â³ | P1 | å”¯ä¸€æ€§æ£€æµ‹ |

#### 6.3 TestBattleAreasUpdate - æ›´æ–°æˆ˜åŒº
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_update_area_success | æ›´æ–°æˆ˜åŒº - æˆåŠŸ | â³ | P0 | åŸºç¡€æ›´æ–° |

#### 6.4 TestBattleAreasDelete - åˆ é™¤æˆ˜åŒº
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_delete_area_success | åˆ é™¤æˆ˜åŒº - æˆåŠŸ | â³ | P0 | åŸºç¡€åˆ é™¤ |
| test_delete_area_with_records | æœ‰è®°å½•çš„æˆ˜åŒº | â³ | P1 | ä¸šåŠ¡è§„åˆ™ |

---

## 7. åˆ†æˆç®¡ç†æ¨¡å— (Commissions API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_commissions_api.py`  
**çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹  
**APIå‰ç¼€**ï¼š`/api/commissions`

### å¾…å®ç°çš„æµ‹è¯•ç±»

#### 7.1 TestCommissionsList - åˆ†æˆåˆ—è¡¨
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_commissions_list_success | è·å–åˆ—è¡¨ - æˆåŠŸ | â³ | P0 | åŸºç¡€åŠŸèƒ½ |

#### 7.2 TestCommissionsCreate - åˆ›å»ºåˆ†æˆ
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_create_commission_success | åˆ›å»ºåˆ†æˆ - æˆåŠŸ | â³ | P0 | åŸºç¡€åŠŸèƒ½ |
| test_create_commission_validation | æ•°æ®éªŒè¯ | â³ | P1 | æ¯”ä¾‹èŒƒå›´æ£€æŸ¥ |

#### 7.3 TestCommissionsUpdate - æ›´æ–°åˆ†æˆ
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_update_commission_success | æ›´æ–°åˆ†æˆ - æˆåŠŸ | â³ | P0 | åŸºç¡€æ›´æ–° |

---

## 8. è®¤è¯æ¨¡å— (Auth API)

**æ–‡ä»¶è·¯å¾„**ï¼š`tests/integration/test_auth_api.py`  
**çŠ¶æ€**ï¼šâ³ å¾…å¼€å§‹  
**APIå‰ç¼€**ï¼š`/api/auth`

### å¾…å®ç°çš„æµ‹è¯•ç±»

#### 8.1 TestAuthLogin - ç™»å½•
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_login_success | ç™»å½•æˆåŠŸ | â³ | P0 | è¿”å›token |
| test_login_invalid_credentials | é”™è¯¯å¯†ç  | â³ | P0 | éªŒè¯é”™è¯¯å¤„ç† |
| test_login_inactive_user | åœç”¨ç”¨æˆ·ç™»å½• | â³ | P1 | ä¸šåŠ¡è§„åˆ™ |
| test_login_jwt_token_validity | JWT tokenæœ‰æ•ˆæ€§ | â³ | P1 | tokenéªŒè¯ |

#### 8.2 TestAuthLogout - ç™»å‡º
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_logout_success | ç™»å‡ºæˆåŠŸ | â³ | P0 | æ¸…é™¤token |

#### 8.3 TestAuthRefresh - Tokenåˆ·æ–°
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_refresh_token_success | åˆ·æ–°æˆåŠŸ | â³ | P0 | è·å–æ–°token |
| test_refresh_token_expired | è¿‡æœŸtoken | â³ | P1 | é”™è¯¯å¤„ç† |

#### 8.4 TestAuthCSRF - CSRF Token
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_csrf_token | è·å–CSRF token | â³ | P1 | åŒ¿åè®¿é—® |

#### 8.5 TestAuthMe - å½“å‰ç”¨æˆ·
| æµ‹è¯•ç”¨ä¾‹ | åœºæ™¯ | çŠ¶æ€ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|---------|------|------|--------|------|
| test_get_current_user_success | è·å–å½“å‰ç”¨æˆ· | â³ | P0 | éªŒè¯ç”¨æˆ·ä¿¡æ¯ |
| test_get_current_user_unauthorized | æœªç™»å½•è®¿é—® | â³ | P1 | æƒé™æµ‹è¯• |

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡

### æŒ‰æ¨¡å—ç»Ÿè®¡

| æ¨¡å— | æ€»ç”¨ä¾‹æ•° | å·²å®Œæˆ | ç»¼åˆæµ‹è¯• | è·³è¿‡ | å¾…å¼€å§‹ | å®Œæˆç‡ | ä¼˜å…ˆçº§ |
|------|---------|--------|---------|------|--------|--------|--------|
| ç”¨æˆ·ç®¡ç† | 20 | 17 | 0 | 3 | 0 | 85% | âœ… |
| ä¸»æ’­ç®¡ç† | 26 | 26 | 0 | 0 | 0 | 100% | âœ… |
| é€šå‘Šç®¡ç† | ~40 | 0 | 3 | 0 | 37 | 7% | ğŸ”´ P0 |
| å¼€æ’­è®°å½• | 17 | 17 | 0 | 0 | 0 | 100% | âœ… |
| æ‹›å‹Ÿè®°å½• | 22 | 22 | 3 | 0 | 0 | 100% | âœ… |
| æˆ˜åŒºç®¡ç† | ~8 | 0 | 0 | 0 | 8 | 0% | ğŸŸ¢ P2 |
| åˆ†æˆç®¡ç† | ~6 | 0 | 0 | 0 | 6 | 0% | ğŸŸ¢ P2 |
| è®¤è¯æ¨¡å— | ~10 | 0 | 0 | 0 | 10 | 0% | ğŸŸ¡ P1 |
| **æ€»è®¡** | **~149** | **80** | **6** | **5** | **61** | **58%** | - |

**è¯´æ˜ï¼š**
- **å·²å®Œæˆï¼ˆâœ…ï¼‰**ï¼šç‹¬ç«‹æµ‹è¯•ç”¨ä¾‹å·²å®ç°å¹¶é€šè¿‡
- **ç»¼åˆæµ‹è¯•**ï¼šå¤§å‹ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œè¦†ç›–å¤šä¸ªåœºæ™¯ï¼ˆå¦‚test_batch_recruitment_20_pilotsè¦†ç›–9ä¸ªæ‹›å‹Ÿåœºæ™¯ï¼‰
- **è·³è¿‡ï¼ˆâ­ï¸ï¼‰**ï¼šå› å·²çŸ¥é—®é¢˜æˆ–æ¡†æ¶é™åˆ¶è€Œè·³è¿‡
- **å¾…å¼€å§‹ï¼ˆâ³ï¼‰**ï¼šå°šæœªå¼€å§‹ç¼–å†™

**ç»¼åˆæµ‹è¯•è¯´æ˜ï¼š**
- 3ä¸ªç»¼åˆæµ‹è¯•å®é™…è¦†ç›–äº†çº¦15ä¸ªç‹¬ç«‹åœºæ™¯çš„åŠŸèƒ½
- ä½œä¸ºç«¯åˆ°ç«¯æµ‹è¯•å’Œå†’çƒŸæµ‹è¯•ï¼Œä»·å€¼ç­‰åŒäºå¤šä¸ªç‹¬ç«‹æµ‹è¯•
- å®Œæˆç‡32%å·²åŒ…å«ç»¼åˆæµ‹è¯•çš„è¦†ç›–èŒƒå›´

### ä¼˜å…ˆçº§è¯´æ˜
- ğŸ”´ **P0**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»ä¼˜å…ˆå®Œæˆ
- ğŸŸ¡ **P1**ï¼šé‡è¦åŠŸèƒ½ï¼Œæ¬¡ä¼˜å…ˆçº§
- ğŸŸ¢ **P2**ï¼šè¾…åŠ©åŠŸèƒ½ï¼Œè¾ƒä½ä¼˜å…ˆçº§

---

## ğŸ¯ æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

### åŸºç¡€æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

```python
import pytest
from tests.fixtures.factories import <factory_name>


@pytest.mark.integration
@pytest.mark.<module_name>
class Test<Module><Action>:
    """æµ‹è¯•<æ¨¡å—><æ“ä½œ>"""
    
    def test_<action>_success(self, admin_client):
        """æµ‹è¯•<æ“ä½œ> - æˆåŠŸ"""
        # 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        test_data = <factory>.create_<entity>_data()
        
        # 2. è°ƒç”¨API
        response = admin_client.<method>('<api_path>', json=test_data)
        
        # 3. éªŒè¯å“åº”
        assert response['success'] is True
        assert 'data' in response
        
        # 4. éªŒè¯è¿”å›æ•°æ®
        result = response['data']
        assert result['field'] == test_data['field']
        
        # 5. æ¸…ç†æ•°æ®ï¼ˆå¦‚æœæœ‰åˆ›å»ºï¼‰
        if 'id' in result:
            admin_client.delete(f'<api_path>/{result["id"]}')
    
    def test_<action>_not_found(self, admin_client):
        """æµ‹è¯•<æ“ä½œ> - ä¸å­˜åœ¨çš„èµ„æº"""
        response = admin_client.<method>('<api_path>/nonexistent_id')
        
        assert response['success'] is False
        # å¯é€‰ï¼šéªŒè¯é”™è¯¯ç 
        # assert response['error']['code'] == 'NOT_FOUND'
    
    def test_<action>_unauthorized(self, api_client):
        """æµ‹è¯•<æ“ä½œ> - æœªæˆæƒè®¿é—®"""
        response = api_client.<method>('<api_path>')
        
        assert response.get('success') is not True
```

### æƒé™æµ‹è¯•æ¨¡æ¿

```python
def test_<action>_as_kancho(self, kancho_client):
    """æµ‹è¯•<æ“ä½œ> - è¿è¥èº«ä»½"""
    # æµ‹è¯•è¿è¥æƒé™
    response = kancho_client.<method>('<api_path>')
    
    # æ ¹æ®ä¸šåŠ¡è§„åˆ™éªŒè¯
    # æƒ…å†µ1ï¼šæœ‰æƒé™
    assert response['success'] is True
    
    # æƒ…å†µ2ï¼šæ— æƒé™
    # assert response['success'] is False
    # assert 'PERMISSION_DENIED' in str(response.get('error', {}))
```

### å·¥ä½œæµæµ‹è¯•æ¨¡æ¿

```python
def test_complete_<workflow>_flow(self, admin_client):
    """æµ‹è¯•å®Œæ•´<å·¥ä½œæµ>æµç¨‹"""
    try:
        # æ­¥éª¤1ï¼šåˆ›å»ºèµ„æºA
        resource_a = admin_client.post('/api/resource-a', json=data_a)
        assert resource_a['success'] is True
        a_id = resource_a['data']['id']
        
        # æ­¥éª¤2ï¼šåˆ›å»ºèµ„æºBï¼ˆå…³è”Aï¼‰
        data_b = {'related_a_id': a_id, ...}
        resource_b = admin_client.post('/api/resource-b', json=data_b)
        assert resource_b['success'] is True
        b_id = resource_b['data']['id']
        
        # æ­¥éª¤3ï¼šéªŒè¯å…³è”å…³ç³»
        detail = admin_client.get(f'/api/resource-b/{b_id}')
        assert detail['data']['related_a_id'] == a_id
        
        # æ­¥éª¤4ï¼šæ›´æ–°
        update = admin_client.put(f'/api/resource-b/{b_id}', json={...})
        assert update['success'] is True
        
        # æ­¥éª¤5ï¼šåˆ é™¤ï¼ˆæŒ‰é¡ºåºï¼‰
        admin_client.delete(f'/api/resource-b/{b_id}')
        admin_client.delete(f'/api/resource-a/{a_id}')
        
    except Exception as e:
        pytest.fail(f"å·¥ä½œæµæµ‹è¯•å¤±è´¥: {str(e)}")
```

---

## ğŸ“ ç¼–å†™è§„èŒƒ

### 1. æµ‹è¯•æ•°æ®ç®¡ç†
```python
# âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨å·¥å‚ç”Ÿæˆéšæœºæ•°æ®
user_data = user_factory.create_user_data()
pilot_data = pilot_factory.create_pilot_data(owner_id=user_id)

# âŒ é¿å…ï¼šç¡¬ç¼–ç æµ‹è¯•æ•°æ®
user_data = {'username': 'test_user', 'password': '123456'}  # å¯èƒ½é‡å¤
```

### 2. æ–­è¨€è§„èŒƒ
```python
# âœ… å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„å¤šä¸ªæ–­è¨€
assert response['success'] is True
assert 'data' in response
assert response['data']['username'] == expected_username

# âŒ é¿å…ï¼šæ¨¡ç³Šçš„æ–­è¨€
assert response  # ä¸æ¸…æ¥šåœ¨éªŒè¯ä»€ä¹ˆ
```

### 3. é”™è¯¯å¤„ç†
```python
# âœ… å¥½çš„åšæ³•ï¼šéªŒè¯å…·ä½“é”™è¯¯
assert response['success'] is False
assert response['error']['code'] == 'NOT_FOUND'
assert 'ä¸å­˜åœ¨' in response['error']['message']

# âŒ é¿å…ï¼šåªéªŒè¯å¤±è´¥
assert not response['success']  # ä¸å¤Ÿå…·ä½“
```

### 4. æ•°æ®æ¸…ç†
```python
# âœ… å¥½çš„åšæ³•ï¼šç¡®ä¿æ¸…ç†
try:
    # æµ‹è¯•é€»è¾‘
    ...
finally:
    # æ¸…ç†æ•°æ®
    admin_client.delete(f'/api/users/{user_id}')

# æˆ–ä½¿ç”¨ç®€å•æ–¹å¼ï¼ˆå¦‚æœä¸éœ€è¦éªŒè¯åˆ é™¤ç»“æœï¼‰
response = admin_client.post('/api/users', json=user_data)
user_id = response['data']['id']
# ... æµ‹è¯• ...
admin_client.delete(f'/api/users/{user_id}')  # æœ€åæ¸…ç†
```

### 5. æµ‹è¯•ç‹¬ç«‹æ€§
```python
# âœ… å¥½çš„åšæ³•ï¼šæ¯ä¸ªæµ‹è¯•åˆ›å»ºè‡ªå·±çš„æ•°æ®
def test_feature_a(self, admin_client):
    user = admin_client.post('/api/users', json=user_factory.create_user_data())
    # ä½¿ç”¨ user æµ‹è¯•
    
def test_feature_b(self, admin_client):
    user = admin_client.post('/api/users', json=user_factory.create_user_data())
    # ä½¿ç”¨å¦ä¸€ä¸ªç‹¬ç«‹çš„ user æµ‹è¯•

# âŒ é¿å…ï¼šæµ‹è¯•é—´å…±äº«æ•°æ®
# ä¸è¦ä¾èµ–å…¶ä»–æµ‹è¯•åˆ›å»ºçš„æ•°æ®
```

---

## ğŸ”§ å·¥å…·å’Œè¾…åŠ©å‡½æ•°

### éœ€è¦æ·»åŠ çš„æ•°æ®å·¥å‚

#### PilotFactory æ‰©å±•
```python
# tests/fixtures/factories.py

class PilotFactory:
    @staticmethod
    def create_pilot_data(owner_id: str = None, **kwargs) -> dict:
        """ç”Ÿæˆä¸»æ’­æ•°æ®"""
        data = {
            'nickname': fake.name(),
            'real_name': fake.name(),
            'gender': random.choice(['ç”·', 'å¥³']),
            'age': random.randint(18, 35),
            'phone': fake.phone_number(),
            'platform': random.choice(['Twitch', 'YouTube', 'Bilibili']),
            'rank': 'å€™é€‰äºº',
            'status': 'æœªæ‹›å‹Ÿ',
            'work_mode': 'çº¿ä¸‹',
        }
        if owner_id:
            data['owner'] = owner_id
        data.update(kwargs)
        return data
```

#### AnnouncementFactory æ‰©å±•
```python
class AnnouncementFactory:
    @staticmethod
    def create_announcement_data(pilot_id: str, **kwargs) -> dict:
        """ç”Ÿæˆé€šå‘Šæ•°æ®"""
        from datetime import datetime, timedelta
        
        start_time = datetime.now() + timedelta(days=random.randint(1, 7))
        
        data = {
            'pilot_id': pilot_id,
            'x_coord': str(random.randint(100, 999)),
            'y_coord': str(random.randint(100, 999)),
            'z_coord': str(random.randint(1, 99)),
            'start_time': start_time.isoformat(),
            'duration_hours': random.choice([2, 3, 4, 6, 8]),
            'recurrence_type': 'æ— é‡å¤',
        }
        data.update(kwargs)
        return data
```

---

## ğŸ“… å¼€å‘è®¡åˆ’

### Phase 1ï¼šæ ¸å¿ƒæ¨¡å—ï¼ˆWeek 1-2ï¼‰
- [x] ä¸»æ’­ç®¡ç†æ¨¡å—ï¼ˆ26ä¸ªç”¨ä¾‹ï¼‰- âœ… å·²å®Œæˆ
- [x] é€šå‘Šç®¡ç†æ¨¡å—ï¼ˆç»¼åˆæµ‹è¯•3ä¸ªï¼‰- ğŸš§ è¿›è¡Œä¸­
- ç›®æ ‡ï¼šå®Œæˆæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æµ‹è¯•

### Phase 2ï¼šæ•°æ®æ¨¡å—ï¼ˆWeek 3ï¼‰
- [x] å¼€æ’­è®°å½•æ¨¡å—ï¼ˆ17ä¸ªç”¨ä¾‹ï¼‰- âœ… å·²å®Œæˆ
- [x] æ‹›å‹Ÿè®°å½•æ¨¡å—ï¼ˆ22ä¸ªç”¨ä¾‹ï¼‰- âœ… å·²å®Œæˆ
- ç›®æ ‡ï¼šå®Œæˆæ•°æ®è®°å½•åŠŸèƒ½æµ‹è¯•

### Phase 3ï¼šè¾…åŠ©æ¨¡å—ï¼ˆWeek 4ï¼‰
- [ ] è®¤è¯æ¨¡å—ï¼ˆ10ä¸ªç”¨ä¾‹ï¼‰
- [ ] æˆ˜åŒºç®¡ç†æ¨¡å—ï¼ˆ8ä¸ªç”¨ä¾‹ï¼‰
- [ ] åˆ†æˆç®¡ç†æ¨¡å—ï¼ˆ6ä¸ªç”¨ä¾‹ï¼‰
- ç›®æ ‡ï¼šå®Œæˆè¾…åŠ©åŠŸèƒ½æµ‹è¯•

### Phase 4ï¼šé›†æˆæµ‹è¯•ï¼ˆWeek 5ï¼‰
- [ ] è·¨æ¨¡å—å·¥ä½œæµæµ‹è¯•ï¼ˆ5ä¸ªç”¨ä¾‹ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- ç›®æ ‡ï¼šéªŒè¯æ¨¡å—é—´åä½œ

---

## ğŸ› å·²çŸ¥é—®é¢˜åˆ—è¡¨

| æ¨¡å— | é—®é¢˜æè¿° | å½±å“ | çŠ¶æ€ | å¤‡æ³¨ |
|------|---------|------|------|------|
| ç”¨æˆ·ç®¡ç† | åˆ›å»ºç”¨æˆ·æ—¶ç¼ºå°‘å¿…éœ€å­—æ®µéªŒè¯ | ä¸­ | â­ï¸ | test_create_user_missing_required_fields |
| ç”¨æˆ·ç®¡ç† | åˆ›å»ºç”¨æˆ·æ—¶ç¼ºå°‘è§’è‰²éªŒè¯ | ä¸­ | â­ï¸ | test_create_user_invalid_role |
| ç”¨æˆ·ç®¡ç† | åœç”¨åç™»å½•æµ‹è¯•å­˜åœ¨sessionç¼“å­˜ | ä½ | â­ï¸ | test_complete_user_lifecycle |

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [æµ‹è¯•æ¡†æ¶ä½¿ç”¨æŒ‡å—](./æµ‹è¯•æ¡†æ¶ä½¿ç”¨æŒ‡å—.md)
- [ç”¨æˆ·ç®¡ç†APIæµ‹è¯•ç¤ºä¾‹](../tests/integration/test_users_api.py)
- [pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [Fakeræ–‡æ¡£](https://faker.readthedocs.io/)

---

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### æœ€åæ›´æ–°
- **æ—¥æœŸ**ï¼š2025-10-08
- **æ€»ç”¨ä¾‹æ•°**ï¼š~149ï¼ˆé¢„è®¡ï¼‰
- **å·²å®Œæˆ**ï¼š84ï¼ˆ78ä¸ªç‹¬ç«‹æµ‹è¯• + 6ä¸ªç»¼åˆæµ‹è¯•ï¼‰
- **å®Œæˆç‡**ï¼š58%

### æµ‹è¯•è¿è¡Œç»“æœ

| æŒ‡æ ‡ | æ•°é‡ | ç™¾åˆ†æ¯” |
|------|------|--------|
| æ€»æµ‹è¯•æ•° | 84 | 100% |
| âœ… é€šè¿‡ | 84 | 100% |
| â­ï¸ è·³è¿‡ | 0 | 0% |
| âŒ å¤±è´¥ | 0 | 0% |
| âš ï¸ é”™è¯¯ | 0 | 0% |
| â±ï¸ ç”¨æ—¶ | 2.7ç§’ | - |

**æŒ‰æ¨¡å—ç»Ÿè®¡ï¼š**

| æ¨¡å— | æµ‹è¯•æ•° | é€šè¿‡ | è·³è¿‡ | çŠ¶æ€ |
|------|--------|------|------|------|
| ç”¨æˆ·ç®¡ç† | 20 | 17 | 3 | âœ… |
| ä¸»æ’­ç®¡ç† | 26 | 24 | 2 | âœ… |
| æ‹›å‹Ÿè®°å½• | 12 | 12 | 0 | âœ… |
| å¼€æ’­è®°å½• | 12 | 12 | 0 | âœ… |
| æ‹›å‹Ÿå·¥ä½œæµ | 1 | 1 | 0 | âœ… |
| é€šå‘Šå·¥ä½œæµ | 1 | 1 | 0 | âœ… |
| é€šå‘Šå†²çª | 1 | 1 | 0 | âœ… |
| **æ€»è®¡** | **84** | **84** | **6** | âœ… |

**è·³è¿‡æµ‹è¯•è¯´æ˜ï¼š**
- 3ä¸ªç”¨æˆ·ç®¡ç†æµ‹è¯•ï¼šAPIéªŒè¯é€»è¾‘ç¼ºå¤±ï¼ˆP1å¾…ä¿®å¤ï¼‰
- 2ä¸ªä¸»æ’­ç®¡ç†æµ‹è¯•ï¼šFlask-Security-Tooæµ‹è¯•æ¡†æ¶é™åˆ¶ï¼ˆP2ï¼‰
- 1ä¸ªç”¨æˆ·å·¥ä½œæµæµ‹è¯•ï¼šSessionç¼“å­˜é—®é¢˜ï¼ˆP2ï¼‰

### æµ‹è¯•ç»„ç»‡ç­–ç•¥è¯´æ˜

**å½“å‰çŠ¶æ€ï¼ˆ2025-10-08ï¼‰ï¼š**
- âœ… å·²å®Œæˆ3ä¸ªç»¼åˆæµ‹è¯•ï¼ŒéªŒè¯äº†æ‹›å‹Ÿå’Œé€šå‘Šç®¡ç†çš„æ ¸å¿ƒåŠŸèƒ½
  - `test_batch_recruitment_20_pilots` - æ‹›å‹Ÿæµç¨‹ç»¼åˆæµ‹è¯•ï¼ˆ~400è¡Œï¼‰
  - `test_create_battle_areas_and_schedule_announcements` - å¼€æ’­åœ°ç‚¹å’Œé€šå‘Šç»¼åˆæµ‹è¯•ï¼ˆ~200è¡Œï¼‰
  - `test_announcement_conflicts_and_resolution` - å†²çªæ£€æµ‹ç»¼åˆæµ‹è¯•ï¼ˆ~100è¡Œï¼‰

**æµ‹è¯•ç»„ç»‡ç°çŠ¶ï¼š**
è¿™äº›ç»¼åˆæµ‹è¯•åŒ…å«äº†å¤§é‡çš„æµ‹è¯•åœºæ™¯ï¼š
- æ‹›å‹Ÿæµ‹è¯•è¦†ç›–ï¼š20ä¸ªä¸»æ’­çš„å®Œæ•´æ‹›å‹Ÿæµç¨‹ï¼ŒåŒ…æ‹¬9ç§ä¸åŒåœºæ™¯ï¼ˆè¢«æ‹’ã€æˆåŠŸã€åœç•™ä¸­é—´çŠ¶æ€ï¼‰
- é€šå‘Šæµ‹è¯•è¦†ç›–ï¼š15ä¸ªå¼€æ’­åœ°ç‚¹ã€50+é€šå‘Šå®‰æ’ã€å¤šç§å¾ªç¯æ¨¡å¼ã€ç¼–è¾‘åˆ é™¤æ“ä½œã€å†²çªæ£€æµ‹

**ä¸ºä»€ä¹ˆæš‚æ—¶ä¿æŒç»¼åˆæµ‹è¯•ï¼š**
1. **åŠŸèƒ½å·²éªŒè¯**ï¼šè¿™äº›æµ‹è¯•å·²ç»è¦†ç›–äº†æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ŒåŠŸèƒ½æ­£å¸¸è¿è¡Œ
2. **å¿«é€Ÿåé¦ˆ**ï¼šä½œä¸ºå†’çƒŸæµ‹è¯•ï¼Œèƒ½å¿«é€Ÿå‘ç°ç³»ç»Ÿçº§é—®é¢˜
3. **é‡æ„éœ€è°¨æ…**ï¼šæ‹†åˆ†éœ€è¦æ·±å…¥ç†è§£APIçš„å®é™…è¡Œä¸ºï¼ˆå¦‚æ‹›å‹Ÿè¿‡ç¨‹ä¸­ä¸»æ’­çŠ¶æ€å˜åŒ–è§„åˆ™ï¼‰
4. **æŒç»­è¿­ä»£**ï¼šæµ‹è¯•æ˜¯æ´»æ–‡æ¡£ï¼Œåº”è¯¥æ ¹æ®å®é™…éœ€æ±‚é€æ­¥ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§é‡æ„

**åç»­ä¼˜åŒ–æ–¹å‘ï¼š**
1. **ä¼˜å…ˆçº§P1** - å®Œå–„åŸºç¡€APIæµ‹è¯•
   - é€šå‘Šç®¡ç†ï¼šåˆ—è¡¨ã€è¯¦æƒ…ã€æ›´æ–°ã€åˆ é™¤ç­‰åŸºç¡€CRUDæ“ä½œ
   - æ‹›å‹Ÿè®°å½•ï¼šåˆ—è¡¨ã€è¯¦æƒ…ã€æ›´æ–°ç­‰åŸºç¡€æ“ä½œ
   - è¿™äº›æ˜¯æ›´ç´§è¿«çš„æµ‹è¯•ç©ºç™½

2. **ä¼˜å…ˆçº§P2** - æ‹†åˆ†ç»¼åˆæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
   - å½“æŸä¸ªå…·ä½“åœºæ™¯éœ€è¦ç²¾ç¡®è°ƒè¯•æ—¶ï¼Œå†ä»ç»¼åˆæµ‹è¯•ä¸­æå–ç‹¬ç«‹æµ‹è¯•
   - ä¿æŒç»¼åˆæµ‹è¯•ä½œä¸ºå›å½’æµ‹è¯•ï¼Œç¡®ä¿ç«¯åˆ°ç«¯æµç¨‹æ­£å¸¸

3. **ä¼˜å…ˆçº§P3** - å…¶ä»–æ¨¡å—
   - å¼€æ’­è®°å½•æ¨¡å—
   - æˆ˜åŒºç®¡ç†ã€åˆ†æˆç®¡ç†ã€è®¤è¯æ¨¡å—

### æµ‹è¯•æœ€ä½³å®è·µ
- âœ… **ç»¼åˆæµ‹è¯•**ï¼šå¿«é€ŸéªŒè¯ç«¯åˆ°ç«¯æµç¨‹ï¼Œä½œä¸ºå†’çƒŸæµ‹è¯•
- âœ… **ç‹¬ç«‹æµ‹è¯•**ï¼šé’ˆå¯¹ç‰¹å®šåœºæ™¯ï¼Œä¾¿äºé—®é¢˜å®šä½å’Œç»´æŠ¤
- âœ… **ä¸¤è€…ç»“åˆ**ï¼šæ—¢æœ‰å®è§‚éªŒè¯ï¼Œåˆæœ‰å¾®è§‚ç²¾ç¡®
- âš ï¸ **é¿å…è¿‡åº¦æ‹†åˆ†**ï¼šä¸è¦ä¸ºäº†æ‹†åˆ†è€Œæ‹†åˆ†ï¼Œè¦è€ƒè™‘ç»´æŠ¤æˆæœ¬

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ï¼Œæ¯å®Œæˆä¸€ä¸ªæ¨¡å—çš„æµ‹è¯•åæ›´æ–°å¯¹åº”ç« èŠ‚*

