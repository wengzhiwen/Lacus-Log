# åŸºç¡€-ä»ªè¡¨æ¿è®¾è®¡

## æ¦‚è¿°

ä»ªè¡¨æ¿æ˜¯ç”¨æˆ·é¦–é¡µçš„æ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºå±•ç¤ºå…³é”®ä¸šåŠ¡æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯ã€‚é‡‡ç”¨å¡ç‰‡å¼è®¾è®¡ï¼Œæ”¯æŒå“åº”å¼å¸ƒå±€ï¼Œç¡®ä¿åœ¨ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯éƒ½æœ‰è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

## è®¾è®¡åŸåˆ™

- **æ•°æ®å±‚æ¬¡åŒ–**ï¼šä¸»è¦æ•°æ®çªå‡ºæ˜¾ç¤ºï¼Œå‰¯æ•°æ®ä½œä¸ºè¡¥å……ä¿¡æ¯
- **å“åº”å¼è®¾è®¡**ï¼šç§»åŠ¨ç«¯ä¼˜å…ˆï¼Œæ¡Œé¢ç«¯ä¼˜åŒ–
- **è§†è§‰ä¸€è‡´æ€§**ï¼šä¸æ•´ä½“UIé£æ ¼ä¿æŒä¸€è‡´
- **ä¿¡æ¯å¯†åº¦é€‚ä¸­**ï¼šé¿å…ä¿¡æ¯è¿‡è½½ï¼Œä¿æŒæ¸…æ™°å¯è¯»

## å¡ç‰‡è®¾è®¡è§„èŒƒ

### åŸºæœ¬ç»“æ„

æ¯ä¸ªå¡ç‰‡åŒ…å«ä»¥ä¸‹åŸºæœ¬å…ƒç´ ï¼š
- **å¡ç‰‡å¤´éƒ¨**ï¼šæ ‡é¢˜ + å›¾æ ‡
- **å¡ç‰‡ä¸»ä½“**ï¼šä¸»è¦æ•°æ® + å‰¯æ•°æ®ï¼ˆå¯é€‰ï¼‰

### ä¸‰ç§å¡ç‰‡å¸ƒå±€æ¨¡å¼

#### 1. å•ä¸»è¦æ•°æ®å¡ç‰‡
é€‚ç”¨äºåªéœ€è¦å±•ç¤ºä¸€ä¸ªæ ¸å¿ƒæŒ‡æ ‡çš„åœºæ™¯ã€‚

**HTMLç»“æ„ï¼š**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">æ•°æ®æ ‡é¢˜</div>
    <div class="card-icon">ğŸ“Š</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">123</div>
      <div class="main-label">æ•°æ®è¯´æ˜</div>
    </div>
  </div>
</div>
```

**CSSæ ·å¼ï¼š**
```css
.card-body {
  padding: 0;
}

.main-data {
  text-align: center;
  padding: 20px 0;
}

.main-value {
  font-size: 36px;
  font-weight: 700;
  color: var(--brand);
  margin-bottom: 8px;
  line-height: 1;
}

.main-label {
  font-size: 16px;
  color: var(--text);
  font-weight: 600;
}
```

#### 2. 1ä¸ªä¸»è¦æ•°æ® + 1ä¸ªå‰¯æ•°æ®å¡ç‰‡
é€‚ç”¨äºéœ€è¦å±•ç¤ºæ ¸å¿ƒæŒ‡æ ‡å’Œ1ä¸ªç›¸å…³è¡¥å……ä¿¡æ¯çš„åœºæ™¯ã€‚

**HTMLç»“æ„ï¼š**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">æ•°æ®æ ‡é¢˜</div>
    <div class="card-icon">ğŸ“Š</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">123</div>
      <div class="main-label">ä¸»è¦æ•°æ®è¯´æ˜</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value">+15.2%</div>
        <div class="sub-label">å‰¯æ•°æ®è¯´æ˜</div>
      </div>
    </div>
  </div>
</div>
```

**CSSæ ·å¼ï¼š**
```css
.main-data {
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--table-header);
}

.sub-data {
  display: flex;
  justify-content: center;
  gap: 20px;
}

.sub-item {
  text-align: center;
}

.sub-value {
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
  line-height: 1;
}

.sub-label {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}
```

#### 3. 1ä¸ªä¸»è¦æ•°æ® + 2ä¸ªå‰¯æ•°æ®å¡ç‰‡ï¼ˆå½“å‰å®ç°ï¼‰
é€‚ç”¨äºéœ€è¦å±•ç¤ºæ ¸å¿ƒæŒ‡æ ‡å’Œ2ä¸ªç›¸å…³è¡¥å……ä¿¡æ¯çš„åœºæ™¯ã€‚

**HTMLç»“æ„ï¼š**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">æ•°æ®æ ‡é¢˜</div>
    <div class="card-icon">ğŸ“Š</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">123</div>
      <div class="main-label">ä¸»è¦æ•°æ®è¯´æ˜</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value positive">+15.2%</div>
        <div class="sub-label">å‰¯æ•°æ®1</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">8.5</div>
        <div class="sub-label">å‰¯æ•°æ®2</div>
      </div>
    </div>
  </div>
</div>
```

**CSSæ ·å¼ï¼š**
```css
.main-data {
  text-align: center;
  margin-bottom: 20px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--table-header);
}

.sub-data {
  display: flex;
  justify-content: space-around;
  gap: 20px;
}

.sub-item {
  text-align: center;
  flex: 1;
}

.sub-value {
  font-size: 20px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
  line-height: 1;
}

.sub-value.positive {
  color: var(--hud-green);
}

.sub-value.negative {
  color: var(--error);
}

.sub-label {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}
```

## é€šç”¨æ ·å¼è§„èŒƒ

### å¡ç‰‡åŸºç¡€æ ·å¼
```css
.card { 
  border: 1px solid var(--gray); 
  border-radius: 12px; 
  padding: 20px; 
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transition: all 0.2s ease;
}

.card:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.12);
  transform: translateY(-2px);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.card-title { 
  font-weight: 600; 
  font-size: 16px;
  color: var(--text); 
  margin: 0;
}

.card-icon {
  font-size: 24px;
  opacity: 0.7;
}
```

### é¢œè‰²è§„èŒƒ
- **ä¸»è¦æ•°æ®**ï¼šä½¿ç”¨å“ç‰Œè‰² `var(--brand)` (#8B0000)
- **æ­£æ•°å˜åŒ–**ï¼šä½¿ç”¨ç»¿è‰² `var(--hud-green)` (#00B37A)
- **è´Ÿæ•°å˜åŒ–**ï¼šä½¿ç”¨çº¢è‰² `var(--error)` (#FF4500)
- **æ™®é€šå‰¯æ•°æ®**ï¼šä½¿ç”¨æ–‡æœ¬è‰² `var(--text)` (#111111)
- **æ ‡ç­¾æ–‡å­—**ï¼šä½¿ç”¨ç°è‰² `var(--muted)` (#666666)

### å­—ä½“è§„èŒƒ
- **ä¸»è¦æ•°æ®æ•°å€¼**ï¼š36pxï¼Œç²—ä½“ï¼Œè¡Œé«˜1
- **ä¸»è¦æ•°æ®æ ‡ç­¾**ï¼š16pxï¼Œä¸­ç­‰ç²—ç»†
- **å‰¯æ•°æ®æ•°å€¼**ï¼š20pxï¼ˆç§»åŠ¨ç«¯ï¼‰/ 24pxï¼ˆæ¡Œé¢ç«¯ï¼‰ï¼Œä¸­ç­‰ç²—ç»†
- **å‰¯æ•°æ®æ ‡ç­¾**ï¼š12pxï¼ˆç§»åŠ¨ç«¯ï¼‰/ 14pxï¼ˆæ¡Œé¢ç«¯ï¼‰ï¼Œä¸­ç­‰ç²—ç»†

## å“åº”å¼è®¾è®¡

### ç§»åŠ¨ç«¯ï¼ˆé»˜è®¤ï¼‰
- å¡ç‰‡å®½åº¦è‡ªé€‚åº”å±å¹•å®½åº¦
- å‰¯æ•°æ®é—´è·ï¼š20px
- å‰¯æ•°æ®å­—ä½“ï¼š20px

### æ¡Œé¢ç«¯ï¼ˆ768px+ï¼‰
- å¡ç‰‡æœ€å¤§å®½åº¦ï¼š600pxï¼Œå±…ä¸­æ˜¾ç¤º
- å‰¯æ•°æ®é—´è·ï¼š40px
- å‰¯æ•°æ®å­—ä½“ï¼š24px

```css
@media (min-width: 768px) {
  .dashboard .cards {
    max-width: 600px;
    margin: 0 auto;
  }
  
  .sub-data {
    gap: 40px;
  }
  
  .sub-value {
    font-size: 24px;
  }
  
  .sub-label {
    font-size: 14px;
  }
}
```

## å¸ƒå±€å®¹å™¨

### å¡ç‰‡å®¹å™¨
```css
.dashboard .cards { 
  display: grid; 
  grid-template-columns: 1fr; 
  gap: 16px; 
}
```

### é¡µé¢ç»“æ„
```html
<section class="dashboard">
  <h1 class="title">ä»ªè¡¨ç›˜</h1>
  <div class="cards">
    <!-- å¡ç‰‡å†…å®¹ -->
  </div>
</section>
```

## ä½¿ç”¨æŒ‡å—

### åˆ›å»ºæ–°å¡ç‰‡æ­¥éª¤

1. **ç¡®å®šæ•°æ®ç±»å‹**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©1ç§ã€2ç§æˆ–3ç§æ•°æ®å¸ƒå±€
2. **é€‰æ‹©å›¾æ ‡**ï¼šä½¿ç”¨åˆé€‚çš„emojiå›¾æ ‡ï¼Œå»ºè®®ä½¿ç”¨ğŸ“ŠğŸ“ˆğŸ“…ğŸ“‹ç­‰
3. **ç¼–å†™HTML**ï¼šæŒ‰ç…§å¯¹åº”çš„HTMLç»“æ„æ¨¡æ¿ç¼–å†™
4. **åº”ç”¨æ ·å¼**ï¼šç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„CSSç±»å
5. **æµ‹è¯•å“åº”å¼**ï¼šåœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æµ‹è¯•æ˜¾ç¤ºæ•ˆæœ

### æ•°æ®è®¡ç®—å»ºè®®

- **ä¸»è¦æ•°æ®**ï¼šé€‰æ‹©æœ€æ ¸å¿ƒçš„ä¸šåŠ¡æŒ‡æ ‡
- **å‰¯æ•°æ®**ï¼šé€‰æ‹©ä¸ä¸»è¦æ•°æ®ç›¸å…³çš„è¡¥å……ä¿¡æ¯
- **æ•°å€¼æ ¼å¼**ï¼šç™¾åˆ†æ¯”ä¿ç•™1ä½å°æ•°ï¼Œå…¶ä»–æ•°å€¼æ ¹æ®ç²¾åº¦éœ€æ±‚ç¡®å®š
- **é¢œè‰²åº”ç”¨**ï¼šæ­£è´Ÿå˜åŒ–ä½¿ç”¨é¢œè‰²åŒºåˆ†ï¼Œæ™®é€šæ•°å€¼ä½¿ç”¨é»˜è®¤é¢œè‰²

## ç¤ºä¾‹å®ç°

### å¾å¬ç»Ÿè®¡å¡ç‰‡

å¾å¬ç»Ÿè®¡å¡ç‰‡å±•ç¤ºå¾å¬æµç¨‹çš„å…³é”®æŒ‡æ ‡ï¼Œé‡‡ç”¨1ä¸ªä¸»è¦æ•°æ® + 2ä¸ªå‰¯æ•°æ®çš„å¸ƒå±€æ¨¡å¼ï¼š

**åç«¯æ•°æ®è®¡ç®—ï¼š**
```python
def _calculate_dashboard_data():
    """è®¡ç®—ä»ªè¡¨æ¿æ•°æ®"""
    now = get_current_utc_time()
    
    # å¾å¬ç»Ÿè®¡ï¼ˆä½¿ç”¨æœ¬åœ°æ—¶é—´è¿›è¡Œæ—¥æœŸå½’å±ï¼Œä¸å¾å¬æ—¥æŠ¥ä¿æŒä¸€è‡´ï¼‰
    # è·å–ä»Šæ—¥çš„æœ¬åœ°æ—¶é—´èŒƒå›´
    current_local = utc_to_local(now)
    today_local_start = current_local.replace(hour=0, minute=0, second=0, microsecond=0)
    today_local_end = today_local_start + timedelta(days=1)
    
    # è½¬æ¢ä¸ºUTCæ—¶é—´èŒƒå›´
    today_start_utc = local_to_utc(today_local_start)
    today_end_utc = local_to_utc(today_local_end)
    
    # ä»Šæ—¥çº¦é¢ï¼šä»Šæ—¥åˆ›å»ºçš„å¾å¬æ•°é‡
    recruit_today_appointments = Recruit.objects(created_at__gte=today_start_utc, created_at__lt=today_end_utc).count()
    
    # ä»Šæ—¥åˆ°é¢ï¼šä»Šæ—¥å‘ç”Ÿçš„é¢è¯•å†³ç­–æ•°é‡ï¼ˆæ–°å…­æ­¥åˆ¶ + å†å²å…¼å®¹ï¼‰
    from mongoengine import Q
    interviews_query = (
        Q(interview_decision_time__gte=today_start_utc, interview_decision_time__lt=today_end_utc) |
        Q(training_decision_time_old__gte=today_start_utc, training_decision_time_old__lt=today_end_utc)
    )
    recruit_today_interviews = Recruit.objects.filter(interviews_query).count()
    
    # ä»Šæ—¥æ–°å¼€æ’­ï¼šä»Šæ—¥åœ¨å¼€æ’­å†³ç­–ä¸­å†³å®šå¾å¬çš„æ•°é‡ï¼ˆä¸å¾å¬ä¸ç®—ï¼‰
    from models.recruit import BroadcastDecision
    new_recruits_query = (
        Q(broadcast_decision_time__gte=today_start_utc, broadcast_decision_time__lt=today_end_utc,
          broadcast_decision__in=[BroadcastDecision.OFFICIAL, BroadcastDecision.INTERN]) |
        Q(final_decision_time__gte=today_start_utc, final_decision_time__lt=today_end_utc,
          final_decision__in=[FinalDecision.OFFICIAL, FinalDecision.INTERN])
    )
    recruit_today_new_recruits = Recruit.objects.filter(new_recruits_query).count()
    
    return {
        # å¾å¬ç»Ÿè®¡
        'recruit_today_appointments': recruit_today_appointments,
        'recruit_today_interviews': recruit_today_interviews,
        'recruit_today_new_recruits': recruit_today_new_recruits,
    }
```

**å‰ç«¯æ¨¡æ¿ï¼š**
```html
<div class="card" id="recruitCard" style="cursor: pointer;">
  <div class="card-header">
    <div class="card-title">å¾å¬ç»Ÿè®¡</div>
    <div class="card-icon">ğŸ“‹</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">{{ dashboard_data.recruit_today_appointments }}</div>
      <div class="main-label">ä»Šæ—¥çº¦é¢</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value">{{ dashboard_data.recruit_today_interviews }}</div>
        <div class="sub-label">ä»Šæ—¥åˆ°é¢</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">{{ dashboard_data.recruit_today_new_recruits }}</div>
        <div class="sub-label">ä»Šæ—¥æ–°å¼€æ’­</div>
      </div>
    </div>
  </div>
</div>
```

**äº¤äº’åŠŸèƒ½ï¼š**
```javascript
// è®¾ç½®å¾å¬ç»Ÿè®¡å¡ç‰‡çš„ç‚¹å‡»äº‹ä»¶
const recruitCard = document.getElementById('recruitCard');
if (recruitCard) {
  recruitCard.addEventListener('click', function() {
    window.location.href = '{{ url_for('recruit.recruit_daily_report') }}';
  });
}
```

**æ•°æ®è¯´æ˜ï¼š**
- **ä»Šæ—¥çº¦é¢**ï¼šåŸºäºRecruitæ¨¡å‹çš„created_atå­—æ®µï¼Œç»Ÿè®¡ä»Šæ—¥åˆ›å»ºçš„å¾å¬è®°å½•æ•°é‡
- **ä»Šæ—¥åˆ°é¢**ï¼šåŸºäºinterview_decision_timeå­—æ®µï¼ˆæ–°å…­æ­¥åˆ¶ï¼‰æˆ–training_decision_time_oldå­—æ®µï¼ˆå†å²å…¼å®¹ï¼‰ï¼Œç»Ÿè®¡ä»Šæ—¥å®Œæˆé¢è¯•å†³ç­–çš„æ•°é‡
- **ä»Šæ—¥æ–°å¼€æ’­**ï¼šåŸºäºbroadcast_decision_timeå’Œbroadcast_decisionå­—æ®µï¼ˆæ–°å…­æ­¥åˆ¶ï¼‰æˆ–final_decision_timeå’Œfinal_decisionå­—æ®µï¼ˆå†å²å…¼å®¹ï¼‰ï¼Œç»Ÿè®¡ä»Šæ—¥åœ¨å¼€æ’­å†³ç­–ä¸­å†³å®šå¾å¬çš„æ•°é‡
- **è·³è½¬åŠŸèƒ½**ï¼šç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°å¾å¬æ—¥æŠ¥é¡µé¢ï¼Œæä¾›æ›´è¯¦ç»†çš„å¾å¬æ•°æ®åˆ†æ
- **æ—¶é—´å¤„ç†**ï¼šä½¿ç”¨æœ¬åœ°æ—¶é—´è¿›è¡Œæ—¥æœŸå½’å±ï¼Œç„¶åè½¬æ¢ä¸ºUTCæ—¶é—´è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œç¡®ä¿ä¸å¾å¬æ—¥æŠ¥æ•°æ®ä¸€è‡´
- **å†å²æ•°æ®å…¼å®¹**ï¼šæ”¯æŒæ–°å…­æ­¥åˆ¶å­—æ®µå’Œå†å²åºŸå¼ƒå­—æ®µçš„æŸ¥è¯¢ï¼Œç¡®ä¿æ–°æ—§æ•°æ®éƒ½èƒ½æ­£ç¡®ç»Ÿè®¡

### ä½œæˆ˜è®¡åˆ’ç»Ÿè®¡å¡ç‰‡

å½“å‰ä½œæˆ˜è®¡åˆ’ç»Ÿè®¡å¡ç‰‡çš„å®Œæ•´å®ç°ï¼š

**åç«¯æ•°æ®è®¡ç®—ï¼š**
```python
def _calculate_dashboard_data():
    """è®¡ç®—ä»ªè¡¨æ¿æ•°æ®"""
    now = get_current_utc_time()
    today_start = now.replace(hour=0, minute=0, second=0, microsecond=0)
    today_end = today_start + timedelta(days=1)
    yesterday_start = today_start - timedelta(days=1)
    yesterday_end = today_start
    week_start = today_start - timedelta(days=7)
    
    # ä»Šæ—¥ä½œæˆ˜è®¡åˆ’æ•°é‡
    today_count = Announcement.objects(
        start_time__gte=today_start,
        start_time__lt=today_end
    ).count()
    
    # æ˜¨æ—¥ä½œæˆ˜è®¡åˆ’æ•°é‡
    yesterday_count = Announcement.objects(
        start_time__gte=yesterday_start,
        start_time__lt=yesterday_end
    ).count()
    
    # è®¡ç®—ç¯æ¯”
    if yesterday_count > 0:
        change_rate = round(((today_count - yesterday_count) / yesterday_count) * 100, 1)
    else:
        change_rate = 100.0 if today_count > 0 else 0.0
    
    # æœ€è¿‘7å¤©çš„æ—¥å‡ä½œæˆ˜è®¡åˆ’æ•°é‡
    week_count = Announcement.objects(
        start_time__gte=week_start,
        start_time__lt=today_end
    ).count()
    week_avg = round(week_count / 7, 1)
    
    return {
        'today_count': today_count,
        'change_rate': change_rate,
        'week_avg': week_avg
    }
```

**å‰ç«¯æ¨¡æ¿ï¼š**
```html
<div class="card">
  <div class="card-header">
    <div class="card-title">ä½œæˆ˜è®¡åˆ’ç»Ÿè®¡</div>
    <div class="card-icon">ğŸ“Š</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">{{ dashboard_data.today_count }}</div>
      <div class="main-label">ä»Šæ—¥ä½œæˆ˜è®¡åˆ’</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value {% if dashboard_data.change_rate >= 0 %}positive{% else %}negative{% endif %}">
          {% if dashboard_data.change_rate >= 0 %}+{% endif %}{{ dashboard_data.change_rate }}%
        </div>
        <div class="sub-label">ç¯æ¯”</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">{{ dashboard_data.week_avg }}</div>
        <div class="sub-label">7æ—¥å¹³å‡</div>
      </div>
    </div>
  </div>
</div>
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®æ›´æ–°**ï¼šç¡®ä¿åç«¯æ•°æ®è®¡ç®—é€»è¾‘æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯æ—¶é—´èŒƒå›´çš„è®¡ç®—
2. **æ€§èƒ½è€ƒè™‘**ï¼šé¿å…åœ¨ä»ªè¡¨æ¿ä¸­è¿›è¡Œå¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢
3. **é”™è¯¯å¤„ç†**ï¼šå½“æ•°æ®ä¸ºç©ºæˆ–å¼‚å¸¸æ—¶ï¼Œæä¾›åˆç†çš„é»˜è®¤å€¼
4. **å¯è®¿é—®æ€§**ï¼šç¡®ä¿é¢œè‰²ä¸æ˜¯å”¯ä¸€çš„åŒºåˆ†æ–¹å¼ï¼Œé…åˆæ–‡å­—è¯´æ˜
5. **å›½é™…åŒ–**ï¼šå¦‚æœæ”¯æŒå¤šè¯­è¨€ï¼Œç¡®ä¿æ‰€æœ‰æ–‡å­—éƒ½å¯ä»¥æœ¬åœ°åŒ–

### ä½œæˆ˜è®°å½•ç»Ÿè®¡å¡ç‰‡

ä½œæˆ˜è®°å½•ç»Ÿè®¡å¡ç‰‡å±•ç¤ºæµæ°´é‡‘é¢æ•°æ®ï¼Œé‡‡ç”¨1ä¸ªä¸»è¦æ•°æ® + 2ä¸ªå‰¯æ•°æ®çš„å¸ƒå±€æ¨¡å¼ï¼š

**åç«¯æ•°æ®è®¡ç®—ï¼š**
```python
def _calculate_dashboard_data():
    """è®¡ç®—ä»ªè¡¨æ¿æ•°æ®"""
    now = get_current_utc_time()
    
    # ä½¿ç”¨GMT+8æœ¬åœ°æ—¶é—´è¿›è¡Œæ—¥æœŸå½’å±ï¼Œä¸å¾å¬æ—¥æŠ¥ä¿æŒä¸€è‡´
    current_local = utc_to_local(now)
    today_local_start = current_local.replace(hour=0, minute=0, second=0, microsecond=0)
    today_local_end = today_local_start + timedelta(days=1)
    yesterday_local_start = today_local_start - timedelta(days=1)
    yesterday_local_end = today_local_start
    week_local_start = today_local_start - timedelta(days=7)
    
    # è½¬æ¢ä¸ºUTCæ—¶é—´èŒƒå›´è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
    today_start_utc = local_to_utc(today_local_start)
    today_end_utc = local_to_utc(today_local_end)
    yesterday_start_utc = local_to_utc(yesterday_local_start)
    yesterday_end_utc = local_to_utc(yesterday_local_end)
    week_start_utc = local_to_utc(week_local_start)
    
    # ä½œæˆ˜è®°å½•ç»Ÿè®¡ï¼ˆæµæ°´é‡‘é¢ç»Ÿè®¡ï¼‰
    # ä»Šæ—¥æµæ°´ï¼ˆæ‰€æœ‰ä½œæˆ˜è®°å½•ä¸­çš„å¼€å§‹æ—¥æœŸä¸ºä»Šå¤©çš„ä½œæˆ˜è®°å½•çš„æµæ°´æ€»å’Œï¼‰
    br_today_records = BattleRecord.objects(start_time__gte=today_start_utc, start_time__lt=today_end_utc)
    br_today_revenue = sum(record.revenue_amount for record in br_today_records)
    
    # æ˜¨æ—¥æµæ°´
    br_yesterday_records = BattleRecord.objects(start_time__gte=yesterday_start_utc, start_time__lt=yesterday_end_utc)
    br_yesterday_revenue = sum(record.revenue_amount for record in br_yesterday_records)
    
    # 7æ—¥å¹³å‡æµæ°´
    br_week_records = BattleRecord.objects(start_time__gte=week_start_utc, start_time__lt=today_end_utc)
    br_week_revenue = sum(record.revenue_amount for record in br_week_records)
    br_week_avg_revenue = br_week_revenue / 7
    
    return {
        # ä½œæˆ˜è®°å½•ç»Ÿè®¡
        'battle_today_revenue': br_today_revenue,
        'battle_yesterday_revenue': br_yesterday_revenue,
        'battle_week_avg_revenue': br_week_avg_revenue,
    }
```

**å‰ç«¯æ¨¡æ¿ï¼š**
```html
<div class="card" id="battleRecordCard" style="cursor: pointer;">
  <div class="card-header">
    <div class="card-title">ä½œæˆ˜è®°å½•ç»Ÿè®¡</div>
    <div class="card-icon">ğŸ“ˆ</div>
  </div>
  <div class="card-body">
    <div class="main-data">
      <div class="main-value">{{ "{:,.0f}".format(dashboard_data.battle_today_revenue) }}</div>
      <div class="main-label">ä»Šæ—¥æµæ°´ï¼ˆå…ƒï¼‰</div>
    </div>
    <div class="sub-data">
      <div class="sub-item">
        <div class="sub-value">{{ "{:,.0f}".format(dashboard_data.battle_yesterday_revenue) }}</div>
        <div class="sub-label">æ˜¨æ—¥æµæ°´</div>
      </div>
      <div class="sub-item">
        <div class="sub-value">{{ "{:,.0f}".format(dashboard_data.battle_week_avg_revenue) }}</div>
        <div class="sub-label">7æ—¥å¹³å‡æµæ°´</div>
      </div>
    </div>
  </div>
</div>
```

**äº¤äº’åŠŸèƒ½ï¼š**
```javascript
// è®¾ç½®ä½œæˆ˜è®°å½•ç»Ÿè®¡å¡ç‰‡çš„ç‚¹å‡»äº‹ä»¶
const battleRecordCard = document.getElementById('battleRecordCard');
if (battleRecordCard) {
  battleRecordCard.addEventListener('click', function() {
    window.location.href = '{{ url_for('report.daily_report') }}';
  });
}
```

**æ•°æ®æ ¼å¼è¯´æ˜ï¼š**
- **é‡‘é¢æ˜¾ç¤º**ï¼šä½¿ç”¨åƒåˆ†ä½æ ¼å¼åŒ– `"{:,.0f}".format()` æ˜¾ç¤ºé‡‘é¢
- **å•ä½æ ‡è¯†**ï¼šä¸»æ•°æ®æ ‡ç­¾åŒ…å«"ï¼ˆå…ƒï¼‰"å•ä½è¯´æ˜
- **ç²¾åº¦æ§åˆ¶**ï¼šä¸ä¿ç•™å°æ•°ï¼Œæ˜¾ç¤ºæ•´æ•°é‡‘é¢
- **æ•°æ®æ¥æº**ï¼šåŸºäºBattleRecordæ¨¡å‹çš„revenue_amountå­—æ®µè®¡ç®—
- **æ—¶é—´å¤„ç†**ï¼šä½¿ç”¨GMT+8æœ¬åœ°æ—¶é—´è¿›è¡Œæ—¥æœŸå½’å±ï¼Œç¡®ä¿ä¸å¾å¬æ—¥æŠ¥ç­‰æ¨¡å—çš„æ—¶é—´åŸºå‡†ä¸€è‡´
- **äº¤äº’åŠŸèƒ½**ï¼šç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°ä½œæˆ˜æ—¥æŠ¥é¡µé¢ï¼Œæä¾›æ›´è¯¦ç»†çš„ä½œæˆ˜æ•°æ®åˆ†æ

## æ—¶é—´å¤„ç†è§„èŒƒ

### ç»Ÿä¸€æ—¶é—´å¤„ç†åŸåˆ™

ä»ªè¡¨æ¿ä¸­çš„æ‰€æœ‰ç»Ÿè®¡æ•°æ®éƒ½éµå¾ªç»Ÿä¸€çš„æ—¶é—´å¤„ç†è§„èŒƒï¼š

1. **æ—¥æœŸå½’å±**ï¼šä½¿ç”¨GMT+8æœ¬åœ°æ—¶é—´è¿›è¡Œæ—¥æœŸå½’å±
2. **æ•°æ®åº“æŸ¥è¯¢**ï¼šå°†æœ¬åœ°æ—¶é—´è½¬æ¢ä¸ºUTCæ—¶é—´è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
3. **æ—¶é—´è½¬æ¢**ï¼šä½¿ç”¨ `utils/timezone_helper.py` ä¸­çš„ `utc_to_local()` å’Œ `local_to_utc()` å‡½æ•°
4. **ä¸€è‡´æ€§ä¿è¯**ï¼šä¸å¾å¬æ—¥æŠ¥ã€ä½œæˆ˜æ—¥æŠ¥ç­‰æ¨¡å—ä¿æŒæ—¶é—´åŸºå‡†ä¸€è‡´

### æ—¶é—´å¤„ç†æµç¨‹

```python
# 1. è·å–å½“å‰UTCæ—¶é—´
now = get_current_utc_time()

# 2. è½¬æ¢ä¸ºGMT+8æœ¬åœ°æ—¶é—´
current_local = utc_to_local(now)

# 3. è®¡ç®—æœ¬åœ°æ—¶é—´çš„æ—¥æœŸèŒƒå›´
today_local_start = current_local.replace(hour=0, minute=0, second=0, microsecond=0)
today_local_end = today_local_start + timedelta(days=1)

# 4. è½¬æ¢ä¸ºUTCæ—¶é—´èŒƒå›´è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
today_start_utc = local_to_utc(today_local_start)
today_end_utc = local_to_utc(today_local_end)

# 5. æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
records = Model.objects(start_time__gte=today_start_utc, start_time__lt=today_end_utc)
```

### æ—¶é—´å¤„ç†çš„é‡è¦æ€§

- **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿ä¸åŒæ¨¡å—çš„ç»Ÿè®¡æ•°æ®åŸºäºç›¸åŒçš„æ—¶é—´åŸºå‡†
- **ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·çœ‹åˆ°çš„"ä»Šæ—¥"ã€"æ˜¨æ—¥"ç­‰æ¦‚å¿µä¸å®é™…ä¸šåŠ¡æ—¶é—´ä¸€è‡´
- **ä¸šåŠ¡é€»è¾‘**ï¼šç¬¦åˆä¸šåŠ¡è¿è¥çš„æ—¶é—´æ¦‚å¿µï¼Œé¿å…æ—¶åŒºæ··ä¹±
