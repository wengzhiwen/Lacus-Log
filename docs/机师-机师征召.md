# 机师-机师征召

机师-机师征召用于管理对"未征召"机师发起的面试/招募流程工单。该模块仅支持从"机师详情页"的"启动征召"按钮进入创建流程，不支持独立新建空白征召。

征召流程采用六步制：待面试 -> 待预约训练 -> 待训练 -> 待预约开播 -> 待开播 -> 已结束，确保征召决策的严谨性和数据完整性。每个步骤的流转、变化（决策时间、决策人、决策结果）都需要在数据库中详细记录，不再允许用户直接在编辑界面修改当前的征召状态。

## 流程映射与兼容性

### 新六步制流程
1. **待面试**：预约面试时间，等待面试结果
2. **待预约训练**：面试通过，等待登记训练时间
3. **待训练**：已预约训练时间，等待训练结果
4. **待预约开播**：训练通过，等待登记开播时间
5. **待开播**：已预约开播时间，等待开播结果
6. **已结束**：征召流程的最终状态

### 与旧三步制的映射关系
- **旧版"已启动"** → **新版"待面试"**：完全对应
- **旧版"训练征召中"** → **新版"待训练"**：旧版训练征召决策时间同时作为新版预约训练时间和训练时间
- **旧版"已结束"** → **新版"已结束"**：完全对应，旧版结束征召决策时间同时作为新版预约开播时间和开播时间

### 历史数据兼容性处理

#### 状态映射
- 对于已存在的"已启动"状态数据，系统读取时将其映射为"待面试"状态
- 对于已存在的"训练征召中"状态数据，系统读取时将其映射为"待训练"状态
- 对于已存在的"已结束"状态数据，系统读取时直接映射为"已结束"状态

#### 字段降级读取
- 系统在读取历史数据时，优先使用新字段，如果新字段为空则从废弃字段降级读取
- 降级读取遵循"字段降级读取策略"中定义的规则
- 确保历史数据在新版界面中能正确显示和操作

#### 数据迁移建议
- 建议在系统升级时运行数据迁移脚本，将废弃字段的数据迁移到新字段
- 迁移完成后，废弃字段可以保留一段时间作为备份，最终可以删除
- 迁移过程中需要确保数据的完整性和一致性

## 重要约定

- 数据库存储的所有日期时间均为UTC；界面显示与输入均为GMT+8，必须严格遵守。
- 仅当机师当前状态为“未征召”时，机师详情页底部操作区显示并启用“启动征召”按钮。
- 征召对象唯一，且从机师详情页携带机师ID跳转；禁止无对象创建。
- CSRF：所有表单必须包含隐藏字段提交CSRF Token，严格参考现有模块写法。
- 日志：本模块的日志按自然日滚动，写入 `./log` 目录，必要时使用INFO，复杂流程留足DEBUG（中文）。

## 元数据

| 字段 | 说明 | 参考类型 | 设定 |
|---------|------|------|------|
| ID | 系统内部唯一编码，用户不可见 | 由技术设计 | 必须 唯一 |
| 机师 | 被征召的机师 | 关联到机师唯一ID | 必须，仅展示不可编辑 |
| 征召负责人 | 负责该征召的舰长 | 关联到用户唯一ID | 必须，默认=当前用户 |
| 预约时间 | 与机师约定的面试时间 | 时间戳UTC | 必须，默认=次日16:00（按GMT+8取值，入库UTC） |
| 渠道 | BOSS / 51 / 介绍 / 其他 | 枚举 | 必须 |
| 介绍费 | 人民币元，两位小数 | 数值 | 必须，默认=0 |
| 备注 | 补充信息 | 字符串 | 可选，≤200字 |
| 征召状态 | 待面试 / 待预约训练 / 待训练 / 待预约开播 / 待开播 / 已结束 | 枚举 | 必须，默认=待面试 |
| 面试决策 | 预约训练 / 不征召 | 枚举 | 可选，待面试步骤填写 |
| 面试决策人 | 做出面试决策的舰长 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 面试决策时间 | 面试决策的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 预约训练时间 | 与机师约定的训练时间 | 时间戳UTC | 可选，待预约训练步骤填写 |
| 预约训练决策人 | 登记训练时间的舰长 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 预约训练决策时间 | 登记训练时间的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 训练决策 | 预约开播 / 不征召 | 枚举 | 可选，待训练步骤填写 |
| 训练决策人 | 做出训练决策的舰长 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 训练决策时间 | 训练决策的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 预约开播时间 | 与机师约定的首次开播时间 | 时间戳UTC | 可选，待预约开播步骤填写 |
| 预约开播决策人 | 登记开播时间的舰长 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 预约开播决策时间 | 登记开播时间的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 开播决策 | 正式机师 / 实习机师 / 不征召 | 枚举 | 可选，待开播步骤填写 |
| 开播决策人 | 做出开播决策的舰长 | 关联到用户唯一ID | 系统自动记录，不可编辑 |
| 开播决策时间 | 开播决策的时间 | 时间戳UTC | 系统自动记录，不可编辑 |
| 变更记录 | 记录上述字段的所有修改日志（哪个用户什么时间把什么字段的值从什么改成了什么，修改时使用的IP地址是什么） | 由独立模型持久化（非嵌入JSON） | 非必须 |
| 创建时间 | 创建记录的时间 | 时间戳 | 必须，默认=当前UTC |
| 最后修改 | 最近一次修改时间 | 时间戳 | 必须，默认=当前UTC |

### 废弃字段（历史兼容）

| 废弃字段 | 对应新字段 | 废弃原因 | 降级读取规则 |
|---------|---------|---------|-------------|
| 训练征召决策 | 面试决策 + 训练决策 | 拆分为两个独立的决策步骤 | 根据征召状态判断：<br/>- 状态=待训练：训练征召决策→训练决策<br/>- 状态=已结束：训练征召决策→面试决策 |
| 训练征召决策人 | 面试决策人 + 训练决策人 | 拆分为两个独立的决策人 | 同时填充到两个新字段 |
| 训练征召决策时间 | 面试决策时间 + 训练决策时间 | 拆分为两个独立的决策时间 | 同时填充到两个新字段 |
| 训练时间 | 预约训练时间 | 字段名称变更 | 直接映射 |
| 结束征召决策 | 开播决策 | 字段名称变更 | 直接映射 |
| 结束征召决策人 | 开播决策人 | 字段名称变更 | 直接映射 |
| 结束征召决策时间 | 开播决策时间 | 字段名称变更 | 直接映射 |

### 字段降级读取策略

#### 状态相关的降级读取规则

**待面试状态**：
- 无降级读取需求（新字段为空是正常的）

**待预约训练状态**：
- 面试决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）

**待训练状态**：
- 面试决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）
- 预约训练时间：从废弃字段"训练时间"读取（如果新字段为空）

**待预约开播状态**：
- 面试决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）
- 预约训练时间：从废弃字段"训练时间"读取（如果新字段为空）
- 训练决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 训练决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 训练决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）

**待开播状态**：
- 面试决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）
- 预约训练时间：从废弃字段"训练时间"读取（如果新字段为空）
- 训练决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 训练决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 训练决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）
- 预约开播时间：从废弃字段"训练时间"读取（如果新字段为空）

**已结束状态**：
- 面试决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 面试决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 面试决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）
- 预约训练时间：从废弃字段"训练时间"读取（如果新字段为空）
- 训练决策：从废弃字段"训练征召决策"读取（如果新字段为空）
- 训练决策人：从废弃字段"训练征召决策人"读取（如果新字段为空）
- 训练决策时间：从废弃字段"训练征召决策时间"读取（如果新字段为空）
- 预约开播时间：从废弃字段"训练时间"读取（如果新字段为空）
- 开播决策：从废弃字段"结束征召决策"读取（如果新字段为空）
- 开播决策人：从废弃字段"结束征召决策人"读取（如果新字段为空）
- 开播决策时间：从废弃字段"结束征召决策时间"读取（如果新字段为空）

### 状态流转

#### 新六步制状态流转
- **创建**：状态=待面试
- **面试决策（预约训练）**：状态→待预约训练
- **面试决策（不征召）**：状态→已结束，同时对机师执行：状态→不征召
- **预约训练**：状态→待训练
- **训练决策（预约开播）**：状态→待预约开播
- **训练决策（不征召）**：状态→已结束，同时对机师执行：状态→不征召
- **预约开播**：状态→待开播
- **开播决策（正式机师）**：状态→已结束，同时对机师执行：阶级→正式机师；状态→已征召
- **开播决策（实习机师）**：状态→已结束，同时对机师执行：阶级→实习机师；状态→已征召
- **开播决策（不征召）**：状态→已结束，同时对机师执行：状态→不征召

#### 历史数据兼容性状态映射
- **旧版"已启动"** → **新版"待面试"**：直接映射
- **旧版"训练征召中"** → **新版"待训练"**：系统读取时自动映射
- **旧版"已结束"** → **新版"已结束"**：直接映射

#### 状态流转限制
- 用户不再允许直接在编辑界面修改征召状态
- 所有状态变更必须通过相应的决策步骤进行
- 系统自动记录每次状态变更的决策人、决策时间和决策结果

## 入口与导航

- 在主菜单新增“机师征召”入口，进入征召列表页。
- 机师详情页（状态=未征召）底部footbar显示“启动征召”按钮；点击跳转到“启动征召”页面（唯一入口）。

## 创建与编辑

### 启动征召（创建）
- 页面上部以卡片展示机师关键信息（昵称、性别/年龄、所属、当前阶级与状态）。
- 表单字段：
  - 征召负责人（选择舰长；默认=当前用户）
  - 预约时间（日期时间；默认=次日16:00，显示为GMT+8，入库UTC）
  - 渠道（枚举：BOSS / 51 / 介绍 / 其他；按该顺序显示）
  - 介绍费（人民币元；默认=0；两位小数）
  - 备注（可选）
  - 征召状态（默认=待面试，不在创建页中暴露为可编辑项）
- 校验：
  - 征召负责人不可为空且必须是舰长或以上权限。
  - 预约时间必填；入库前将GMT+8转换为UTC。
  - 渠道为枚举值；介绍费需为有效的非负金额（两位小数）。
  - CSRF Token 必须通过隐藏字段提交。
- footbar：
  - 左：返回
  - 右：创建（btn-primary）

### 编辑征召

编辑征召页面根据当前征召状态动态调整可编辑字段，随着流程推进，可编辑的信息逐渐增加，确保数据的完整性和流程的严谨性。

#### 状态相关的编辑权限

**待面试状态**：
- 可编辑字段：征召负责人、预约时间、渠道、介绍费、备注
- 只读字段：征召状态、所有决策相关字段
- 界面提示："当前处于待面试阶段，可编辑基础征召信息"

**待预约训练状态**：
- 可编辑字段：征召负责人、预约时间、渠道、介绍费、备注、面试决策
- 只读字段：征召状态、面试决策人、面试决策时间、训练相关字段、开播相关字段
- 界面提示："当前处于待预约训练阶段，可编辑基础信息和面试决策信息"

**待训练状态**：
- 可编辑字段：征召负责人、预约时间、渠道、介绍费、备注、面试决策、预约训练时间
- 只读字段：征召状态、面试决策人、面试决策时间、预约训练决策人、预约训练决策时间、训练决策相关字段、开播相关字段
- 界面提示："当前处于待训练阶段，可编辑基础信息、面试决策信息和训练预约信息"

**待预约开播状态**：
- 可编辑字段：征召负责人、预约时间、渠道、介绍费、备注、面试决策、预约训练时间、训练决策
- 只读字段：征召状态、面试决策人、面试决策时间、预约训练决策人、预约训练决策时间、训练决策人、训练决策时间、开播相关字段
- 界面提示："当前处于待预约开播阶段，可编辑基础信息、面试决策信息、训练预约信息和训练决策信息"

**待开播状态**：
- 可编辑字段：征召负责人、预约时间、渠道、介绍费、备注、面试决策、预约训练时间、训练决策、预约开播时间
- 只读字段：征召状态、面试决策人、面试决策时间、预约训练决策人、预约训练决策时间、训练决策人、训练决策时间、预约开播决策人、预约开播决策时间、开播决策相关字段
- 界面提示："当前处于待开播阶段，可编辑基础信息、面试决策信息、训练预约信息、训练决策信息和开播预约信息"

**已结束状态**：
- 可编辑字段：无（所有字段只读展示）
- 只读字段：所有字段
- 界面提示："征召流程已结束，所有信息仅可查看，不可编辑"

#### 编辑界面设计

- 页面顶部展示机师信息卡片（始终只读）
- **征召状态字段始终只读**，显示当前流程进度，不可手动修改
- 征召状态只能通过决策步骤进行流转，编辑页面不提供状态修改功能
- 根据当前状态动态显示可编辑字段组
- 不可编辑的字段组以灰色背景显示，并标注"仅查看"
- 表单验证：只对当前可编辑的字段进行必填验证
- 保存逻辑：只更新当前状态允许编辑的字段
- 变更记录：记录所有字段修改的操作日志

#### 校验与保存

- 基础信息校验：同创建页面
- 决策信息校验：根据当前状态验证相应的决策字段
- 时间校验：确保决策时间不早于创建时间，不晚于当前时间
- 保存限制：只保存当前状态允许编辑的字段
- 变更记录：记录字段级变更（时间、操作者、前值、后值、IP）

## 列表

- 菜单入口进入列表，默认筛选"征召状态=进行中"（包含待面试、待预约训练、待训练、待预约开播、待开播）。
- 筛选器：
  - 征召状态（进行中（默认）/ 已结束）
  - 征召负责人（选择舰长）
  - 渠道（BOSS / 51 / 介绍 / 其他）
- 时间限制：当筛选状态为"进行中"时，只显示最近7天的数据（创建时间、预约时间、预约训练时间、预约开播时间任意一个在7天内）。
- 排序：按预约时间升序。
- 列表项字段：机师昵称、预约时间（GMT+8显示）、预约训练时间（GMT+8显示）、预约开播时间（GMT+8显示）、渠道、征召负责人昵称、征召状态、当前决策状态。
- 交互：点击卡片进入征召详情。
- 空状态：显示友好提示与返回入口按钮。

## 详情

- 展示全部字段与机师信息卡片，按阶段分组显示信息。
- 信息分组结构：
  - **基本信息**：征召负责人、预约时间、征召渠道、介绍费、征召状态、备注
  - **面试阶段**：面试决策、面试决策人[角色]、面试决策时间（GMT+8）
  - **训练预约阶段**：预约训练时间、预约训练决策人[角色]、预约训练决策时间（GMT+8）
  - **训练阶段**：训练决策、训练决策人[角色]、训练决策时间（GMT+8）
  - **开播预约阶段**：预约开播时间、预约开播决策人[角色]、预约开播决策时间（GMT+8）
  - **开播阶段**：开播决策、开播决策人[角色]、开播决策时间（GMT+8）
  - **历史数据**：训练征召决策（历史）、训练时间（历史）、结束征召决策（历史）
  - **系统信息**：创建时间、最后修改时间
- 条件显示：只有已发生的阶段才显示对应的信息分组
- 角色显示：决策人信息显示为"昵称[角色]"格式，角色使用中文（舰长/议长）
- 时间显示：所有决策时间使用GMT+8时区显示
- 底部footbar按钮：编辑 / 面试决策 / 预约训练 / 训练决策 / 预约开播 / 开播决策 / 变更记录。
- 按钮可用性：
  - 当"征召状态=待面试"时，显示"面试决策"按钮，隐藏其他决策按钮。
  - 当"征召状态=待预约训练"时，显示"预约训练"按钮，隐藏其他决策按钮。
  - 当"征召状态=待训练"时，显示"训练决策"按钮，隐藏其他决策按钮。
  - 当"征召状态=待预约开播"时，显示"预约开播"按钮，隐藏其他决策按钮。
  - 当"征召状态=待开播"时，显示"开播决策"按钮，隐藏其他决策按钮。
  - 当"征召状态=已结束"时，隐藏所有征召操作按钮，仅显示"编辑"和"变更记录"按钮。
- 变更记录：弹窗展示最近100条变更记录，按变更发生的时间逆序排列。

  注：前端通过调用 GET `/recruits/<recruit_id>/changes` 获取JSON数据并渲染弹窗。

## 面试决策

- 页面顶部展示机师信息卡片。
- 表单：
  - 面试决策人（当前用户，只读展示，不可编辑）
  - 面试决策（预约训练 / 不征召）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 当选择"预约训练"时，需要填写机师基本信息：
  - 真实姓名（必填，最大20字符）
  - 出生年（必填，距今60年前-距今10年前）
- 提示文案：
  - "该机师的阶级将自动变更为训练机师"
  - "该机师的状态将自动变更为已征召"
- 用户点击"确认"后：
  - 将该征召状态改为"待预约训练"（选择预约训练）或"已结束"（选择不征召）。
  - 系统自动记录：面试决策人=当前用户，面试决策时间=当前UTC时间。
  - 更新机师：阶级→训练机师；状态→已征召；同时更新机师的基本信息（真实姓名、出生年、参战形式）。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 预约训练

- 页面顶部展示机师信息卡片。
- 表单：
  - 预约训练决策人（当前用户，只读展示，不可编辑）
  - 预约训练时间（日期时间；必填，显示为GMT+8，入库UTC）
    - 默认时间：当前GMT+8时间向后一个半点或整点取整
    - 时区处理：使用utc_to_local函数确保时间计算基于GMT+8时区
  - 参战形式（必填，线下 / 线上 / 未知）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 用户点击"确认"后：
  - 将该征召状态改为"待训练"。
  - 系统自动记录：预约训练决策人=当前用户，预约训练决策时间=当前UTC时间。
  - 写入相应变更记录与操作日志。
  - 更新机师：参战形式 = 选择的参战形式
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 训练决策

- 页面顶部展示机师信息卡片。
- 表单：
  - 训练决策人（当前用户，只读展示，不可编辑）
  - 训练决策（预约开播 / 不征召）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 用户点击"确认"后：
  - 将该征召状态改为"待预约开播"（选择预约开播）或"已结束"（选择不征召）。
  - 系统自动记录：训练决策人=当前用户，训练决策时间=当前UTC时间。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 预约开播

- 页面顶部展示机师信息卡片。
- 表单：
  - 预约开播决策人（当前用户，只读展示，不可编辑）
  - 预约开播时间（日期时间；必填，显示为GMT+8，入库UTC）
    - 默认时间：当前GMT+8时间向后一个半点或整点取整
    - 时区处理：使用utc_to_local函数确保时间计算基于GMT+8时区
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 用户点击"确认"后：
  - 将该征召状态改为"待开播"。
  - 系统自动记录：预约开播决策人=当前用户，预约开播决策时间=当前UTC时间。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 开播决策

- 页面顶部展示机师信息卡片。
- 表单：
  - 开播决策人（当前用户，只读展示，不可编辑）
  - 开播决策（正式机师 / 实习机师 / 不征召）
  - 介绍费（允许再次编辑）
  - 备注（允许再次编辑）
- 当选择"正式机师"或"实习机师"时，需要填写机师分配信息：
  - 所属（必填，从所有舰长/议长中选择）
  - 战区（必填，快手 / 抖音 / 其他 / 未知）
  - 阶级将根据征召决策自动设置（正式机师决策→正式机师阶级，实习机师决策→实习机师阶级）
- 提示文案：
  - "该机师的阶级将自动变更为选择的阶级"
  - "该机师的状态将自动变更为已征召"
- 用户点击"确认"后：
  - 将该征召状态改为"已结束"。
  - 系统自动记录：开播决策人=当前用户，开播决策时间=当前UTC时间。
  - 更新机师：阶级→根据决策自动设置；状态→已征召；所属→选择的舰长；战区→选择的战区。
  - 写入相应变更记录与操作日志。
- CSRF：本页表单同样必须通过隐藏字段提交CSRF Token。

## 历史数据兼容性

### 数据迁移策略
- **旧版"已启动"状态**：直接映射为"启动征召"状态，无需额外处理
- **旧版"训练征召中"状态**：映射为"待训练"状态，同时：
  - 将`训练征召决策时间`同时填充到`预约训练决策时间`和`训练决策时间`
  - 将`训练征召决策人`同时填充到`预约训练决策人`和`训练决策人`
  - 将`训练时间`填充到`预约训练时间`
- **旧版"已结束"状态**：直接映射为"已结束"状态，无需额外处理

### 字段映射规则
| 旧版字段 | 新版字段 | 映射规则 |
|---------|---------|---------|
| 征召状态="已启动" | 征召状态="待面试" | 直接映射 |
| 征召状态="训练征召中" | 征召状态="待训练" | 直接映射 |
| 征召状态="已结束" | 征召状态="已结束" | 直接映射 |
| 训练征召决策时间 | 预约训练决策时间 + 训练决策时间 | 同时填充 |
| 训练征召决策人 | 预约训练决策人 + 训练决策人 | 同时填充 |
| 训练时间 | 预约训练时间 | 直接映射 |
| 结束征召决策时间 | 预约开播决策时间 + 开播决策时间 | 同时填充 |
| 结束征召决策人 | 预约开播决策人 + 开播决策人 | 同时填充 |
| 训练征召决策 | 面试决策 + 训练决策 | 根据决策内容映射 |
| 结束征召决策 | 开播决策 | 直接映射 |

### 兼容性处理实现
- 系统在读取历史数据时自动进行状态映射
- 历史数据在界面中正确显示，用户可以进行相应的操作
- 确保历史征召记录在新版界面中的完整性和可操作性
- 所有历史决策记录都保持完整的审计轨迹
- 当且仅当用户主动操作历史数据时才会按照最新版设计修改历史数据的mongodb文档，读取时并不会对历史数据进行移行操作

## 权限

- 议长、舰长：权限一致，均可见且可写（不限制所属）。
- 其他角色：遵循项目统一的权限策略（由技术实现）。

## UI与交互规范

- 参考《基础-UI风格》与《机师-作战记录》：
  - 移动优先、卡片列表、footbar吸附式操作按钮。
  - 主要按钮使用ZAFT红；禁用态灰色描边。
  - 表单组间距与输入框样式与既有模块保持一致。
- 时间显示统一使用Jinja2过滤器（如已有：local_datetime、local_date）。
- 列表卡片整体可点击，悬停/触摸有上浮与阴影反馈。

### 状态相关的界面设计

#### 编辑页面状态指示
- 页面顶部显示当前征召状态和流程进度条
- 状态进度条：待面试 → 待预约训练 → 待训练 → 待预约开播 → 待开播 → 已结束
- 当前状态高亮显示，已完成状态显示为绿色，未到达状态显示为灰色

#### 字段组显示规则
- **可编辑字段组**：白色背景，正常表单样式，支持用户交互
- **只读字段组**：浅灰色背景（#f8f9fa），字段标签显示"（仅查看）"，输入框禁用
- **字段组标题**：根据当前状态动态显示，如"基础信息"、"面试决策信息"、"训练预约信息"等

#### 表单验证与提示
- 动态验证：只对当前状态可编辑的字段进行必填验证
- 状态提示：在页面顶部显示当前状态的操作提示文案
- 保存按钮：根据当前状态显示"保存修改"或"仅查看"（已结束状态）

#### 按钮动态显示规则
- **详情页按钮**：根据征召状态动态显示相应的操作按钮
  - 待面试：显示"编辑"、"面试决策"、"变更记录"
  - 待预约训练：显示"编辑"、"预约训练"、"变更记录"
  - 待训练：显示"编辑"、"训练决策"、"变更记录"
  - 待预约开播：显示"编辑"、"预约开播"、"变更记录"
  - 待开播：显示"编辑"、"开播决策"、"变更记录"
  - 已结束：显示"编辑"、"变更记录"
- **决策页按钮**：所有决策页面都显示"编辑"、"变更记录"按钮
- **按钮样式**：所有显示的按钮都使用正常样式，不显示置灰状态

#### 响应式设计
- 移动端：字段组垂直排列，状态进度条横向滚动
- 桌面端：字段组可并排显示，状态进度条完整展示
- 字段组切换：支持折叠/展开，提升页面可读性

## 技术实现要点

- 时间处理：统一使用 `utils/timezone_helper.py` 的转换方法，确保"数据库UTC，UI GMT+8"。
- 模板：复用现有表单分组与footbar组件；CSRF Token 使用隐藏字段，遵循既有模板写法（如 `{{ csrf_token() }}`）。
- 日志：按模块输出到 `./log/recruit_YYYYMMDD.log`（命名示例），INFO用于关键节点，复杂流程用DEBUG。
- 排序与筛选：后端按筛选条件查询，默认状态=进行中（包含待面试+待预约训练+待训练+待预约开播+待开播）；按预约时间升序返回，分页按需实现（与既有模块一致）。
- 变更记录：记录字段级变更（时间、操作者、前值、后值、IP）。
- 变更记录API：提供 GET `/recruits/<recruit_id>/changes` 接口返回JSON格式的变更记录数据。
- 变更记录模型：RecruitChangeLog独立模型，支持字段级变更追踪和显示名称映射。
- 机师数据更新：通过机师管理模块提供的API方法更新机师信息，确保操作的原子性：
  - 面试决策时调用机师管理模块的更新方法，设置阶级、状态、基本信息。
  - 开播决策时调用机师管理模块的更新方法，设置阶级（根据决策自动设置）、状态、所属、战区。
- 数据校验：在征召模块中完成必要的数据收集和校验，避免跨模块的复杂依赖。
- 状态流转控制：实现严格的状态流转控制，确保用户只能通过相应的决策步骤进行状态变更。
- 决策记录自动化：所有决策人和决策时间字段由系统自动记录，不可用户编辑。
  - 决策人记录：在用户执行决策操作时，自动记录当前用户ID
  - 决策时间记录：在用户执行决策操作时，自动记录当前UTC时间
  - 审计完整性：确保所有决策都有完整的操作者身份和时间戳记录
  - 防篡改保护：决策人和决策时间字段在编辑界面中只读显示
- 历史数据兼容：实现自动的状态映射和字段填充，确保历史数据在新版界面中的正确显示和操作。
- 动态编辑权限：根据征召状态动态控制字段的可编辑性，实现渐进式信息收集。
- 字段组管理：实现字段组的动态显示和隐藏，支持不同状态下的界面适配。
- 表单验证优化：根据当前状态只对可编辑字段进行验证，提升用户体验。
- 按钮动态显示：根据征召状态动态显示相应的操作按钮，隐藏不可用的按钮。
  - 状态判断：根据征召状态确定需要显示的按钮列表
  - 动态渲染：前端根据状态动态渲染按钮，避免显示置灰按钮
  - 用户体验：减少界面复杂度，提升操作直观性
  - 响应式适配：确保按钮在不同屏幕尺寸下的正确显示
- 废弃字段降级读取：实现字段降级读取机制，确保历史数据的完整显示。
  - 读取优先级：新字段 > 废弃字段 > 默认值
  - 降级策略：根据征召状态和字段类型选择合适的废弃字段进行降级读取
  - 数据迁移：提供数据迁移脚本，将废弃字段数据迁移到新字段
  - 兼容性保证：确保新旧数据在同一界面中的一致显示
- 详情页面布局优化：按阶段分组显示信息，提升用户体验。
  - 分组结构：基本信息、面试阶段、训练预约阶段、训练阶段、开播预约阶段、开播阶段、历史数据、系统信息
  - 条件显示：只有已发生的阶段才显示对应的信息分组
  - 角色显示：决策人信息显示为"昵称[角色]"格式，角色使用中文（舰长/议长）
  - 时间显示：所有决策时间使用GMT+8时区显示
- 默认时间处理：为预约训练和预约开播页面提供智能默认时间。
  - 默认时间：当前GMT+8时间向后一个半点或整点取整
  - 时区处理：使用utc_to_local函数确保时间计算基于GMT+8时区
  - 用户体验：减少用户手动输入时间的工作量，提升操作便利性
- 征召状态只读控制：确保征召状态只能通过决策步骤进行流转。
  - 编辑页面：征召状态字段始终只读，不可手动修改
  - 后端验证：移除对status字段的处理和验证逻辑
  - 状态流转：所有状态变更必须通过相应的决策步骤进行
  - 数据完整性：确保征召流程的严谨性和数据一致性

