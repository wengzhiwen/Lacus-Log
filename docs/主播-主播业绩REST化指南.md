# 主播-主播业绩REST接口现状

主播业绩页面 (`/pilots/<id>/performance`) 已于 2025-10-05 完成前后端解耦：服务端只返回空模板，全部数据通过 REST 接口异步加载。页面现状如下。

## 现有逻辑

- `pilot_performance()` 视图仅负责校验 `pilot_id` 是否存在并渲染模板骨架，不再加载或计算数据。
- 前端脚本在页面加载后请求 `GET /api/pilots/<pilot_id>/performance`，填充本月/近7条/近3条统计及最近 30 条开播记录。
- 返回导航依然依赖查询参数 `from`、`date`、`month` 等，由前端脚本生成按钮实现一致的用户体验。

## 已提供的接口

| 能力 | 现状 | 缺口 |
| --- | --- | --- |
| 业绩数据 JSON | `GET /api/pilots/<id>/performance` | 已返回主播基本信息、三段统计以及最近 30 条开播记录。|
| 最近开播记录 API | 同上响应 `recent_records` 字段 | - |
| 统计缓存状态 | 通过装饰器缓存 | 暂未暴露刷新或查询缓存时间的接口。|

## 维护建议

- 统一复用 `utils.pilot_performance.calculate_pilot_performance_stats()` 进行计算，任何后台或异步任务如需业绩数据，建议直接调用该函数。
- 如需在其他前端模块展示业绩摘要，可直接调用现有 REST 接口，避免再次引入模板渲染逻辑。

> 说明：当前 REST 化已完成，后续文档如仍引用旧的服务端渲染实现，请同步更新。

## 未来 REST 化建议

- **接口扩展**：如需导出、刷新缓存或查看历史趋势，优先在 `/api/pilots/<id>/performance` 上增加 `meta` 或查询参数，而非新增分散端点。
- **缓存管理**：若后续需要提供缓存刷新能力，可考虑新增 `POST /api/pilots/<id>/performance/recalculate` 或在后台任务中触发。
- **复用开播记录接口**：当前响应中已经嵌入最近 30 条记录，如要展示更多或支持分页，可扩展统一的 `battle_records` 列表接口，保持筛选逻辑的一致性。
