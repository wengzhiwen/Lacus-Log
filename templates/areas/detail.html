{% extends 'base.html' %}
{% block title %}开播地点详情 - Lacus-Log{% endblock %}
{% block content %}
<section class="area-detail">
  <div class="back-nav">
    <a class="btn btn-secondary" href="{{ url_for('battle_area.list_areas') }}">
      <span class="icon">←</span>
      返回列表
    </a>
  </div>
  <div class="page-header"><h1 class="page-title">开播地点详情</h1></div>

  <div class="area-card-detail" id="area-detail-card">
    <div class="row"><span class="label">基地</span><span class="value" id="detail-x">-</span></div>
    <div class="row"><span class="label">场地</span><span class="value" id="detail-y">-</span></div>
    <div class="row"><span class="label">坐席</span><span class="value" id="detail-z">-</span></div>
    <div class="row"><span class="label">可用性</span><span class="value" id="detail-availability">-</span></div>
    <div class="row"><span class="label">创建时间</span><span class="value" id="detail-created">-</span></div>
    <div class="row"><span class="label">更新时间</span><span class="value" id="detail-updated">-</span></div>
  </div>
</section>

<div class="footbar">
  <div class="inner">
    <a class="btn" id="edit-link" href="#">编辑</a>
    <a class="btn btn-primary" id="generate-link" href="#">生成更多</a>
  </div>
</div>

<style>
.area-card-detail { background: #fff; border: 1px solid var(--table-header); border-radius: 8px; padding: 14px; }
.area-card-detail .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--table-header); }
.area-card-detail .row:last-child { border-bottom: none; }
.area-card-detail .label { color: var(--muted); font-size: 12px; }
.area-card-detail .value { color: var(--text); font-size: 14px; }

.back-nav { margin-bottom: 12px; }
.back-nav .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; }
.back-nav .icon { font-size: 16px; }

.footbar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-top: 1px solid var(--table-header); box-shadow: 0 -2px 8px rgba(0,0,0,0.06); padding: 10px 12px calc(env(safe-area-inset-bottom, 0) + 10px) 12px; z-index: 100; }
.footbar .inner { display: flex; gap: 12px; justify-content: center; }
.container { padding-bottom: 88px; }
</style>
<script>
const areaId = '{{ area_id }}';

function formatDate(value) {
  if (!value) return '-';
  const date = new Date(value);
  if (Number.isNaN(date.getTime())) return value;
  return date.toLocaleString('zh-CN', { hour12: false });
}

async function loadAreaDetail() {
  try {
    const response = await fetch(`/api/battle-areas/${areaId}`);
    const result = await response.json();

    if (!result.success) {
      throw new Error(result.error?.message || '加载开播地点详情失败');
    }

    const data = result.data;
    document.getElementById('detail-x').textContent = data.x_coord || '-';
    document.getElementById('detail-y').textContent = data.y_coord || '-';
    document.getElementById('detail-z').textContent = data.z_coord || '-';
    document.getElementById('detail-availability').textContent = data.availability || '-';
    document.getElementById('detail-created').textContent = formatDate(data.created_at);
    document.getElementById('detail-updated').textContent = formatDate(data.updated_at);

    document.getElementById('edit-link').href = `/areas/${areaId}/edit`;
    document.getElementById('generate-link').href = `/areas/${areaId}/generate`;
  } catch (error) {
    console.error('加载开播地点详情失败:', error);
    showMessage(error.message || '加载开播地点详情失败', 'error');
    setTimeout(() => {
      window.location.href = '/areas';
    }, 1500);
  }
}

document.addEventListener('DOMContentLoaded', loadAreaDetail);
</script>
{% endblock %}
