# 机师-机师管理

机师指代受公司运营的主播，针对一些表词达意不够准确的文档描述，将使用针对主播的视角来看待机师这个角色往往更加准确。

但在整个系统中，仍然要坚持使用机师这个称呼。

## 基本约定

- 机师不是用户
    - 没有登录功能
    - 本系统暂时没有直接提供任何功能给到主播（机师）
    - 在系统设计中应该被视为资产
- 机师是几乎所有模块的核心
    - 大多数系统都会引用机师的基础数据结构
    - 因而需要维护良好的易扩展的数据结构和INDEX，由技术设计

## 机师的元数据

以下为业务视角的元数据清单，技术实现时可能需要补充更多的字段

| 字段 | 说明 | 参考类型 | 设定 |
|---------|------|------|------|
| ID | 系统中内部使用的唯一编码，用户不可见 | 由技术设计 | 必须 唯一 |
| 昵称 | 系统中主要用于显示的机师名，虽然要求唯一但不要作为PK使用，唯一是为了防止内部混淆 | 字符串 | 必须 唯一 |
| 姓名 | 作为参考保存的机师的真实姓名 | 字符串 | 非必须 |
| 性别 | 男(0) / 女(1) / 不明确(2或其他数值) | 枚举 | 必须，默认值=女 |
| 出生年 | 出生年份，用来计算年龄 | 数值型 | 非必须 |
| 所属 | 机师所属的舰长 | 关联到舰长唯一ID | 非必须 |
| 战区 | 机师开播的平台：快手 / 抖音 / 其他 / 未知 | 枚举 | 必须，默认=未知 |
| 参战形式 | 线下 / 线上 / 未知 | 枚举 | 必须，默认=未知 |
| 阶级 | 候补机师 / 训练机师 / 实习机师 / 正式机师 | 枚举 | 必须，默认值=候补机师 |
| 状态 | 未征召 / 不征召 / 已征召 / 已签约 / 已阵亡 | 枚举 | 必须，默认值=未征召 |
| 变更记录 | 记录上述字段的所有修改日志（哪个用户什么时间把什么字段的值从什么改成了什么，修改时使用的IP地址是什么） | JSON或其他结构由技术设计 | 非必须 |
| 创建时间 | 创建本条记录的时间 | 时间戳 | 必须，默认=当前时间UTC |
| 最后修改 | 最后一次修改本条记录的时间 | 时间戳 | 必须，默认=当前时间UTC |


### 元数据之间的关联

在对机师的数值进行修改时，应符合以下条件：

- 阶级为 实习机师 / 正式机师 的，必须有所属，战区不能是未知，参战形式不能是未知
- 状态为 已征召 / 已签约 的，必须有姓名、出生年

### 交叉关联

#### 基础-用户系统

- 删除用户时检查是否有下属机师，如果有，不允许删除

## 机师管理界面

### 列表

- 按机师的创建时间逆序（最近在前）排列
- 展示字段
    - 昵称 姓名（换行，副文字）
    - 性别（用图标） 年龄（用now来计算周岁）
    - 所属 阶级（换行，副文字） 状态（换行，副文字）
- 点击进入机师详情

新机师按钮：新建机师

#### 筛选

支持筛选：

- 按阶级筛选
- 按状态筛选
- 按所属筛选
- 按创建时间筛选（最近7天 14天 30天）

所有筛选条件可以组合成复合筛选（交集）；

筛选条件展示，点击筛选条件展开筛选器（否则筛选器太高了，默认折叠）；

筛选器写入cookie，便于用户使用。

#### 默认筛选器

- 议长
    - 无（可选按所属/状态/阶级/时间筛选）
- 舰长
    - 无（默认不再强制“所属=自己”，但仍可作为筛选条件）

### 机师详情

展示一位机师的数据。

返回到机师列表时应正确维持筛选器。

功能按钮：

- 编辑： 跳转机师编辑
- 变更记录： 弹窗展示最近100条变更记录，按变更发生的时间逆序排列

没有删除功能。

### 机师新建 / 编辑

说明略

- 支持所有数据的修改，但部分字段的修改需要符合本文档中约定的条件
- 不支持编辑 ID 变更记录 创建时间 最后修改等由系统管理的字段
- 对于枚举字段只能在枚举中选择值，选项的显示顺序按上表中的顺序
    - 非必须的枚举字段，默认为空值
- 对于出生年字段需要进行有效验证（距今60年前-距今10年前）
- 对于昵称，最大长度限定20个字符
- 对于姓名，最大长度限定20个字符
- 所属的选择从所有的舰长 / 议长 （不论是否活跃）中选择，选项的显示顺序：
    - 第一顺位： 空值
    - 第二顺位： 当前 舰长 / 议长
    - 第三顺位： 其他活跃舰长（昵称字典顺序）
    - 第四顺位： 其他舰长（昵称字典顺序，昵称后接[阵亡]）





