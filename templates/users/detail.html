{% extends 'base.html' %}
{% block title %}ç”¨æˆ·è¯¦æƒ… - {{ user.username }} - Lacus-Log{% endblock %}
{% block content %}
<section class="user-detail">
  <div class="back-nav">
    <a href="{{ url_for('admin.users_list') }}" class="btn btn-secondary">
      â† è¿”å›ç”¨æˆ·åˆ—è¡¨
    </a>
  </div>

  <div class="user-info-card">
    <div class="card-header">
      <div class="user-avatar">
        <div class="avatar-icon">ğŸ‘¤</div>
      </div>
      <div class="user-main-info">
        <h1 class="user-name">{{ user.username }}</h1>
        <div class="user-nickname">{{ user.nickname or 'æœªè®¾ç½®æ˜µç§°' }}</div>
        <div class="user-badges">
          <span class="role-badge role-{{ (user.roles | map(attribute='name') | list) | first or 'unknown' }}">
            {{ ((user.roles | map(attribute='name') | list) | first or 'unknown') | role_display_name }}
          </span>
          <span class="status-badge status-{{ 'active' if user.active else 'inactive' }}">
            {{ 'å¯ç”¨' if user.active else 'åœç”¨' }}
          </span>
        </div>
      </div>
    </div>
    
    <div class="card-body">
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">ç”¨æˆ·å</div>
          <div class="info-value">{{ user.username }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">æ˜µç§°</div>
          <div class="info-value">{{ user.nickname or 'æœªè®¾ç½®' }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">é‚®ç®±</div>
          <div class="info-value">{{ user.email or 'æœªè®¾ç½®' }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">è§’è‰²</div>
          <div class="info-value">{{ (user.roles | map(attribute='name') | list) | map('role_display_name') | join(', ') }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">çŠ¶æ€</div>
          <div class="info-value">
            <span class="status-badge status-{{ 'active' if user.active else 'inactive' }}">
              {{ 'å¯ç”¨' if user.active else 'åœç”¨' }}
            </span>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">åˆ›å»ºæ—¶é—´</div>
          <div class="info-value">{{ user.created_at | local_datetime('%Y-%m-%d %H:%M') if user.created_at else 'æœªçŸ¥' }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">æœ€åç™»å½•</div>
          <div class="info-value">{{ user.last_login_at | local_datetime('%Y-%m-%d %H:%M') if user.last_login_at else 'ä»æœªç™»å½•' }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="action-section">
    <h2 class="section-title">ç”¨æˆ·æ“ä½œ</h2>
    <div class="action-buttons">
      <a class="btn btn-primary" href="{{ url_for('admin.users_edit', user_id=(user.id|string)) }}">ç¼–è¾‘</a>
      <form method="post" action="{{ url_for('admin.users_toggle_active', user_id=(user.id|string)) }}" class="action-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <button class="btn btn-secondary" type="submit">
          {{ 'åœç”¨ç”¨æˆ·' if user.active else 'å¯ç”¨ç”¨æˆ·' }}
        </button>
      </form>
      
      <form method="post" action="{{ url_for('admin.users_reset_password', user_id=(user.id|string)) }}" class="action-form" onsubmit="return confirm('ç¡®å®šé‡ç½®å¯†ç ä¸º 123456ï¼Ÿ')">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <button class="btn btn-warning" type="submit">
          é‡ç½®å¯†ç 
        </button>
      </form>
    </div>
  </div>

  {% if user.last_login_at %}
  <div class="login-history">
    <h2 class="section-title">ç™»å½•ä¿¡æ¯</h2>
    <div class="history-card">
      <div class="history-item">
        <div class="history-label">æœ€åç™»å½•æ—¶é—´</div>
        <div class="history-value">{{ user.last_login_at | local_datetime('%Y-%m-%d %H:%M:%S') }}</div>
      </div>
      {% if user.last_login_ip %}
      <div class="history-item">
        <div class="history-label">æœ€åç™»å½•IP</div>
        <div class="history-value">{{ user.last_login_ip }}</div>
      </div>
      {% endif %}
      {% if user.login_count %}
      <div class="history-item">
        <div class="history-label">ç™»å½•æ¬¡æ•°</div>
        <div class="history-value">{{ user.login_count }} æ¬¡</div>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}
