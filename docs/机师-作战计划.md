# 主播-通告（原“机师-作战计划”）

> 术语统一记录（2025-09-26）
> - 历史用语→统一用语：机师→主播；征召→招募；参战形式→开播方式；战斗区域→开播地点；战区→开播地点；阶级→主播分类；所属→直属运营；X坐标→基地；Y坐标→场地；Z坐标→坐席；作战计划→通告。
> - 本次复核（2025-09-26）：已完成逐段术语检查，正文采用统一用语；数据库/接口字段仍保留历史命名，仅以字段标注说明。
这其实就是主播的通告的管理模块。

可以把他理解成一个会议室预订系统，通告所涉及的开播地点（坐席），就像会议室一样是一个按时段排他的资源。

什么时间段，哪个主播，需要使用哪个开播地点（坐席）。本模块就是要解决这个问题的管理而设计。

模块内一律使用通告、主播这两个词（历史标题与文件名保留）。

## 重要思想

需要充分考虑使用上的便利性，对于通告这个东西，的创建要像日历工具一样来处理。

可以只登记某一次通告，也可以登记按某个规则循环重复的通告；

修改时也要像日历工具一样，如果这个通告是批量（循环重复）生成的，用户可以选择只修改当前这一次，也可以选择修改相关的所有循环。

通告的新建 / 编辑UI应参考日历软件。

这是一个大模块，主要分为：
- 通告登记 / 修改 / 删除
- 按主播（历史称“机师”）查看通告（暂未设计）
- 按席位（开播地点，原“作战区域”）查看通告（暂未设计）

## 元数据

| 字段 | 说明 | 参考类型 | 设定 |
|---------|------|------|------|
| ID | 系统中内部使用的唯一编码，用户不可见 | 由技术设计 | 必须 唯一 |
| 开播地点 | 主播开播所占用的坐席 | 关联到开播地点唯一ID（字段：battle_area_id） | 必须 |
| 基地（原X坐标） | 保存在本数据结构中的快照 | 字符串 | 必须 |
| 场地（原Y坐标） | 保存在本数据结构中的快照 | 字符串 | 必须 |
| 坐席（原Z坐标） | 保存在本数据结构中的快照 | 字符串 | 必须 |
| 主播 | 参与本次通告的主播 | 关联到主播唯一ID | 必须 |
| 开始时间 | 开播的时间 | 时间戳UTC | 必须 |
| 计划时长 | 计划开播的小时数 | 数值 | 必须 |
| 关联通告 | 为了实现上述日历工具一样使用体验而需要额外存放的数据，由技术设计 | JSON或其他，由技术设计 | 非必须 |
| 变更记录 | 记录上述字段的所有修改日志（哪个用户什么时间把什么字段的值从什么改成了什么，修改时使用的IP地址是什么） | JSON或其他结构由技术设计 | 非必须 |

上述元数据设计是站在原始需求层面做的设计，实际技术实现应该基于日历系统的常见数据存储模式进行具体设计。

### 外部关联
- 基地/场地/坐席相当于在这里做了一个快照（用于显示）。开播地点的修改不会反馈到这里。

## 通告登记 / 修改 / 删除

### 列表

列出具体的通告，按通告日顺序、通告日相同的按主播昵称字典顺序排列。

一次取出100条，通过滚动加载更多。

这个列表其实不是常用功能，因而并不需要使用日历视图，还是正常的列表即可。日历视图的部分会另外设计。

#### 筛选

支持以下筛选器：
- 直属运营
- 主播分类
- 基地（X）
- 场地（Y）
    - 与基地联动
- 时间
    - 这两天（默认）
    - 现在开始
    - 全部

所有筛选器复合使用时取交集。

筛选器应存放在Cookie中。

默认筛选器：
- 时间 = 这两天

### 通告登记

使用三联动下拉选择来选基地、场地、坐席。基地/场地按字典顺序排序，坐席虽然也是文本型但如果存储的是数字，优先按照数字来进行排序（9应该在10前面）。

基地默认值 = 字典顺序的第一个
场地默认值 = 空
坐席默认值 = 空

主播提供一个直属运营、主播分类、主播昵称[真实姓名]的三联选择。直属运营按字典顺序排序，主播分类按枚举顺序排序，主播昵称按字典顺序排序，只有状态为 已招募 或 已签约 的主播会出现在这个列表中（数据库与接口仍沿用历史字段名）。

直属运营的默认值 = 空
主播分类的默认值 = 空
主播的默认值 = 空

直属运营和主播分类只是为了快速输入主播的筛选器，实际并不存入数据库。

参考日历应用的UI设计日期、时间、时长、重复循环（比如从9月9日开始，每周二三五的下午14:00安排一个6小时的通告，到9月30日为止）的设计。系统支持最大跨度60天的循环设置。

时长默认值 = 6，支持以0.5为Step进行调整，最大时长是16，最小时长是1。

不能直接点击登录通告按钮，只能先点击检查按钮。

#### 检查步骤

- 检查场地/坐席不可为空
- 检查主播不可为空
- 检查开始时间不可为空
- 检查时长不可为空
- 检查重复循环设置正确
- 根据重复循环的设置排出所有的可能的开播计划
    - 逐一检查覆盖时段范围内（根据开播时间和时长计算）是否有其他的通告占用了相同的开播地点（按开播地点ID比较）
    - 逐一检查覆盖时段内，当前主播是否已经安排了其他的通告

对于简单的输入检查，将检查结果正常呈现在表单上；

对于最后一步的开播地点或主播占用的检查，将检查结果呈现在检查按钮的下方登录通告按钮的上方，也就是在两个按钮之间以列表方式展示。列表内容为“所有的可能的开播计划”（而不是仅列出有错的计划），这一步旨在让用户真的清楚知道自己在干嘛。

如果全部检查通过的话，登录通告按钮可用。

为了防止用户在一次检查通过后再次修改表单内容跳过检查，直接点击登录通告。登录通告按钮实际还是会先执行一次检查确认通过后才会正式登录到数据库。


### 通告编辑 / 删除

通告编辑的UI应该和通告登记几乎相同（甚至可以复用）。

注意 编辑 / 删除 的功能，应该参考日历应用那样如果有关联的通告，会问你是只改（删）这个，还是一次改（删）全部，或是一次改（删）未来时间的通告。

### 通告详情

展示一个具体的通告的信息。

底部：编辑按钮、删除按钮、变更记录按钮

#### 变更记录

点击变更记录按钮进入本功能。

弹窗展示最近100条变更记录，按变更发生的时间逆序排列。

变更记录内容：
- 变更时间
- 操作用户
- 变更字段
- 变更前值
- 变更后值
- 操作IP地址

没有删除功能。
