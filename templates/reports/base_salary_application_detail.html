{% extends "base.html" %}

{% block title %}åº•è–ªç”³è¯·è¯¦æƒ… - Lacus-Log{% endblock %}

{% block content %}
<div class="container">
  <div class="back-nav">
    <a class="btn btn-secondary" id="backButton" href="/reports/base-salary-applications">
      <span>â†</span>
      è¿”å›
    </a>
  </div>

<section class="battle-record-detail">
  <div class="page-header">
    <h1 class="page-title">åº•è–ªç”³è¯·è¯¦æƒ…</h1>
  </div>

  <div class="detail-card">
    <!-- ä¸»æ’­ä¿¡æ¯å¡ç‰‡ -->
    <div class="card-section">
      <h3 class="section-title">ä¸»æ’­ä¿¡æ¯</h3>
      <div class="detail-grid">
        <div class="detail-item">
          <label>æ˜µç§°</label>
          <div class="value" id="pilotNickname">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>çœŸå®å§“å</label>
          <div class="value" id="pilotRealName">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>ç›´å±è¿è¥</label>
          <div class="value" id="pilotOwner">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>å½“å‰ç»“ç®—æ–¹å¼</label>
          <div class="value" id="currentSettlement">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- å¼€æ’­è®°å½•å¡ç‰‡ -->
    <div class="card-section">
      <h3 class="section-title">å¼€æ’­è®°å½•ä¿¡æ¯</h3>
      <div class="detail-grid">
        <div class="detail-item">
          <label>å¼€å§‹æ—¶é—´</label>
          <div class="value" id="battleStartTime">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>æ—¶é•¿</label>
          <div class="value" id="battleDuration">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item full-width">
          <label>æµæ°´é‡‘é¢</label>
          <div class="value amount" id="battleRevenue">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- ç”³è¯·ä¿¡æ¯å¡ç‰‡ -->
    <div class="card-section">
      <h3 class="section-title">ç”³è¯·ä¿¡æ¯</h3>
      <div class="detail-grid">
        <div class="detail-item">
          <label>ç»“ç®—æ–¹å¼ï¼ˆå¿«ç…§ï¼‰</label>
          <div class="value" id="settlementType">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>ç”³è¯·åº•è–ªé‡‘é¢</label>
          <div class="value amount" id="baseSalaryAmount">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>ç”³è¯·äºº</label>
          <div class="value" id="applicant">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>ç”³è¯·æ—¶é—´</label>
          <div class="value" id="createdAt">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>

    <!-- å‘æ”¾çŠ¶æ€å¡ç‰‡ -->
    <div class="card-section">
      <h3 class="section-title">å‘æ”¾çŠ¶æ€</h3>
      <div class="detail-grid">
        <div class="detail-item">
          <label>çŠ¶æ€</label>
          <div class="value" id="statusDisplay">åŠ è½½ä¸­...</div>
        </div>
        <div class="detail-item">
          <label>æœ€è¿‘æ“ä½œäºº</label>
          <div class="value" id="lastOperator">æœªæ“ä½œ</div>
        </div>
        <div class="detail-item">
          <label>æ“ä½œæ—¶é—´</label>
          <div class="value" id="lastOperatedAt">--</div>
        </div>
      </div>
    </div>
  </div>

  <div id="errorMessage" class="error-message" style="display:none;"></div>
</section>
</div>

<!-- çŠ¶æ€å˜æ›´æ¨¡æ€æ¡† -->
<div id="statusChangeModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>å˜æ›´ç”³è¯·çŠ¶æ€</h3>
      <button class="modal-close" onclick="closeStatusChangeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">æ–°çŠ¶æ€</label>
        <div id="newStatusDisplay" class="status-preview"></div>
      </div>
      <div class="form-group">
        <label for="remarkInput" class="form-label">æ“ä½œå¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰</label>
        <textarea id="remarkInput" class="form-input" rows="3" maxlength="200" placeholder="è¾“å…¥æ“ä½œè¯´æ˜"></textarea>
        <small style="color: #999;">
          <span id="charCount">0</span>/200
        </small>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeStatusChangeModal()">å–æ¶ˆ</button>
      <button type="button" class="btn btn-primary" id="confirmStatusChangeBtn" onclick="confirmStatusChange()">ç¡®è®¤å˜æ›´</button>
    </div>
  </div>
</div>

<!-- å˜æ›´è®°å½•æ¨¡æ€æ¡† -->
<div id="changeLogModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>å˜æ›´è®°å½•</h3>
      <button class="modal-close" onclick="hideChangeLog()">&times;</button>
    </div>
    <div class="modal-body" id="changeLogContent">
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <div class="loading-text">åŠ è½½ä¸­...</div>
      </div>
    </div>
  </div>
</div>

<!-- åº•éƒ¨æ“ä½œæ  -->
<div class="footbar" id="footbarContainer">
  <div class="inner" id="actionButtons">
    <!-- æ“ä½œæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
  </div>
</div>

<style>
/* å¤ç”¨å¼€æ’­è®°å½•è¯¦æƒ…é¡µé¢çš„æ ·å¼ */
.container {
  padding-bottom: 88px;
}

.back-nav {
  margin-bottom: 16px;
}

.battle-record-detail {
  background: #fff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.page-header {
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid #e0e0e0;
}

.page-title {
  font-size: 22px;
  font-weight: 600;
  color: #333;
  margin: 0;
}

.detail-card {
  background: #f9f9f9;
  border: 1px solid #e8e8e8;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 16px;
}

.card-section {
  margin-bottom: 20px;
}

.card-section:last-child {
  margin-bottom: 0;
}

.section-title {
  font-size: 14px;
  font-weight: 600;
  color: #333;
  margin: 0 0 12px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid #e8e8e8;
}

.detail-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.detail-item {
  display: flex;
  flex-direction: column;
}

.detail-item.full-width {
  grid-column: 1 / -1;
}

.detail-item label {
  font-size: 12px;
  color: #999;
  margin-bottom: 4px;
  font-weight: 500;
}

.detail-item .value {
  font-size: 14px;
  color: #333;
  font-weight: 500;
}

.detail-item .value.amount {
  color: #8B0000;
  font-size: 16px;
}

.footbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #fff;
  border-top: 1px solid #e0e0e0;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.06);
  padding: 10px 12px calc(env(safe-area-inset-bottom, 0) + 10px) 12px;
  z-index: 1;
}

.footbar .inner {
  display: flex;
  justify-content: center;
  gap: 12px;
}

.btn {
  padding: 10px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  border: none;
  transition: all 0.2s;
  font-weight: 500;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.btn-secondary {
  background: #fff;
  color: #111111;
  border: 1px solid #A9A9A9;
}

.btn-secondary:hover {
  background: #F2F2F2;
}

.btn-primary {
  background: #8B0000;
  color: white;
  border: 1px solid #8B0000;
}

.btn-primary:hover {
  background: #B22222;
}

.btn-success {
  background: #00B37A;
  color: white;
  border: 1px solid #00B37A;
}

.btn-success:hover {
  background: #00a16e;
}

.btn-danger {
  background: #FF4500;
  color: white;
  border: 1px solid #FF4500;
}

.btn-danger:hover {
  background: #e03e00;
}

.btn:disabled {
  background: #bfbfbf;
  cursor: not-allowed;
  opacity: 0.6;
}

.error-message {
  background: #fff2e6;
  border: 1px solid #ffbb96;
  border-radius: 4px;
  padding: 12px;
  color: #c6001a;
  font-size: 14px;
  margin-bottom: 16px;
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal-content {
  background: #fff;
  border-radius: 8px;
  max-width: 500px;
  width: 100%;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
}

.modal-header {
  padding: 16px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  color: #999;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
}

.modal-body {
  padding: 16px;
  flex: 1;
  overflow-y: auto;
}

.modal-footer {
  padding: 16px;
  border-top: 1px solid #e0e0e0;
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: #333;
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  font-size: 14px;
  color: #333;
  box-sizing: border-box;
  font-family: inherit;
}

.status-preview {
  font-size: 14px;
  padding: 8px 12px;
  background: #f5f5f5;
  border-radius: 4px;
  color: #333;
}

.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  color: #999;
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid #f3f3f3;
  border-top: 2px solid #1890ff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 8px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  font-size: 12px;
}

.change-log-item {
  background: #fff;
  border: 1px solid #e8e8e8;
  border-radius: 4px;
  padding: 10px;
  margin-bottom: 8px;
  font-size: 12px;
}

.change-field {
  font-weight: 500;
  margin-bottom: 4px;
}

.change-detail {
  color: #666;
  margin-left: 12px;
}

.link {
  color: #8B0000;
  text-decoration: none;
}

.link:hover {
  text-decoration: underline;
}

@media (max-width: 600px) {
  .container {
    padding: 12px;
  }

  .detail-grid {
    grid-template-columns: 1fr;
  }

  .detail-item.full-width {
    grid-column: 1;
  }

  .footbar .inner {
    flex-direction: column;
  }

  .btn {
    width: 100%;
  }
}
</style>

<script>
const APPLICATION_ID = new URLSearchParams(window.location.search).get('id');
let applicationData = null;

async function initPage() {
  if (!APPLICATION_ID) {
    showError('ç¼ºå°‘ç”³è¯·IDå‚æ•°');
    return;
  }

  // è®¾ç½®è¿”å›é“¾æ¥ï¼Œä¿æŒæ—¥æœŸå‚æ•°
  setupBackButton();

  try {
    await loadApplicationDetail();
  } catch (error) {
    showError(error.message);
  }
}

function setupBackButton() {
  const backButton = document.getElementById('backButton');
  const urlParams = new URLSearchParams(window.location.search);
  const dateParam = urlParams.get('date');
  
  let backUrl = '/reports/base-salary-applications';
  if (dateParam) {
    backUrl += `?date=${dateParam}`;
  }
  
  backButton.href = backUrl;
}

async function loadApplicationDetail() {
  try {
    console.log('å¼€å§‹åŠ è½½ç”³è¯·è¯¦æƒ…ï¼ŒID:', APPLICATION_ID);
    const response = await fetch(`/api/base-salary-applications/${APPLICATION_ID}`, {
      credentials: 'include'
    });

    console.log('APIå“åº”çŠ¶æ€:', response.status);
    if (!response.ok) {
      throw new Error('åŠ è½½ç”³è¯·è¯¦æƒ…å¤±è´¥');
    }

    const result = await response.json();
    console.log('APIå“åº”æ•°æ®:', result);
    if (!result.success) {
      throw new Error(result.error?.message || 'ç”³è¯·ä¸å­˜åœ¨');
    }

    applicationData = result.data;
    console.log('è®¾ç½®applicationData:', applicationData);
    renderDetail();
  } catch (error) {
    console.error('åŠ è½½ç”³è¯·è¯¦æƒ…å¤±è´¥:', error);
    showError(error.message);
  }
}

function renderDetail() {
  // ä¸»æ’­æ˜µç§° - æ·»åŠ è¶…é“¾æ¥
  const pilotNickname = document.getElementById('pilotNickname');
  if (applicationData.pilot?.nickname && applicationData.pilot?.id) {
    pilotNickname.innerHTML = `<a href="/pilots/${applicationData.pilot.id}?from=base_salary_detail&application_id=${APPLICATION_ID}" class="link">${applicationData.pilot.nickname}</a>`;
  } else {
    pilotNickname.textContent = '--';
  }
  
  document.getElementById('pilotRealName').textContent = applicationData.pilot?.real_name || '--';
  document.getElementById('pilotOwner').textContent = applicationData.pilot?.owner?.nickname || '--';
  
  // å½“å‰ç»“ç®—æ–¹å¼ - æ·»åŠ è¶…é“¾æ¥
  const currentSettlement = document.getElementById('currentSettlement');
  const settlementTypeDisplay = getSettlementTypeDisplay(applicationData.settlement_type);
  if (applicationData.pilot?.id) {
    currentSettlement.innerHTML = `<a href="/pilots/${applicationData.pilot.id}/settlement/?from=base_salary_detail&application_id=${APPLICATION_ID}" class="link">${settlementTypeDisplay}</a>`;
  } else {
    currentSettlement.textContent = settlementTypeDisplay;
  }
  
  document.getElementById('settlementType').textContent = settlementTypeDisplay;

  // å¼€å§‹æ—¶é—´ - æ·»åŠ è¶…é“¾æ¥
  const battleStartTime = document.getElementById('battleStartTime');
  const formattedTime = formatDateTime(applicationData.battle_record?.start_time);
  if (formattedTime && applicationData.battle_record?.id) {
    battleStartTime.innerHTML = `<a href="/battle-records/${applicationData.battle_record.id}?from=base_salary_detail&application_id=${APPLICATION_ID}" class="link">${formattedTime}</a>`;
  } else {
    battleStartTime.textContent = formattedTime || '--';
  }
  
  document.getElementById('battleDuration').textContent = (applicationData.battle_record?.duration_hours || 0) + ' å°æ—¶';
  document.getElementById('battleRevenue').textContent = 'Â¥' + (parseFloat(applicationData.battle_record?.revenue_amount || 0).toFixed(2));

  document.getElementById('baseSalaryAmount').textContent = 'Â¥' + (parseFloat(applicationData.base_salary_amount || 0).toFixed(2));
  document.getElementById('applicant').textContent = applicationData.applicant?.nickname || '--';
  document.getElementById('createdAt').textContent = formatDateTime(applicationData.created_at) || '--';

  // çŠ¶æ€æ˜¾ç¤º
  const statusDisplay = document.getElementById('statusDisplay');
  statusDisplay.textContent = applicationData.status_display;
  statusDisplay.className = `status-value ${applicationData.status}`;

  // æ“ä½œæ—¶é—´æ˜¾ç¤º
  document.getElementById('lastOperatedAt').textContent = formatDateTime(applicationData.updated_at) || '--';

  // æ¸²æŸ“æ“ä½œæŒ‰é’®åˆ°footbar
  renderActionButtons();
}

// ç»“ç®—æ–¹å¼æšä¸¾å€¼è½¬æ˜¾ç¤ºå€¼çš„æ˜ å°„
function getSettlementTypeDisplay(settlementType) {
  const mapping = {
    'daily_base': 'æ—¥ç»“åº•è–ª',
    'monthly_base': 'æœˆç»“åº•è–ª',
    'none': 'æ— åº•è–ª'
  };
  return mapping[settlementType] || settlementType || 'æœªçŸ¥';
}

function renderActionButtons() {
  const actionsDiv = document.getElementById('actionButtons');
  const status = applicationData.status;
  
  console.log('æ¸²æŸ“æ“ä½œæŒ‰é’® - çŠ¶æ€:', status, 'æ•°æ®:', applicationData);

  let buttons = [];

  if (status === 'pending' || status === 'rejected') {
    buttons.push(`<button class="btn btn-success" onclick="prepareStatusChange('approved')">
      <span class="btn-icon">âœ“</span>
      ç¡®è®¤å‘æ”¾
    </button>`);
  }

  if (status === 'pending' || status === 'approved') {
    buttons.push(`<button class="btn btn-danger" onclick="prepareStatusChange('rejected')">
      <span class="btn-icon">âœ—</span>
      æ‹’ç»å‘æ”¾
    </button>`);
  }

  if (status === 'approved' || status === 'rejected') {
    buttons.push(`<button class="btn btn-secondary" onclick="prepareStatusChange('pending')">
      <span class="btn-icon">â†º</span>
      å›åˆ°æœªå¤„ç†
    </button>`);
  }

  buttons.push(`<button class="btn btn-secondary" onclick="showChangeLog()">
    <span class="btn-icon">ğŸ“‹</span>
    å˜æ›´è®°å½•
  </button>`);

  console.log('ç”Ÿæˆçš„æŒ‰é’®:', buttons);

  if (buttons.length === 0) {
    actionsDiv.innerHTML = '<span style="color: #666;">æ— å¯ç”¨æ“ä½œ</span>';
  } else {
    actionsDiv.innerHTML = buttons.join('');
  }
}

function prepareStatusChange(newStatus) {
  const statusMap = {
    'pending': 'æœªå¤„ç†',
    'approved': 'å·²å‘æ”¾',
    'rejected': 'æ‹’ç»å‘æ”¾'
  };

  document.getElementById('newStatusDisplay').textContent = statusMap[newStatus] || 'æœªçŸ¥';
  document.getElementById('remarkInput').value = '';
  document.getElementById('charCount').textContent = '0';
  document.getElementById('confirmStatusChangeBtn').setAttribute('data-new-status', newStatus);
  document.getElementById('statusChangeModal').style.display = 'block';
}

document.getElementById('remarkInput').addEventListener('input', (e) => {
  document.getElementById('charCount').textContent = e.target.value.length;
});

async function confirmStatusChange() {
  const newStatus = document.getElementById('confirmStatusChangeBtn').getAttribute('data-new-status');
  const remark = document.getElementById('remarkInput').value.trim();
  const btn = document.getElementById('confirmStatusChangeBtn');

  btn.disabled = true;

  try {
    const response = await fetch(`/api/base-salary-applications/${APPLICATION_ID}/status`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({
        status: newStatus,
        remark: remark || null
      })
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error?.message || 'çŠ¶æ€å˜æ›´å¤±è´¥');
    }

    closeStatusChangeModal();
    await loadApplicationDetail();
  } catch (error) {
    alert('âŒ ' + error.message);
    btn.disabled = false;
  }
}

function closeStatusChangeModal() {
  document.getElementById('statusChangeModal').style.display = 'none';
}


function showChangeLog() {
  const modal = document.getElementById('changeLogModal');
  const content = document.getElementById('changeLogContent');
  
  modal.style.display = 'flex';
  content.innerHTML = `
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <div class="loading-text">åŠ è½½ä¸­...</div>
    </div>
  `;
  
  loadChangeLogData();
}

function hideChangeLog() {
  document.getElementById('changeLogModal').style.display = 'none';
}

async function loadChangeLogData() {
  try {
    const response = await fetch(`/api/base-salary-applications/${APPLICATION_ID}/changes`, {
      credentials: 'include'
    });

    if (!response.ok) {
      throw new Error('åŠ è½½å˜æ›´è®°å½•å¤±è´¥');
    }

    const result = await response.json();
    const content = document.getElementById('changeLogContent');
    
    if (result.success && result.data.items && result.data.items.length > 0) {
      const logs = result.data.items;
      content.innerHTML = logs.map(log => `
        <div class="change-log-item">
          <div class="change-field">${log.field_display_name}</div>
          <div class="change-detail">æ—§å€¼: ${log.old_value || '(æ— )'}</div>
          <div class="change-detail">æ–°å€¼: ${log.new_value || '(æ— )'}</div>
          ${log.remark ? `<div class="change-detail">å¤‡æ³¨: ${log.remark}</div>` : ''}
          <div class="change-detail" style="color: #999; margin-top: 4px;">
            ${log.user?.nickname || 'æœªçŸ¥'} - ${formatDateTime(log.change_time) || '--'}
          </div>
        </div>
      `).join('');
    } else {
      content.innerHTML = '<div class="loading-state"><div class="loading-text">æš‚æ— å˜æ›´è®°å½•</div></div>';
    }
  } catch (error) {
    console.error('åŠ è½½å˜æ›´è®°å½•å¤±è´¥:', error);
    document.getElementById('changeLogContent').innerHTML = `
      <div class="loading-state">
        <div class="loading-text" style="color: #c6001a;">åŠ è½½å¤±è´¥ï¼š${error.message}</div>
      </div>
    `;
  }
}

function formatDateTime(isoString) {
  if (!isoString) return '--';
  try {
    // å¤„ç†æ²¡æœ‰æ—¶åŒºä¿¡æ¯çš„ISOæ ¼å¼å­—ç¬¦ä¸²
    let dateStr = isoString;
    if (dateStr.includes('T') && !dateStr.includes('Z') && !dateStr.includes('+') && !dateStr.includes('-', 10)) {
      // å¦‚æœæ²¡æœ‰æ—¶åŒºä¿¡æ¯ï¼Œå‡è®¾ä¸ºæœ¬åœ°æ—¶é—´
      dateStr = dateStr + '+08:00';
    }
    const date = new Date(dateStr);
    
    // æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
    if (isNaN(date.getTime())) {
      return '--';
    }
    
    return date.toLocaleString('zh-CN', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
  } catch {
    return '--';
  }
}

function showError(message) {
  const errorDiv = document.getElementById('errorMessage');
  errorDiv.textContent = message;
  errorDiv.style.display = 'block';
}

window.onclick = function(event) {
  const statusModal = document.getElementById('statusChangeModal');
  const changeLogModal = document.getElementById('changeLogModal');
  
  if (event.target === statusModal) {
    statusModal.style.display = 'none';
  }
  
  if (event.target === changeLogModal) {
    changeLogModal.style.display = 'none';
  }
}

document.addEventListener('DOMContentLoaded', initPage);
</script>
{% endblock %}

